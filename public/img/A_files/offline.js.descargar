(function(g){var window=this;'use strict';var zDA=function(z){var t=new g.vG("und",new g.sB("Default","und",!0));t.captionTracks=z.captionTracks;return t},t5V=function(z){return new g.bN(function(t,Y){var K=z.length,T=[];
if(K)for(var G=function(X,O){K--;T[X]=O;K==0&&t(T)},v=function(X){Y(X)},f,C=0;C<z.length;C++)f=z[C],g.xnJ(f,g.K_(G,C),v);
else t(T)})},PY=function(z){this.K=z},Iz=function(){PY.apply(this,arguments)},Y9F=function(){Iz.apply(this,arguments)},KbN=function(){Iz.apply(this,arguments)},Tg2=function(){Iz.apply(this,arguments)},Gaw=function(){Iz.apply(this,arguments)},v1F=function(){Iz.apply(this,arguments)},AGW=function(){Iz.apply(this,arguments)},fBw=function(){PY.apply(this,arguments)},CTN=function(){Iz.apply(this,arguments)},XN2=function(){Iz.apply(this,arguments)},iU_=function(){Iz.apply(this,arguments)},OUW=function(){Iz.apply(this,
arguments)},s9Q=function(){Iz.apply(this,arguments)},DmQ=function(){Iz.apply(this,arguments)},M5V=function(){Iz.apply(this,arguments)},lB6=function(){Iz.apply(this,arguments)},ZU6=function(){Iz.apply(this,arguments)},q9j=function(){Iz.apply(this,arguments)},pN_=function(){Iz.apply(this,arguments)},rGK=function(){Iz.apply(this,arguments)},HU2=function(){PY.apply(this,arguments)},j9Q=function(){Iz.apply(this,arguments)},Um$=function(){Iz.apply(this,arguments)},Bg6=function(){Iz.apply(this,arguments)},
wNK=function(){Iz.apply(this,arguments)},bUw=function(){Iz.apply(this,arguments)},V5W=function(){Iz.apply(this,arguments)},n1A=function(){Iz.apply(this,arguments)},Fbz=function(){Iz.apply(this,arguments)},Q9z=function(){Iz.apply(this,arguments)},cGN=function(){PY.apply(this,arguments)},uR6=function(){PY.apply(this,arguments)},ka2=function(){PY.apply(this,arguments)},$mj=function(){Iz.apply(this,arguments)},o1$=function(){Iz.apply(this,arguments)},LbN=function(){Iz.apply(this,arguments)},PT$=function(){Iz.apply(this,
arguments)},IBV=function(){Iz.apply(this,arguments)},aBF=function(){Iz.apply(this,arguments)},g1j=function(){Iz.apply(this,arguments)},JG$=function(){Iz.apply(this,arguments)},mmw=function(){Iz.apply(this,arguments)},NgN=function(){Iz.apply(this,arguments)},yGQ=function(){Iz.apply(this,arguments)},eDz=function(){Iz.apply(this,arguments)},dmW=function(){Iz.apply(this,arguments)},xmK=function(){Iz.apply(this,arguments)},S9z=function(){Iz.apply(this,arguments)},E1$=function(){Iz.apply(this,arguments)},
WbN=function(){Iz.apply(this,arguments)},RD$=function(){Iz.apply(this,arguments)},hDj=function(){Iz.apply(this,arguments)},zyj=function(){Iz.apply(this,arguments)},tbA=function(){Iz.apply(this,arguments)},Y6K=function(){Iz.apply(this,arguments)},KDj=function(){Iz.apply(this,arguments)},TfQ=function(){Iz.apply(this,arguments)},GYj=function(){Iz.apply(this,arguments)},v0j=function(){Iz.apply(this,arguments)},A6$=function(){PY.apply(this,arguments)},fl$=function(){Iz.apply(this,arguments)},CBF=function(){Iz.apply(this,
arguments)},XvN=function(){Iz.apply(this,arguments)},ic6=function(){Iz.apply(this,arguments)},Ocz=function(){Iz.apply(this,arguments)},sSN=function(){Iz.apply(this,arguments)},Db$=function(){Iz.apply(this,arguments)},Mbw=function(){Iz.apply(this,arguments)},ll6=function(){Iz.apply(this,arguments)},Zc6=function(){Iz.apply(this,arguments)},q6$=function(){Iz.apply(this,arguments)},pvV=function(){Iz.apply(this,arguments)},r6N=function(){Iz.apply(this,arguments)},Hc_=function(){Iz.apply(this,arguments)},
jSA=function(){Iz.apply(this,arguments)},UbF=function(){Iz.apply(this,arguments)},BfK=function(){Iz.apply(this,arguments)},wvW=function(){Iz.apply(this,arguments)},bcF=function(){Iz.apply(this,arguments)},VbW=function(){Iz.apply(this,arguments)},n0$=function(){Iz.apply(this,arguments)},FDz=function(){Iz.apply(this,arguments)},QS$=function(){Iz.apply(this,arguments)},c6A=function(){Iz.apply(this,arguments)},u4z=function(){Iz.apply(this,arguments)},kY$=function(){Iz.apply(this,arguments)},$bA=function(){Iz.apply(this,
arguments)},o02=function(){Iz.apply(this,arguments)},LDA=function(){Iz.apply(this,arguments)},PBF=function(){Iz.apply(this,arguments)},Il$=function(){Iz.apply(this,arguments)},al$=function(){Iz.apply(this,arguments)},g0W=function(z){z=z.key||z.id;
if(!z)throw Error("Entity key is missing");return z},J66=function(){if(az)return az();
var z={};az=g.TI("PersistentEntityStoreDb",{qK:(z.EntityStore={cO:1},z.EntityAssociationStore={cO:2},z),shared:!1,upgrade:function(t,Y){Y(1)&&g.aP(g.kc(t,"EntityStore",{keyPath:"key"}),"entityType","entityType");Y(2)&&(t=g.kc(t,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.aP(t,"byParentEntityKey","parentEntityKey"),g.aP(t,"byChildEntityKey","childEntityKey"))},
version:3});return az()},mbN=function(z){return g.xc(J66(),z)},Nf2=function(z){return g.xc((0,g.Fcz)(),z)},gv=function(z){this.token=z},JP=function(z,t){t=t===void 0?{}:t;
g.E$.call(this,g.QjA[z],Object.assign({},{name:"PESEncoderError",type:z},t));this.type=z;this.level="WARNING";Object.setPrototypeOf(this,JP.prototype)},y6A=function(z){return new JP("WRONG_DATA_TYPE",{EL:z})},ey$=function(z){return z instanceof Error?new JP("UNKNOWN_ENCODE_ERROR",{originalMessage:z.message}):new JP("UNKNOWN_ENCODE_ERROR")},dbF=function(z){return z instanceof Error?new JP("UNKNOWN_DECODE_ERROR",{originalMessage:z.message}):new JP("UNKNOWN_DECODE_ERROR")},xb$=function(z,t){z=z instanceof
JP?z:t(z);
g.IO(z);throw z;},S6w=function(){},E0W=function(z,t,Y){try{return z.L(t,Y)}catch(K){xb$(K,ey$)}},WDQ=function(z){z=(new TextEncoder).encode(z).subarray(0,16);
var t=new Uint8Array(16);t.set(z);return t},mH=function(z){this.K=z},hy2=function(z){var t=Ry2[z];
if(t)return t;g.aO(new g.E$("Entity model not found.",{entityType:z}))},zLA=function(z,t){this.K=z;
this.J=t;this.L={}},Yv_=function(z,t){a:{z=t$z(z.J,t.version);
try{var Y=z.J(t.data,t.key);break a}catch(K){xb$(K,dbF)}Y=void 0}return Y},NW=function(z,t,Y){return z.K.objectStore("EntityStore").get(t).then(function(K){if(K){if(Y&&K.entityType!==Y)throw Error("Incorrect entity type");
return Yv_(z,K)}})},yM=function(z,t,Y){return Y?(Y=Y.map(function(K){return NW(z,K,t)}),g.nb.all(Y)):z.K.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(t)).then(function(K){return K.map(function(T){return Yv_(z,T)})})},dv=function(z,t,Y){var K=g0W(t),T=t$z(z.J,1),G=Object.assign({},t);
return z.K.objectStore("EntityStore").get(K).then(function(v){if(v){if(v.entityType!==Y)throw Error("Incorrect entity type");G.entityMetadata||(v=Yv_(z,v),G.entityMetadata=v.entityMetadata)}}).then(function(){var v={key:K,
entityType:Y,data:E0W(T,G,K),version:1};return g.nb.all([g.Lb(z.K.objectStore("EntityStore"),v),KJ$(z,G,Y)])}).then(function(){eu(z,K,Y);
return K})},Tuj=function(z,t,Y){t=t.map(function(K){return dv(z,K,Y)});
return g.nb.all(t)},xC=function(z,t,Y){if(Y==null?0:Y.Zr){var K=new Set;
return GuA(z,t,K).then(function(){for(var G=[],v=g.r(K),f=v.next();!f.done;f=v.next())G.push(xC(z,f.value));return g.nb.all(G).then(function(){})})}var T=g.hR(t).entityType;
return g.nb.all([z.K.objectStore("EntityStore").delete(t),vA$(z,t)]).then(function(){eu(z,t,T)})},AJ2=function(z,t){return g.N6(z.K.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(t)},function(Y){return g.nb.all([Y.delete(),
vA$(z,Y.cursor.primaryKey)]).then(function(){eu(z,Y.cursor.primaryKey,t);return g.Ju(Y)})})},fFV=function(z,t,Y,K){var T=t$z(z.J,1);
return NW(z,t,K).then(function(G){if(G){G=g.pS(G,Y);var v={key:t,entityType:K,data:E0W(T,G,t),version:1};return g.nb.all([g.Lb(z.K.objectStore("EntityStore"),v),KJ$(z,G,K)])}}).then(function(){eu(z,t,K);
return t})},eu=function(z,t,Y){var K=z.L[Y];
K||(K=new Set,z.L[Y]=K);K.add(t)},CN$=function(z,t,Y){var K=g0W(t);
Y=hy2(Y);if(!Y)return g.nb.resolve([]);Y=new Y(t);z=z.K.objectStore("EntityAssociationStore");t=[];Y=g.r(Y.J());for(var T=Y.next();!T.done;T=Y.next())t.push(g.Lb(z,{parentEntityKey:K,childEntityKey:T.value}));return g.nb.all(t).then(function(G){return G.map(function(v){return v[1]})})},vA$=function(z,t){return z.K.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(t))},KJ$=function(z,t,Y){var K=g0W(t);
return vA$(z,K).then(function(){return CN$(z,t,Y)})},GuA=function(z,t,Y){if(Y.has(t))return g.nb.resolve(void 0);
Y.add(t);return Xww(z,t).then(function(K){return z.K.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(t)).then(function(){return K})}).then(function(K){var T=g.nb.resolve(void 0);
K=g.r(K);for(var G=K.next(),v={};!G.done;v={t2:void 0},G=K.next())v.t2=G.value,T=T.then(function(f){return function(){return GuA(z,f.t2,Y)}}(v));
return T}).then(function(){})},Xww=function(z,t){var Y=z.K.objectStore("EntityAssociationStore");
return Y.index("byParentEntityKey").getAll(IDBKeyRange.only(t)).then(function(K){var T=[];K=g.r(K);for(var G=K.next();!G.done;G=K.next())G=G.value,T.push(Y.index("byChildEntityKey").getAll(G.childEntityKey));return g.nb.all(T)}).then(function(K){var T=[];
K=g.r(K);for(var G=K.next();!G.done;G=K.next())G=G.value,G.length===1&&T.push(G[0].childEntityKey);return T})},Su=function(){},iOj=function(){this.K={};
this.K[0]=new Su;if(!g.UF("aes_pes_encoder_killswitch")){var z=this.K;try{var t=g.WL();var Y=WDQ(t);var K=new mH(new g.wq(Y),new g.Br(Y))}catch(T){throw z=T instanceof Error?new JP("KEY_CREATION_FAILED",{originalMessage:T.message}):new JP("KEY_CREATION_FAILED"),g.IO(z),z;}z[1]=K}},t$z=function(z,t){t=t===void 0?0:t;
z=z.K[t];if(!z)throw t=new JP("INVALID_ENCODER_VERSION",{EL:t}),g.IO(t),t;return z},Et=function(z,t){g.I.call(this);
this.token=z;this.K=t;this.observers=[];z=new g.eP.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.WL());z.onmessage=this.J.bind(this);this.channel=z},WY=function(z,t,Y){var K,T,G,v;
return g.P(function(f){if(f.J==1)return g.c(f,mbN(z.token),2);if(f.J!=3)return K=f.K,g.c(f,g.oP(K,["EntityStore","EntityAssociationStore"],t,function(C){T=new zLA(C,z.K);return Y(T)}),3);
G=f.K;T&&(v=T.L,Object.keys(v).length>0&&(z.channel.postMessage(v),OO_(z,v)));return f.return(G)})},Rz=function(z,t,Y){return WY(z,{mode:"readwrite",
bW:!0},function(K){return dv(K,t,Y)})},sa2=function(z,t){return WY(z,{mode:"readwrite",
bW:!0},function(Y){return Tuj(Y,t,"offlineOrchestrationActionWrapperEntity")})},DJN=function(z,t){return WY(z,{mode:"readwrite",
bW:!0},function(Y){return xC(Y,t)})},M$A=function(z){return WY(z,{mode:"readwrite",
bW:!0},function(t){return AJ2(t,"videoPlaybackPositionEntity")})},hP=function(z,t,Y){return WY(z,{mode:"readonly",
bW:!0},function(K){return NW(K,t,Y)})},zF=function(z,t,Y){return WY(z,{mode:"readonly",
bW:!0},function(K){return yM(K,t,Y)})},OO_=function(z,t){z=g.r(z.observers);
for(var Y=z.next();!Y.done;Y=z.next())Y=Y.value,Y(t)},lF$=function(){var z,t,Y;
return g.P(function(K){if(K.J==1)return g.rk(K,2),g.c(K,g.YO(),4);if(K.J!=2){z=K.K;if(!z||!g.Rg()||typeof g.eP.BroadcastChannel==="undefined")return K.return();t=new iOj;return K.return(new Et(z,t))}Y=g.VJ(K);Y instanceof Error&&g.IO(Y);return K.return()})},tT=function(){ZOj||(ZOj=lF$());
return ZOj},qvQ=function(z){var t;
z=(t=z.options)==null?void 0:t.persistenceOption;return z==="ENTITY_PERSISTENCE_OPTION_PERSIST"||z==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},pwQ=function(z){var t;
return g.P(function(Y){return Y.J==1?g.c(Y,tT(),2):(t=Y.K)?g.c(Y,WY(t,"readwrite",function(K){for(var T={},G=g.r(z),v=G.next(),f={};!v.done;f={FH:void 0,EP:void 0},v=G.next())f.FH=v.value,f.FH.entityKey&&qvQ(f.FH)&&(f.EP=g.mF(f.FH.payload),v=void 0,f.FH.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(v=function(C){return function(){return dv(K,C.FH.payload[C.EP],C.EP)}}(f)),f.FH.type==="ENTITY_MUTATION_TYPE_DELETE"&&(v=function(C){return function(){return xC(K,C.FH.entityKey)}}(f)),f.FH.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(v=function(C){return function(){return fFV(K,C.FH.entityKey,C.FH.payload[C.EP],C.EP)}}(f)),v&&(T[f.FH.entityKey]=T[f.FH.entityKey]?T[f.FH.entityKey].then(v):v()));
return g.nb.all(Object.values(T))}),0):Y.return()})},rJz=function(z){var t;
return g.P(function(Y){if(Y.J==1){t=z.mutations;if(!t||t.length<=0)return Y.return();if(g.hk){var K={type:"ENTITY_LOADED"};t!==void 0&&(K.payload=t);g.hk.dispatch(K)}return g.c(Y,pwQ(t),2)}t.length=0;g.pF(Y)})},HO6=function(z){return z!==void 0},jaj=function(z){var t=g.VW();
t=Object.assign({},t);z=Object.assign({},z);for(var Y in t)z[Y]?(t[Y]!==4&&(t[Y]=z[Y]),delete z[Y]):t[Y]!==2&&(t[Y]=4);Object.assign(t,z);g.CiE(t);JSON.stringify(t);return t},UJV=function(z){var t,Y;
return g.P(function(K){if(K.J==1)return g.c(K,g.YO(),2);if(K.J!=3)return(t=K.K)?g.c(K,g.QW(t),3):K.return();Y=K.K;return K.return(g.oP(Y,["index","media","captions"],{mode:"readwrite",bW:!0},function(T){var G=IDBKeyRange.bound(z+"|",z+"~");T=[T.objectStore("index").delete(G),T.objectStore("media").delete(G),T.objectStore("captions").delete(G)];return g.nb.all(T).then(function(){})}))})},Bu$=function(){var z,t;
return g.P(function(Y){if(Y.J==1)return g.c(Y,g.YO(),2);if(Y.J!=3){z=Y.K;if(!z)throw g.bn("rvdfd");return g.c(Y,g.QW(z),3)}t=Y.K;return Y.return(g.oP(t,["index","media"],{mode:"readwrite",bW:!0},function(K){var T={};return g.g2(K.objectStore("index"),{},function(G){var v=G.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),f=g.nb.resolve(void 0);if(v){var C=v[1];v=v[2];T[C]=T[C]||{};var X;T[C][v]=g.DFt((X=G.getValue())==null?void 0:X.fmts)}else f=G.delete().then(function(){});
return g.nb.all([g.Ju(G),f]).then(function(O){return g.r(O).next().value})}).then(function(){for(var G={},v=g.r(Object.keys(T)),f=v.next();!f.done;f=v.next()){f=f.value;
var C=T[f].v;G[f]=T[f].a&&C?1:2}var X=jaj(G);return g.FwP(K.objectStore("media"),{},function(O){var D=O.cursor.key.match(g.qdb);D&&G[D[1]]||K.objectStore("media").delete(O.cursor.key);return g.rvu(O)}).then(function(){return X})})}))})},wwF=function(z,t){var Y,K;
return g.P(function(T){if(T.J==1)return g.c(T,g.YO(),2);if(T.J!=3){Y=T.K;if(!Y)throw g.bn("wct");return g.c(T,g.QW(Y),3)}K=T.K;return g.c(T,g.oP(K,["captions"],{mode:"readwrite",bW:!0},function(G){var v=[];G=G.objectStore("captions");for(var f=0;f<t.length;f++){var C=g.Lb(G,t[f],z+"|"+t[f].metadata.vss_id);v.push(C)}return g.nb.all(v)}),0)})},bOQ=function(z){var t,Y,K;
return g.P(function(T){if(T.J==1)return t=IDBKeyRange.bound(z+"|",z+"~"),g.c(T,g.YO(),2);if(T.J!=3){Y=T.K;if(!Y)throw g.bn("gactfv");return g.c(T,g.QW(Y),3)}K=T.K;return T.return(K.getAll("captions",t))})},V$$=function(z){return g.P(function(t){g.Ff(z,0);
return t.return(UJV(z))})},nA$=function(z){return{context:g.tW(),
videoIds:z}},FJN=function(z){return{context:g.tW(),
playlistIds:z}},Qa$=function(z){return{context:g.tW(),
offlinePlaylistSyncChecks:z}},cJA=function(){this.K=new Map},ku$=function(){uB2||(uB2=new cJA);
return uB2},$J2=function(z,t){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:z},metadata:t,statusCode:void 0,csn:void 0,can:void 0}},oA_=function(z,t,Y){if(!Y){var K=K===void 0?!1:K;
Y=z.K.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!Y||K)Y=g.Vr(16),z.K.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",Y)}z={flowNonce:Y,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:t.eventType};t.metadata&&(z.flowMetadata=t.metadata);t.statusCode!==void 0&&(z.flowEventStatus=t.statusCode);t.csn&&(z.csn=t.csn);t.can&&(z.can=t.can);g.Dw("flowEvent",z,void 0)},LJN=function(z){var t,Y,K,T,G,v,f,C,X,O,D,M,l,Z,H,U,w,V,u,k,J,E,d,Yw,TE,h,fF,W,HI,bt,mI,BA,f_,nF,wk,Tz,B,Ah,ew,jx;
return g.P(function(n_){if(n_.J==1)return g.c(n_,WY(z,{mode:"readonly",bW:!0},function(MV){return yM(MV,"playbackData").then(function(PI){var $K=PI.map(function(Q){return Q.transfer}).filter(function(Q){return!!Q}),FW=PI.map(function(Q){return Q.offlineVideoPolicy}).filter(function(Q){return!!Q}),n=PI.filter(function(Q){return!!Q.key}).map(function(Q){return g.zj(g.hR(Q.key).entityId,"downloadStatusEntity")});
$K=yM(MV,"transfer",$K);FW=yM(MV,"offlineVideoPolicy",FW);n=yM(MV,"downloadStatusEntity",n);var F=$K.then(function(Q){Q=Q.reduce(function(L,N){(N==null?0:N.offlineVideoStreams)&&L.push.apply(L,g.b(N.offlineVideoStreams));return L},[]).filter(function(L){return!!L});
return yM(MV,"offlineVideoStreams",Q)});
return g.nb.all([$K,FW,F,n]).then(function(Q){var L=g.r(Q);Q=L.next().value;var N=L.next().value;var U0=L.next().value;L=L.next().value;return[PI,Q,N,U0,L]})})}),2);
if(n_.J!=3)return t=n_.K,g.c(n_,WY(z,{mode:"readonly",bW:!0},function(MV){return yM(MV,"mainDownloadsListEntity").then(function(PI){var $K,FW;return(FW=($K=PI[0])==null?void 0:$K.downloads)!=null?FW:[]})}),3);
Y=n_.K;K=g.r(t);T=K.next().value;G=K.next().value;v=K.next().value;f=K.next().value;C=K.next().value;X=T;O=G;D=v;M=f;l=C;Z={};H={};U={};w={};V={};u=[];k=g.r(O);for(J=k.next();!J.done;J=k.next())(E=J.value)&&(Z[E.key]=E);d=g.r(D);for(Yw=d.next();!Yw.done;Yw=d.next())(TE=Yw.value)&&(H[TE.key]=TE);h=g.r(l);for(fF=h.next();!fF.done;fF=h.next())(W=fF.value)&&(U[W.key]=W);HI=g.r(M);for(bt=HI.next();!bt.done;bt=HI.next())(mI=bt.value)&&(w[mI.key]=mI);BA=g.r(Y);for(f_=BA.next();!f_.done;f_=BA.next())nF=f_.value,
wk=void 0,V[(wk=nF.videoItem)!=null?wk:""]=!0,nF.videoItem&&(B=Tz=void 0,Ah=(B=(Tz=g.hR(nF.videoItem))==null?void 0:Tz.entityId)!=null?B:"",u.push({externalVideoId:Ah}));ew=X.filter(function(MV){if(!MV||!MV.key||!MV.offlineVideoPolicy)return!1;MV=g.hR(MV.key).entityId;MV=g.zj(MV,"downloadStatusEntity");var PI;return!(MV&&((PI=U[MV])==null?void 0:PI.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
jx=ew.map(function(MV){var PI=Z[MV.transfer],$K=[];if(PI==null?0:PI.offlineVideoStreams)for(var FW=g.r(PI.offlineVideoStreams),n=FW.next();!n.done;n=FW.next())(n=w[n.value])&&$K.push(n);FW=H[MV.offlineVideoPolicy];n=V;var F=MV==null?void 0:MV.playerResponseTimestamp,Q=g.hR(FW.key).entityId;MV=g.zj(Q,"mainVideoEntity");if(FW.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var L="OFFLINE_VIDEO_STATE_DISABLED";FW.expirationTimestamp&&Number(FW.expirationTimestamp)<Date.now()/1E3&&(L="OFFLINE_VIDEO_STATE_EXPIRED")}else if(FW.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")L="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(PI==null?void 0:PI.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":L="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":L="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":L="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":L="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":L="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":L="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:L="OFFLINE_VIDEO_STATE_UNKNOWN"}if(L==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(PI==null?void 0:PI.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":L="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":L="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":L=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}Q={id:Q,videoState:L};if(PI==null?0:PI.cotn)Q.cotn=PI.cotn;if(PI==null?0:PI.maximumDownloadQuality)Q.selectedVideoQuality=PI==null?void 0:PI.maximumDownloadQuality;if(PI==null?0:PI.lastProgressTimeMs)Q.lastProgressTimeMs=PI.lastProgressTimeMs;F&&(Q.playerResponseSavedTimeMs=String(Number(F)*1E3));PI=String;F=0;$K=g.r($K);for(L=$K.next();!L.done;L=$K.next())if(L=L.value,L.streamsProgress){L=g.r(L.streamsProgress);for(var N=L.next();!N.done;N=L.next()){var U0=void 0;
F+=Number((U0=N.value.numBytesDownloaded)!=null?U0:0)}}Q.downloadedBytes=PI(F);Q.selectedOfflineMode=n[MV]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";FW.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(Q.offlinePlaybackDisabledReason=FW.offlinePlaybackDisabledReason);return Q});
return n_.return({offlineVideos:jx,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:u}}})})},PNw=function(){this.locks=navigator.locks},IFN=function(){try{var z=g.xw("ytglobal.locks_");
if(z)return z;var t;if(t=navigator){var Y=navigator;t="locks"in Y&&!!Y.locks}if(t)return g.eP.localStorage&&g.eP.localStorage.getItem("noop"),z=new PNw,g.dk("ytglobal.locks_",z),z}catch(K){}},Yk=function(){},aFz=function(){},gAV=function(z){if(z.includes(":"))throw Error("Invalid user cache name: "+z);
return z+":"+g.WL("CacheStorage get")},JJj=function(){return g.P(function(z){if(Ku!==void 0)return z.return(Ku);
Ku=new Promise(function(t){var Y;return g.P(function(K){switch(K.J){case 1:return g.rk(K,2),g.c(K,TF.open("test-only"),4);case 4:return g.c(K,TF.delete("test-only"),5);case 5:g.BI(K,3);break;case 2:if(Y=g.VJ(K),Y instanceof Error&&Y.name==="SecurityError")return t(!1),K.return();case 3:t("caches"in window),g.pF(K)}})});
return z.return(Ku)})},NuQ=function(){return g.P(function(z){if(z.J==1)return g.c(z,JJj(),2);
if(!z.K)return z.return(void 0);mJz||(mJz=new aFz);return z.return(mJz)})},GF=function(z,t,Y){g.aO(new g.E$("Woffle: "+z,Y?{cotn:Y}:""));
t instanceof Error&&g.aO(t)},yJF=function(z){var t;
return g.P(function(Y){if(Y.J==1)return g.c(Y,LJN(z),2);t=Y.K;g.Dw("offlineStateSnapshot",t);g.pF(Y)})},vB=function(z){g.I.call(this);
var t=this;this.api=z;this.EG={BDK:function(){return t.K},
R10:function(){return t.J}};
typeof g.eP.BroadcastChannel!=="undefined"&&(this.K=new g.eP.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.WL()),this.K.onmessage=this.L.bind(this),this.J=new g.eP.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.WL()),this.J.onmessage=this.W.bind(this))},AT=function(z,t){z.api.G5("onOfflineOperationFailure",t);
var Y;(Y=z.K)==null||Y.postMessage(t)},eLW=function(z,t,Y,K){var T=this;
this.B=z;this.V=t;this.visibility=Y;this.X=K;this.U=this.C=this.N=this.L=this.K=!1;this.W=new g.R0(function(){T.RL()});
this.EG={yC:function(){return T.J},
RL:function(){T.RL()},
E85:function(){return T.W}};
this.visibility.subscribe("visibilitystatechange",function(){T.JW()})},dJw=function(z){if(!z.L&&!z.K){var t=IFN();
if(t){z.L=!0;var Y=g.WL("OfflineLockManager");t.request("woffle_orchestration_leader:"+Y,{},function(){var K,T,G,v;return g.P(function(f){switch(f.J){case 1:return g.rk(f,2),z.J=new g.DM,z.K=!0,z.L=!1,g.c(f,z.B(),4);case 4:return g.c(f,z.J.promise,5);case 5:g.BI(f,0);break;case 2:K=g.VJ(f),((G=(T=z).X)==null?0:G.call(T,"wo_relinquish_leadership_on_lock_request_error"))||z.RL(),K instanceof Error&&(v=K,v.args=[{name:"WoLockManagerError",U$:K.name}],g.IO(v)),g.pF(f)}})})}}},xJz=function(z){z.K&&(z.U=
!0,fu(z))},SvA=function(z,t){z.K&&(z.N=t,fu(z))},EAQ=function(z,t){z.K&&(z.C=t,fu(z))},fu=function(z){z.C&&z.N&&z.U&&z.visibility.isBackground()?g.h0(z.W,6E4):z.W.stop()},Cu=function(z){var t;
z.offlineDeleteReason=(t=z.offlineDeleteReason)!=null?t:"OFFLINE_DELETE_REASON_UNKNOWN";var Y;z.offlineModeType=(Y=z.offlineModeType)!=null?Y:"OFFLINE_NOW";g.Dw("offlineDeleteEvent",z)},Xd=function(z,t){var Y=t.videoId;
var K=t.Jn;t=t.offlineModeType;z.encryptedVideoId=Y;z.cotn=K==null?void 0:K.cotn;z.offlineabilityFormatType=K==null?void 0:K.maximumDownloadQuality;var T;z.isRefresh=(T=K==null?void 0:K.isRefresh)!=null?T:!1;var G;z.softErrorCount=(G=K==null?void 0:K.transferRetryCount)!=null?G:0;z.offlineModeType=t!=null?t:"OFFLINE_NOW";(z.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&z.statusType==="UNKNOWN_STATUS_TYPE"||!z.transferStatusType&&!z.statusType)&&g.aO(Error("Woffle unknown transfer status"));
g.Dw("offlineTransferStatusChanged",z)},WJF=function(z){Xd({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},z)},RL_=function(z,t,Y,K){K={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!K};t&&Y&&(t=Math.floor(t/1024).toFixed(),Y=Math.floor(Y/1024).toFixed(),K.alreadyDownloadedKbytes=t,K.totalFetchedKbytes=t,K.totalContentKbytes=Y);Xd(K,z)},hLA=function(z){Xd({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},z)},zY2=function(z){Xd({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},z)},tZN=function(z){switch(z){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
im=function(z){var t,Y,K;
return((K=(t=z.actionMetadata)==null?void 0:(Y=t.retryScheduleIntervalsInSeconds)==null?void 0:Y.length)!=null?K:0)>0},Oc=function(z){return z.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!z.entityKey},sc=function(z){return z.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!z.entityKey},D4=function(z){return z.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!z.entityKey},YDA=function(z){return z.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!z.entityKey},
MC=function(z,t,Y,K,T){T=T===void 0?!1:T;
var G,v,f,C,X,O;return g.P(function(D){if(D.J==1)return G=g.zj(z,t),v=g.zj(z,"downloadStatusEntity"),g.c(D,WY(Y,{mode:"readonly",bW:!0},function(M){return g.nb.all([NW(M,G,t),NW(M,v,"downloadStatusEntity")])}),2);
f=D.K;C=f.length?f[0]:void 0;if(!C)return D.H0(0);X=KaK;if(O=f.length>1?f[1]:void 0){if(O.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!T)return D.return();O.downloadState=K}else O={key:v,downloadState:K};g.yj(C,X,O);return g.c(D,WY(Y,{mode:"readwrite",bW:!0},function(M){return g.nb.all([dv(M,C,t),dv(M,O,"downloadStatusEntity")])}),0)})},lm=function(z,t){return z.actionType===t.actionType&&z.entityKey===t.entityKey},Z4=function(z,t){if(z&&z.transferState!=="TRANSFER_STATE_COMPLETE"&&z.transferState!==
"TRANSFER_STATE_FAILED"){var Y=g.hR(z.key).entityId;
Xd({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:Y,Jn:z,offlineModeType:t})}},qC=function(z){if(!z||!z.thumbnails)return[];
var t=[];z=g.r(z.thumbnails);for(var Y=z.next();!Y.done;Y=z.next())Y=Y.value,Y.url&&t.push(Y.url);return t},TGW=function(z,t,Y){Y=Y===void 0?[]:Y;
var K,T,G,v,f,C,X,O,D,M,l,Z,H;return g.P(function(U){if(U.J==1)return Y.length?g.c(U,zF(z,t),2):U.return([]);K=U.K;T=new Set;G=g.r(K);for(v=G.next();!v.done;v=G.next())if(f=v.value,C=f.id||f.key)X=g.hR(C).entityId,T.add(X);O=[];D=g.r(Y);for(M=D.next();!M.done;M=D.next())l=M.value,Z=l.offlineVideoData,H=void 0,((H=Z)==null?0:H.videoId)&&!T.has(Z.videoId)&&O.push(l);return U.return(O)})},GkV=function(z,t,Y){return new g.mv(z,{cotn:t,
raw_player_response:Y,download_media:!0,start:Infinity,disable_watch_next:!0})},v7w=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},pu=function(z,t,Y,K,T,G,v,f,C,X,O){this.entityType=z;
this.actionId=t;this.action=Y;this.parentActionId=K;this.rootActionId=T===void 0?t:T;this.childActionIds=G;this.prereqActionId=v;this.postreqActionIds=f;this.hasChildActionFailed=X;this.retryScheduleIndex=0;this.K=O||Date.now();this.retryScheduleIndex=C||0},rQ=function(z){if(!z.key)throw Error("Entity key is required.");
if(!z.actionProto)throw Error("OfflineOrchestrationAction is required.");var t=g.hR(z.key),Y=g.hR(z.actionProto.entityKey);return new pu(Y.entityType,t.entityId,z.actionProto,z.parentActionId,z.rootActionId,z.childActionIds,z.prereqActionId,z.postreqActionIds,z.retryScheduleIndex,z.hasChildActionFailed,Number(z.enqueueTimeSec)*1E3)},HB=function(z){return{key:g.zj(z.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:z.action,parentActionId:z.parentActionId,rootActionId:z.rootActionId,childActionIds:z.childActionIds,prereqActionId:z.prereqActionId,postreqActionIds:z.postreqActionIds,retryScheduleIndex:z.retryScheduleIndex,hasChildActionFailed:z.hasChildActionFailed,enqueueTimeSec:(z.K/1E3).toFixed()}},ANQ=function(){var z;
return g.P(function(t){return t.J==1?g.c(t,NuQ(),2):(z=t.K)?t.return(z.delete("yt-player-local-img")):t.return(!0)})},jA=function(z){var t,Y;
return g.P(function(K){if(K.J==1)return g.c(K,NuQ(),2);if(K.J!=3){t=K.K;if(!t)throw Error("Cache API not supported");return z.length?g.c(K,t.open("yt-player-local-img"),3):K.return()}Y=K.K;return g.c(K,Promise.all(z.map(function(T){return Y.delete(T)})),0)})},Uc=function(z){var t,Y;
return g.P(function(K){if(K.J==1)return g.c(K,NuQ(),2);if(K.J!=3){t=K.K;if(!t)throw Error("Cache API not supported");return z.length?g.c(K,t.open("yt-player-local-img"),3):K.return()}Y=K.K;return g.c(K,Y.addAll(z),0)})},BB=function(z,t,Y,K,T){var G,v,f,C,X,O,D,M,l,Z,H,U,w,V,u,k,J,E,d,Yw,TE,h,fF,W,HI,bt,mI,BA,f_,nF,wk;
return g.P(function(Tz){switch(Tz.J){case 1:return G=g.zj(z,"mainVideoEntity"),v=g.zj(z,"ytMainChannelEntity"),f=g.zj(z,"transfer"),C=g.zj(z,"videoDownloadContextEntity"),g.c(Tz,WY(t,{mode:"readonly",bW:!0},function(B){return g.nb.all([NW(B,G,"mainVideoEntity"),NW(B,v,"ytMainChannelEntity"),NW(B,f,"transfer"),NW(B,C,"videoDownloadContextEntity"),yM(B,"ytMainChannelEntity"),yM(B,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:X=Tz.K;O=g.r(X);D=O.next().value;M=O.next().value;l=O.next().value;Z=O.next().value;H=O.next().value;U=O.next().value;w=D;V=M;u=l;k=Z;J=H;E=U;if(!w&&!V){Tz.H0(3);break}d=w?qC(w.thumbnail):[];if(!V){Yw=[];Tz.H0(4);break}return g.c(Tz,fMj(V,J),5);case 5:Yw=Tz.K;case 4:return TE=Yw,g.c(Tz,jA(d.concat(TE)),3);case 3:h=[];fF=g.zj(z,"downloadStatusEntity");W=g.r(E);for(HI=W.next();!HI.done;HI=W.next())bt=HI.value,mI=g.hR(bt.key).entityId,BA=rQ(bt),f_=g.hR(BA.action.entityKey).entityId,mI!==z&&f_!==
z||lm(Y,bt.actionProto)||h.push(bt.key);return g.c(Tz,WY(t,{mode:"readwrite",bW:!0},function(B){var Ah=h.map(function(ew){return xC(B,ew)});
Ah.push(xC(B,G,{Zr:!0}));Ah.push(xC(B,fF,{Zr:!0}));return g.nb.all(Ah)}),7);
case 7:wk=(nF=k)==null?void 0:nF.offlineModeType,T&&(Cu(T),T.offlineModeType&&(wk=T.offlineModeType)),Z4(u,wk),AT(K,{entityKey:G,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.pF(Tz)}})},iI_=function(z,t,Y,K){var T,G,v,f,C,X,O,D,M,l,Z,H,U,w,V,u,k,J,E,d,Yw,TE,h,fF,W,HI,bt,mI,BA,f_,nF,wk,Tz,B,Ah,ew,jx,n_,MV,PI,$K,FW,n,F,Q,L,N,U0,th,qq;
return g.P(function(KF){switch(KF.J){case 1:return T=g.zj(z,"mainPlaylistEntity"),G=g.zj(z,"ytMainChannelEntity"),g.c(KF,WY(t,{mode:"readonly",bW:!0},function(QJ){return g.nb.all([NW(QJ,T,"mainPlaylistEntity"),NW(QJ,G,"ytMainChannelEntity"),yM(QJ,"mainPlaylistEntity"),yM(QJ,"mainDownloadsListEntity"),yM(QJ,"ytMainChannelEntity"),yM(QJ,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:v=KF.K;f=g.r(v);C=f.next().value;X=f.next().value;O=f.next().value;D=f.next().value;M=f.next().value;l=f.next().value;Z=C;H=X;U=O;w=D;V=M;u=l;if(!Z&&!H){KF.H0(3);break}k=Z?Cg_(Z):[];if(!H){J=[];KF.H0(4);break}return g.c(KF,fMj(H,V),5);case 5:J=KF.K;case 4:return E=J,g.c(KF,jA(k.concat(E)),3);case 3:d=[];Yw=new Map;if(!Z){KF.H0(7);break}return g.c(KF,XOz(Z,U,w),8);case 8:d=KF.K;TE=g.r(d);for(h=TE.next();!h.done;h=TE.next())fF=h.value,Yw.set(fF,{videoId:fF,playlistId:z,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.c(KF,WY(t,{mode:"readonly",bW:!0},function(QJ){return g.nb.all([yM(QJ,"transfer"),yM(QJ,"videoDownloadContextEntity")])}),9);
case 9:W=KF.K;HI=g.r(W);bt=HI.next().value;mI=HI.next().value;BA=bt;f_=mI;nF=g.r(BA);for(wk=nF.next();!wk.done;wk=nF.next())Tz=wk.value,B=g.hR(Tz.key).entityId,(Ah=Yw.get(B))&&Tz&&(Ah.cotn=Tz.cotn);ew=g.r(f_);for(jx=ew.next();!jx.done;jx=ew.next())n_=jx.value,MV=g.hR(n_.key).entityId,(PI=Yw.get(MV))&&n_&&(PI.offlineModeType=n_.offlineModeType);case 7:$K=[];FW=g.r(u);for(n=FW.next();!n.done;n=FW.next())F=n.value,Q=g.hR(F.key).entityId,L=rQ(F),Q!==z&&L.rootActionId!==z||lm(Y,F.actionProto)||$K.push(F.key);
N=g.zj(z,"mainPlaylistEntity");return g.c(KF,WY(t,{mode:"readwrite",bW:!0},function(QJ){var E0=$K.map(function(jw){return xC(QJ,jw)});
E0.push(xC(QJ,N,{Zr:!0}));return g.nb.all(E0)}),10);
case 10:if(!Z){KF.H0(0);break}d.reverse();if(!d){KF.H0(0);break}U0=g.r(d);th=U0.next();case 13:if(th.done){KF.H0(0);break}qq=th.value;return g.c(KF,BB(qq,t,Y,K,Yw.get(qq)),14);case 14:th=U0.next(),KF.H0(13)}})},sVA=function(z,t,Y,K){var T,G,v,f,C,X,O,D,M;
return g.P(function(l){if(l.J==1)return T=g.zj("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),G=new Map,g.c(l,WY(z,{mode:"readwrite",bW:!0},function(Z){var H=yM(Z,"transfer"),U=yM(Z,"offlineOrchestrationActionWrapperEntity"),w=yM(Z,"videoDownloadContextEntity"),V=NW(Z,T,"mainDownloadsListEntity");return g.nb.all([H,U,w,V]).then(function(u){u=g.r(u);var k=u.next().value;var J=u.next().value;var E=u.next().value;var d=u.next().value;u=OI$.map(function(TE){return AJ2(Z,TE)});
J=g.r(J);for(var Yw=J.next();!Yw.done;Yw=J.next())Yw=Yw.value,lm(t,Yw.actionProto)||u.push(xC(Z,Yw.key,{Zr:!0}));d&&(d.downloads=[],u.push(dv(Z,d,"mainDownloadsListEntity")));if(E)for(E=g.r(E),d=E.next();!d.done;d=E.next())d=d.value,J=g.hR(d.key).entityId,J=g.zj(J,"transfer"),G.set(J,d.offlineModeType);return g.nb.all(u).then(function(){return k})})}),2);
v=l.K;f=g.r(v);for(C=f.next();!C.done;C=f.next())X=C.value,Z4(X,G.get(X.key)),O=g.hR(X.key).entityId,D={videoId:O,offlineDeleteReason:K,cotn:X.cotn,offlineModeType:G.get(X.key)},Cu(D),M=g.zj(O,"mainVideoEntity"),AT(Y,{entityKey:M,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.c(l,ANQ(),0)})},Cg_=function(z,t){var Y=[];
if(z.thumbnailStyleData){z=g.r(z.thumbnailStyleData);for(var K=z.next();!K.done;K=z.next()){var T=void 0,G=void 0,v=void 0;Y=Y.concat(qC((T=K.value)==null?void 0:(G=T.value)==null?void 0:(v=G.collageThumbnail)==null?void 0:v.coverThumbnail))}}t=qC(t);return Y.concat(t)},XOz=function(z,t,Y){var K,T,G,v,f,C,X,O,D,M,l,Z,H,U,w,V,u,k,J,E,d,Yw,TE;
return g.P(function(h){K=[];T=new Set;if(Y.length)for(G=g.r(Y),v=G.next();!v.done;v=G.next())if(f=v.value,C=void 0,(C=f.downloads)==null?0:C.length)for(X=g.r(f.downloads),O=X.next();!O.done;O=X.next())D=O.value,D.videoItem&&(M=g.hR(D.videoItem).entityId,T.add(M));if(z.videos){l=g.r(z.videos);for(Z=l.next();!Z.done;Z=l.next())H=Z.value,U=JSON.parse(g.hR(H).entityId),U.videoId&&!T.has(U.videoId)&&K.push(U.videoId);w=g.r(t);for(V=w.next();!V.done;V=w.next())if(u=V.value,u.key!==z.key&&(k=u.videos))for(J=
g.r(k),E=J.next();!E.done;E=J.next())d=E.value,Yw=JSON.parse(g.hR(d).entityId),Yw.videoId&&(TE=K.indexOf(Yw.videoId),TE!==-1&&K.splice(TE,1))}return h.return(K)})},fMj=function(z,t){var Y,K,T,G,v,f,C,X;
return g.P(function(O){Y=qC(z.avatar);K=g.r(t);for(T=K.next();!T.done;T=K.next())if(G=T.value,G.id!==z.id)for(v=g.r(qC(G.avatar)),f=v.next();!f.done;f=v.next())C=f.value,X=Y.indexOf(C),X!==-1&&Y.splice(X,1);return O.return(Y)})},DZQ=function(z){var t;
return g.P(function(Y){t=g.m(z.frameworkUpdates,wQ);return z.frameworkUpdates&&t?g.c(Y,rJz(t),0):Y.return()})},lMw=function(z){var t;
if((t=z.onResponseReceivedActions)!=null&&t.length){var Y;z=(Y=g.m(g.m(z.onResponseReceivedActions[0],MZj),g.Vxz))==null?void 0:Y.actions;if(z!=null&&z.length)return z}},ZIA=function(z){var t,Y,K;
return g.P(function(T){if(T.J==1)return z?g.c(T,hP(z,g.op,"mainDownloadsListEntity"),2):T.return([]);t=T.K;return((Y=t)==null?0:(K=Y.downloads)==null?0:K.length)?T.return(t.downloads.map(function(G){var v;return(v=G.videoItem)!=null?v:""})):T.return([])})},pOV=function(z,t){var Y;
return g.P(function(K){return K.J==1?g.c(K,qDF(z,t),2):(Y=K.K)?g.c(K,WY(z,{mode:"readwrite",bW:!0},function(T){var G=[dv(T,Y.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];Y.mainDownloadsListEntity&&G.push(dv(T,Y.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.nb.all(G)}),0):K.H0(0)})},qDF=function(z,t){var Y,K,T,G,v,f,C,X,O,D,M,l,Z,H,U,w,V,u;
return g.P(function(k){if(k.J==1)return Y=g.zj("main_downloads_library_id","mainDownloadsLibraryEntity"),K=g.zj("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.c(k,WY(z,{mode:"readonly",bW:!0},function(J){return g.nb.all([NW(J,Y,"mainDownloadsLibraryEntity"),NW(J,K,"mainDownloadsListEntity")])}),2);
T=k.K;G=g.r(T);v=G.next().value;f=G.next().value;C=v;X=f;C||(C={id:Y});O=g.r(t);for(D=O.next();!D.done;D=O.next())if(M=D.value,M===g.op){if(C.smartDownloadsList)return k.return();C.smartDownloadsList=M}else if(l=g.hR(M).entityType,Z={},l==="mainPlaylistEntity"?Z.playlistItem=M:l==="mainVideoEntity"&&(Z.videoItem=M),!g.EN(Z)){H=void 0;if((H=X)==null?0:H.downloads){U=!1;w=g.r(X.downloads);for(V=w.next();!V.done;V=w.next())if(u=V.value,u.playlistItem===M||u.videoItem===M){U=!0;break}U||X.downloads.push(Z)}else X=
{id:K,downloads:[Z]};C.downloadsList=K}return k.return({mainDownloadsLibraryEntity:C,mainDownloadsListEntity:X})})},rN$=function(z,t){var Y,K,T,G,v,f,C,X,O,D,M,l,Z,H,U;
return g.P(function(w){if(w.J==1)return Y=g.zj("main_downloads_library_id","mainDownloadsLibraryEntity"),K=g.zj("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.c(w,WY(z,{mode:"readonly",bW:!0},function(V){return g.nb.all([NW(V,Y,"mainDownloadsLibraryEntity"),NW(V,K,"mainDownloadsListEntity"),NW(V,g.op,"mainDownloadsListEntity")])}),2);
T=w.K;G=g.r(T);v=G.next().value;f=G.next().value;C=G.next().value;X=v;O=f;D=C;if(!X)return w.H0(0);if(t===g.op&&((M=D)==null?0:M.downloads))D.downloads=[];else if((l=O)==null?0:l.downloads)for(Z=g.hR(t).entityType,H=0;H<O.downloads.length;H++)if(U=O.downloads[H],Z==="mainVideoEntity"&&U.videoItem===t){O.downloads.splice(H,1);break}else if(Z==="mainPlaylistEntity"&&U.playlistItem===t){O.downloads.splice(H,1);break}return g.c(w,WY(z,{mode:"readwrite",bW:!0},function(V){var u=[dv(V,X,"mainDownloadsLibraryEntity")];
O&&u.push(dv(V,O,"mainDownloadsListEntity"));D&&u.push(dv(V,D,"mainDownloadsListEntity"));return g.nb.all(u)}),0)})},bm=function(z,t){var Y,K,T,G,v,f,C,X,O,D,M;
return g.P(function(l){if(l.J==1)return Y=g.zj(t,"transfer"),K=g.zj(t,"videoDownloadContextEntity"),g.c(l,WY(z,{mode:"readonly",bW:!0},function(Z){return g.nb.all([NW(Z,Y,"transfer"),NW(Z,K,"videoDownloadContextEntity")])}),2);
T=l.K;G=g.r(T);v=G.next().value;f=G.next().value;C=v;X=f;M={videoId:t,cotn:(O=C)==null?void 0:O.cotn,offlineModeType:(D=X)==null?void 0:D.offlineModeType};return l.return(M)})},V9=function(z,t,Y,K,T){var G,v,f,C,X,O,D,M,l,Z,H,U,w,V,u,k,J,E,d,Yw;
return g.P(function(TE){switch(TE.J){case 1:return G=g.zj(z,"musicTrack"),v=g.zj(z,"transfer"),g.c(TE,WY(t,{mode:"readonly",bW:!0},function(h){return g.nb.all([NW(h,G,"musicTrack"),NW(h,v,"transfer"),yM(h,"musicTrack"),yM(h,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:f=TE.K;C=g.r(f);X=C.next().value;O=C.next().value;D=C.next().value;M=C.next().value;l=X;Z=O;H=D;U=M;if(!l){TE.H0(3);break}return g.c(TE,HIF(l,H),4);case 4:return w=TE.K,g.c(TE,jA(w),3);case 3:V=[];u=g.r(U);for(k=u.next();!k.done;k=u.next())J=k.value,E=g.hR(J.key).entityId,d=rQ(J),Yw=g.hR(d.action.entityKey).entityId,E!==z&&Yw!==z||lm(Y,J.actionProto)||V.push(J.key);return g.c(TE,WY(t,{mode:"readwrite",bW:!0},function(h){var fF=V.map(function(W){return xC(h,W)});
fF.push(xC(h,G,{Zr:!0}));return g.nb.all(fF)}),6);
case 6:Z4(Z),T&&Cu(T),AT(K,{entityKey:G,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.pF(TE)}})},nu=function(z,t,Y,K,T){var G,v,f,C,X,O,D,M,l,Z,H,U,w,V,u,k,J,E,d,Yw,TE,h,fF,W,HI,bt,mI,BA,f_,nF,wk,Tz,B,Ah,ew,jx;
return g.P(function(n_){switch(n_.J){case 1:return G=g.zj(z,t),v=g.zj("music_downloads_library_id","musicDownloadsLibraryEntity"),g.c(n_,WY(Y,{mode:"readonly",bW:!0},function(MV){return g.nb.all([NW(MV,G,t),NW(MV,v,"musicDownloadsLibraryEntity"),yM(MV,t),yM(MV,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:f=n_.K;C=g.r(f);X=C.next().value;O=C.next().value;D=C.next().value;M=C.next().value;l=X;Z=O;H=D;U=M;if(!l){n_.H0(3);break}return g.c(n_,HIF(l,H),4);case 4:return w=n_.K,g.c(n_,jA(w),3);case 3:V=[];u=new Map;if(!l){n_.H0(6);break}return g.c(n_,jVj(l,H,Z),7);case 7:V=n_.K;k=g.r(V);for(J=k.next();!J.done;J=k.next())E=J.value,d=g.hR(E).entityId,u.set(d,{videoId:d,playlistId:z,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.c(n_,zF(Y,"transfer"),8);case 8:for(Yw=n_.K,TE=
g.r(Yw),h=TE.next();!h.done;h=TE.next())fF=h.value,W=g.hR(fF.key).entityId,(HI=u.get(W))&&fF&&(HI.cotn=fF.cotn);case 6:bt=[];mI=g.r(U);for(BA=mI.next();!BA.done;BA=mI.next())f_=BA.value,nF=g.hR(f_.key).entityId,wk=rQ(f_),nF!==z&&wk.rootActionId!==z||lm(K,f_.actionProto)||bt.push(f_.key);Tz=g.zj(z,t);return g.c(n_,WY(Y,{mode:"readwrite",bW:!0},function(MV){var PI=bt.map(function($K){return xC(MV,$K)});
PI.push(xC(MV,Tz,{Zr:!0}));return g.nb.all(PI)}),9);
case 9:if(!l){n_.H0(0);break}V.reverse();if(!V.length){n_.H0(0);break}B=g.r(V);Ah=B.next();case 12:if(Ah.done){n_.H0(0);break}ew=Ah.value;jx=g.hR(ew).entityId;if(!jx){n_.H0(13);break}return g.c(n_,V9(jx,Y,K,T,u.get(jx)),13);case 13:Ah=B.next(),n_.H0(12)}})},Fd=function(z,t,Y){var K,T,G,v,f,C,X;
return g.P(function(O){if(O.J==1)return g.c(O,WY(z,{mode:"readwrite",bW:!0},function(D){var M=yM(D,"transfer"),l=yM(D,"offlineOrchestrationActionWrapperEntity");return g.nb.all([M,l]).then(function(Z){Z=g.r(Z);var H=Z.next().value;var U=Z.next().value;Z=UZQ.map(function(k){return AJ2(D,k)});
U=g.r(U);for(var w=U.next();!w.done;w=U.next()){w=w.value;var V=g.hR(w.actionProto.entityKey).entityType==="musicTrack",u=w.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";lm(t,w.actionProto)||V&&(!V||u)||Z.push(xC(D,w.key,{Zr:!0}))}return g.nb.all(Z).then(function(){return H})})}),2);
K=O.K;T=g.r(K);for(G=T.next();!G.done;G=T.next())v=G.value,Z4(v),f=g.hR(v.key).entityId,C={videoId:f,offlineDeleteReason:void 0,cotn:v.cotn},Cu(C),X=g.zj(f,"musicTrack"),AT(Y,{entityKey:X,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.c(O,ANQ(),0)})},BGN=function(z){for(var t,Y=g.r(z.additionalMetadatas),K=Y.next();!K.done;K=Y.next())K=K.value,K.offlineMusicVideoData&&(t=K.offlineMusicVideoData);
var T,G,v,f,C;return{id:g.zj(z.videoId,"musicTrack"),videoId:z.videoId,title:z.title,thumbnailDetails:z.thumbnail,lengthMs:String(Number(z.lengthSeconds)*1E3),albumTitle:(T=t)==null?void 0:T.releaseTitle,musicVideoType:(G=t)==null?void 0:G.musicVideoType,contentRating:{explicitType:(v=t)==null?void 0:v.explicitType},artistNames:((f=t)==null?void 0:f.byline)||((C=t)==null?void 0:C.channelName),downloadMetadata:g.zj(z.videoId,"musicTrackDownloadMetadataEntity")}},jVj=function(z,t,Y){var K,T,G,v,f,C,
X,O,D,M,l,Z,H,U,w,V,u,k;
return g.P(function(J){K=[];T=new Set;if((G=Y)==null?0:(v=G.downloadedTracks)==null?0:v.length)for(f=g.r(Y.downloadedTracks),C=f.next();!C.done;C=f.next())X=C.value,T.add(X);if(z.tracks){O=g.r(z.tracks);for(D=O.next();!D.done;D=O.next())M=D.value,T.has(M)||K.push(M);l=g.r(t);for(Z=l.next();!Z.done;Z=l.next())if(H=Z.value,H.id!==z.id&&(U=H.tracks))for(w=g.r(U),V=w.next();!V.done;V=w.next())u=V.value,k=K.indexOf(u),k!==-1&&K.splice(k,1)}return J.return(K)})},HIF=function(z,t){var Y,K,T,G,v,f,C,X;
return g.P(function(O){Y=qC(z.thumbnailDetails);K=g.r(t);for(T=K.next();!T.done;T=K.next())if(G=T.value,G.id!==z.id)for(v=g.r(qC(G.thumbnailDetails)),f=v.next();!f.done;f=v.next())C=f.value,X=Y.indexOf(C),X!==-1&&Y.splice(X,1);return O.return(Y)})},wOA=function(z,t){var Y,K,T,G,v,f,C,X,O;
return g.P(function(D){if(D.J==1)return Y=g.zj("music_downloads_library_id","musicDownloadsLibraryEntity"),g.c(D,hP(z,Y,"musicDownloadsLibraryEntity"),2);(K=D.K)||(K={id:Y});T=g.hR(t).entityType;T==="musicTrack"?(G=K.downloadedTracks)!=null&&G.includes(t)||(K.downloadedTracks=((v=K.downloadedTracks)!=null?v:[]).concat(t)):T==="musicPlaylist"?(f=K.downloadedPlaylists)!=null&&f.includes(t)||(K.downloadedPlaylists=((C=K.downloadedPlaylists)!=null?C:[]).concat(t)):T!=="musicAlbumRelease"||(X=K.downloadedAlbumReleases)!=
null&&X.includes(t)||(K.downloadedAlbumReleases=((O=K.downloadedAlbumReleases)!=null?O:[]).concat(t));return g.c(D,Rz(z,K,"musicDownloadsLibraryEntity"),0)})},bIw=function(z,t){var Y,K,T,G,v,f,C;
return g.P(function(X){if(X.J==1)return Y=g.zj("music_downloads_library_id","musicDownloadsLibraryEntity"),g.c(X,hP(z,Y,"musicDownloadsLibraryEntity"),2);K=X.K;if(!K)return X.H0(0);T=g.hR(t).entityType;T==="musicTrack"?G=K.downloadedTracks:T==="musicPlaylist"&&(G=K.downloadedPlaylists);if((v=G)==null?0:v.length)for(f=0;f<G.length;f++)if(C=G[f],C===t){G.splice(f,1);break}return g.c(X,Rz(z,K,"musicDownloadsLibraryEntity"),0)})},VZ2=function(z){var t=z.videos;
z=[];var Y=[];if(t){t=g.r(t);for(var K=t.next();!K.done;K=t.next()){var T=K.value.offlineVideoData.videoId;K=g.zj(T,"musicTrack");T=g.zj(T,"musicTrackDownloadMetadataEntity");z.push(K);Y.push(T)}}return{pw:z,oB:Y}},Q9=function(z,t,Y){t={track:BGN(t)};
Y&&(t.playlistId=Y);if(z=g.m(z.actionMetadata,n7F))t.maximumDownloadQuality=z.maximumDownloadQuality;return{musicTrackEntityActionMetadata:t}},QVW=function(z){var t,Y,K,T,G,v,f,C;
return g.P(function(X){switch(X.J){case 1:return t=g.fS(),Y=nA$(z),K=g.Tr(FaN),g.rk(X,2),G={t5:!0},g.c(X,g.Wo(t,Y,K,void 0,G),4);case 4:T=X.K;g.BI(X,3);break;case 2:v=g.VJ(X);if(v instanceof g.Gs)throw f="GetOffline network manager error: "+v.message,GF(f,v),Error(f);GF("GetOffline fetch request error",v);throw Error("GetOffline fetch request error");case 3:C=cB(T);if(!T)throw GF("Network request failed"),Error("Network request failed");if(C!==void 0)um(C);else if(!T.videos||!T.videos.length)throw GF("No data"),
Error("No data");return X.return(T.videos.map(function(O){return O.offlineVideoData}))}})},cNz=function(z){var t,Y,K,T,G,v,f,C;
return g.P(function(X){switch(X.J){case 1:return t=g.fS(),Y=FJN(z),K=g.Tr(FaN),g.rk(X,2),G={t5:!0},g.c(X,g.Wo(t,Y,K,void 0,G),4);case 4:T=X.K;g.BI(X,3);break;case 2:v=g.VJ(X);if(v instanceof g.Gs)throw f="GetOffline network manager error for playlist: "+v.message,GF(f,v),Error(f);GF("GetOffline fetch request error for playlist",v);throw Error("GetOffline fetch request error for playlist");case 3:C=cB(T);if(!T)throw GF("Network request failed for playlist"),Error("Network request failed for playlist");
if(C!==void 0)um(C,"playlist");else if(!T.playlists||!T.playlists.length)throw GF("No data for playlist"),Error("No data for playlist");return X.return(T.playlists.map(function(O){return O.offlinePlaylistData}))}})},kkN=function(z,t,Y,K){var T,G,v,f,C,X,O,D,M,l,Z,H,U,w,V,u,k,J,E,d,Yw,TE,h,fF,W,HI,bt,mI,BA,f_;
return g.P(function(nF){switch(nF.J){case 1:return g.c(nF,tT(),2);case 2:T=nF.K;if(!T)return nF.return([]);G=[];if((v=K)==null?0:v.length){G=K;nF.H0(3);break}return g.c(nF,zF(T,"mainPlaylistEntity"),4);case 4:G=nF.K;case 3:if(!G.length)return nF.return([]);f=[];C=Date.now()/1E3;X=g.r(G);O=X.next();case 5:if(O.done)return f.length?g.c(nF,ukW(f),10):nF.return([]);D=O.value;if(!D.downloadState){M=void 0;nF.H0(8);break}return g.c(nF,hP(T,D.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:M=
nF.K;case 8:l=M;Z=void 0;U=(H=(Z=D)==null?void 0:Z.entityMetadata)&&H.nextAutoRefreshIntervalSeconds?Number(H.nextAutoRefreshIntervalSeconds):NaN;w=Number.isNaN(U)?z:U;u=V=void 0;k=((V=l)==null?0:V.lastSyncedTimestampMillis)?Number((u=l)==null?void 0:u.lastSyncedTimestampMillis)/1E3:0;E=J=void 0;d=((J=l)==null?0:J.addedTimestampMillis)?Number((E=l)==null?void 0:E.addedTimestampMillis)/1E3:0;if(Y||!H||k+w<=C){Yw=[];TE=void 0;if((TE=D.videos)==null?0:TE.length)for(h=g.r(D.videos),fF=h.next();!fF.done;fF=
h.next())W=fF.value,HI=JSON.parse(g.hR(W).entityId),HI.videoId&&Yw.push(HI.videoId);bt="0";H&&(mI=void 0,bt=String(Number((mI=H.offlineLastModifiedTimestampSeconds)!=null?mI:0).toFixed()));BA={playlistId:D.playlistId,videoIds:Yw,offlineLastModifiedTimestamp:bt,autoSync:t,offlineDateAddedTimestamp:String(d.toFixed())};f.push(BA)}O=X.next();nF.H0(5);break;case 10:return f_=nF.K,nF.return(f_)}})},$ZN=function(){var z,t,Y,K,T;
return g.P(function(G){if(G.J==1)return g.c(G,tT(),2);if(G.J!=3)return(z=G.K)?g.c(G,zF(z,"refresh"),3):G.return(!1);t=G.K;if((Y=t[0])==null||!Y.refreshTime)return G.return(!1);K=Number(t[0].refreshTime);T=Date.now()/1E3;return G.return(isFinite(K)&&T>=K)})},La$=function(z,t){var Y,K,T;
return g.P(function(G){switch(G.J){case 1:return g.rk(G,2),g.c(G,o7W(z,t),4);case 4:return K=G.K,g.c(G,DZQ(K),5);case 5:Y=lMw(K);g.BI(G,3);break;case 2:T=g.VJ(G),GF("getAndProcessSmartDownloadsResponse request or processing error",T);case 3:return G.return(Y)}})},Pg$=function(z,t,Y,K){var T,G,v,f,C,X,O,D,M,l,Z,H,U,w,V,u,k,J,E,d,Yw,TE,h,fF,W,HI,bt,mI,BA,f_;
return g.P(function(nF){switch(nF.J){case 1:return g.c(nF,tT(),2);case 2:T=nF.K;if(!T)return nF.return([]);G=[];if((v=K)==null?0:v.length){G=K;nF.H0(3);break}return g.c(nF,zF(T,"musicPlaylist"),4);case 4:G=nF.K;case 3:if(!G.length)return nF.return([]);f=[];C=Date.now()/1E3;X=g.r(G);O=X.next();case 5:if(O.done)return f.length?g.c(nF,ukW(f),10):nF.return([]);D=O.value;M=void 0;Z=(l=(M=D)==null?void 0:M.entityMetadata)&&l.nextAutoRefreshIntervalSeconds?Number(l.nextAutoRefreshIntervalSeconds):NaN;H=
Number.isNaN(Z)?z:Z;w=U=0;V="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!D.downloadMetadata){nF.H0(8);break}return g.c(nF,hP(T,D.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:u=nF.K,J=k=void 0,U=Number((J=(k=u)==null?void 0:k.addedTimestampMillis)!=null?J:"0")/1E3,d=E=void 0,w=Number((d=(E=u)==null?void 0:E.lastModifiedTimestampMillis)!=null?d:"0")/1E3,TE=Yw=void 0,V=(TE=(Yw=u)==null?void 0:Yw.syncState)!=null?TE:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:h=void 0;if(Y||V!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!l||Number((h=l.lastSyncedTimestampSeconds)!=null?h:0)+H<=C){fF=[];W=void 0;if((W=D.tracks)==null?0:W.length)for(HI=g.r(D.tracks),bt=HI.next();!bt.done;bt=HI.next())mI=bt.value,fF.push(g.hR(mI).entityId);BA={playlistId:D.playlistId,videoIds:fF,offlineLastModifiedTimestamp:String(w.toFixed()),autoSync:t,offlineDateAddedTimestamp:String(U.toFixed())};f.push(BA)}O=X.next();nF.H0(5);break;case 10:return f_=nF.K,nF.return(f_)}})},o7W=function(z,t){var Y,K,T,G,v,f,C,X,O,D;
return g.P(function(M){switch(M.J){case 1:return Y=g.fS(),g.c(M,tT(),2);case 2:K=M.K;if(!K){M.H0(3);break}return g.c(M,LJN(K),4);case 4:T=M.K;case 3:var l=T;G={context:g.tW(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:z},offlineClientState:l,clientStateRequestData:{preferredFormatType:t}}}};v=g.Tr(IMK);g.rk(M,5);C={t5:!0};return g.c(M,g.Wo(Y,G,v,void 0,C),7);case 7:f=M.K;g.BI(M,6);break;case 5:X=g.VJ(M);if(X instanceof g.Gs)throw O=
"DPS network manager error for smart downloads: "+X.message,GF(O,X),Error(O);GF("DPS fetch request error for smart downloads",X);throw Error("DPS fetch request error for smart downloads");case 6:D=cB(f);if(f)D!==void 0&&um(D,"smart downloads");else throw GF("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return M.return(f)}})},g7$=function(z,t){var Y,K,T,G,v,f,C,X;
return g.P(function(O){switch(O.J){case 1:return Y=g.fS(),K={context:g.tW(),videoPlaybackPositionEntities:z,lastSyncTimestampUsec:t},T=g.Tr(aMw),g.rk(O,2),v={t5:!0},g.c(O,g.Wo(Y,K,T,void 0,v),4);case 4:G=O.K;g.BI(O,3);break;case 2:f=g.VJ(O);if(f instanceof g.Gs)throw C="VPPS network manager error: "+f.message,GF(C,f),Error(C);GF("VPPS fetch request error",f);throw Error("VPPS fetch request error");case 3:X=cB(G);if(G)X!==void 0&&um(X,"position sync");else throw GF("Network request failed for position sync"),
Error("Network request failed for position sync");return O.return(G)}})},mZz=function(z,t,Y){var K,T,G,v,f,C,X,O;
return g.P(function(D){switch(D.J){case 1:K=g.fS();var M=Y.refreshData,l=Y.isEnqueuedForExpiredStreamUrlRefetch,Z=Y.H4,H=Y.offlineSourceData,U=Y.mediaCapabilities,w={entityKey:z};M&&(w.refreshData=M);l&&(w.isExpiredStreamUrlRefetch=l);Z&&(w.downloadParameters=Z);H&&(w.offlineSourceData=H);M={context:g.Wy(t),signatureTimestamp:20223,videos:[w]};U&&(M.mediaCapabilities=U);T=M;G=g.Tr(JN$);g.rk(D,2);f={t5:!0};return g.c(D,g.Wo(K,T,G,void 0,f),4);case 4:v=D.K;g.BI(D,3);break;case 2:C=g.VJ(D);if(C instanceof
g.Gs)throw X="GetPDE network manager error: "+C.message,GF(X,C),Error(X);GF("GetPDE fetch request error",C);throw Error("GetPDE fetch request error");case 3:O=cB(v);if(v)O!==void 0&&um(O,"PDE");else throw GF("Network request failed for PDE"),Error("Network request failed for PDE");return D.return(v)}})},cB=function(z){var t;
return(t=z.errorMetadata)==null?void 0:t.status},um=function(z,t){t=t?" for "+t:"";
if(z===0)throw z="Empty response body"+t,GF(z),Error(z);z="Response with error"+t;GF(z);throw Error(z);},ukW=function(z){var t,Y,K,T,G,v,f,C;
return g.P(function(X){switch(X.J){case 1:return t=g.fS(),Y=Qa$(z),K=g.Tr(NGN),g.rk(X,2),G={t5:!0},g.c(X,g.Wo(t,Y,K,void 0,G),4);case 4:T=X.K;g.BI(X,3);break;case 2:v=g.VJ(X);if(v instanceof g.Gs)throw f="offlinePlaylistSyncCheck network manager error: "+v.message,GF(f,v),Error(f);GF("offlinePlaylistSyncCheck fetch request error",v);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:C=cB(T);if(!T)throw GF("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(C!==void 0)um(C,"playlist sync");else if(!T.offlinePlaylistSyncCheckDatas||!T.offlinePlaylistSyncCheckDatas.length)throw GF("No data for playlist sync"),Error("No data for playlist sync");return X.return(T.offlinePlaylistSyncCheckDatas.map(function(O){return O.offlinePlaylistSyncCheckData}))}})},kk=function(z){this.K=z},yNw=function(z,t){var Y,K,T,G,v,f;
return g.P(function(C){switch(C.J){case 1:Y=new Map,K=g.r(t),T=K.next();case 2:if(T.done){C.H0(4);break}G=T.value;v=Y;f=v.set;return g.c(C,z.J(G),5);case 5:f.call(v,G,C.K);T=K.next();C.H0(2);break;case 4:return C.return(Y)}})},$k=function(z,t,Y,K,T,G){t=g.zj(t,Y);
K=Object.assign({},G,{priority:K,retryScheduleIntervalsInSeconds:T});return{actionType:z,entityKey:t,actionMetadata:K}},oK=function(z,t,Y,K,T,G){this.status=z;
this.K=t;this.W=Y;this.J=K;this.L=T;this.downloadState=G},eYV=function(z,t,Y){this.K=z;
this.s4=t;this.L=Y},SDF=function(z,t){var Y,K,T,G,v,f,C,X,O;
return g.P(function(D){switch(D.J){case 1:return Y=t.entityKey,T=(K=g.m(t.actionMetadata,Lu))==null?void 0:K.isEnqueuedForExpiredStreamUrlRefetch,g.rk(D,2),G=void 0,g.c(D,dZj(z,t),4);case 4:G=D.K;g.rk(D,5);var M=(M=g.m(t.actionMetadata,Lu))?{maximumDownloadQuality:M.maximumDownloadQuality}:void 0;return g.c(D,mZz(Y,z.s4,{isEnqueuedForExpiredStreamUrlRefetch:T,H4:M,offlineSourceData:G}),7);case 7:v=D.K;g.BI(D,6,2);break;case 5:return g.VJ(D,2),f=im(t)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",GF("PDE handleAdd error"),D.return(PB(t,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",f,"DOWNLOAD_STATE_FAILED"));case 6:return g.c(D,xZ$(z,v,t),8);case 8:return D.return(PB(t,!0,v.orchestrationActions));case 2:return C=g.VJ(D),X="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",C instanceof g.HE&&C.type==="QUOTA_EXCEEDED"&&(X="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),GF("PDE handleAdd error"),D.return(PB(t,!1,void 0,X,O,"DOWNLOAD_STATE_FAILED"))}})},RYN=function(z,t){var Y,K,T,G,v,f,C,X,O,D,M,l,Z,H,U,w,V,u,k,J,E,d,Yw,TE;
return g.P(function(h){switch(h.J){case 1:return Y=t.entityKey,K=g.hR(Y).entityId,g.c(h,WY(z.K,{mode:"readonly",bW:!0},function(fF){var W=NW(fF,Y,"playbackData"),HI=NW(fF,g.zj(K,"offlineVideoPolicy"),"offlineVideoPolicy");fF=NW(fF,g.zj(K,"transfer"),"transfer");return g.nb.all([W,HI,fF])}),2);
case 2:T=h.K;G=g.r(T);v=G.next().value;f=G.next().value;C=G.next().value;X=v;O=f;D=C;if(!X||!O)return h.return(PB(t,!0));M=[];H=((Z=X)==null?0:Z.playerResponseJson)?JSON.parse(X.playerResponseJson):null;if(!(D&&H&&z.s4.X("html5_refresh_deprecated_downloads"))){h.H0(3);break}l=E7Q(z,H,D);return g.c(h,WaN(z,D),4);case 4:M=h.K;case 3:U={lastPlayerResponseTimestampSeconds:X.playerResponseTimestamp,offlineToken:O.offlineToken,formatIds:M};w={};if((V=D)==null?0:V.maximumDownloadQuality)w.maximumDownloadQuality=
D.maximumDownloadQuality;g.rk(h,5);u=void 0;return g.c(h,dZj(z,t),7);case 7:return u=h.K,g.rk(h,8),g.c(h,mZz(Y,z.s4,{refreshData:U,H4:w,offlineSourceData:u,mediaCapabilities:l}),10);case 10:k=h.K;g.BI(h,9,5);break;case 8:return g.VJ(h,5),J=im(t)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",GF("PDE handleRefresh error"),h.return(PB(t,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",J,"DOWNLOAD_STATE_FAILED"));
case 9:return g.c(h,xZ$(z,k,t),11);case 11:return h.return(PB(t,!0,k.orchestrationActions));case 5:return E=g.VJ(h),d="PDE handleRefresh error",E instanceof Error&&(d="PDE handleRefresh error: "+E.message),Yw="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",TE="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.HE&&E.type==="QUOTA_EXCEEDED"&&(Yw="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",TE="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),GF(d),h.return(PB(t,
!1,void 0,Yw,TE,"DOWNLOAD_STATE_FAILED"))}})},dZj=function(z,t){var Y,K,T,G;
return g.P(function(v){if(v.J==1)return Y=g.hR(t.entityKey).entityId,K=g.zj(Y,"videoDownloadContextEntity"),g.c(v,hP(z.K,K,"videoDownloadContextEntity"),2);T=v.K;return(G=T)!=null&&G.offlineModeType?v.return({offlineModeType:T.offlineModeType}):v.return(void 0)})},xZ$=function(z,t,Y){var K,T,G,v,f;
return g.P(function(C){if(C.J==1){if(!t.frameworkUpdates||!g.m(t.frameworkUpdates,wQ))return C.return();if(!(g.m(t.frameworkUpdates,wQ).mutations&&g.m(t.frameworkUpdates,wQ).mutations.length>0&&g.m(t.frameworkUpdates,wQ).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return C.H0(2);K=g.hR(g.m(t.frameworkUpdates,wQ).mutations[0].entityKey).entityId;return g.c(C,bm(z.K,K),3)}if(C.J!=2){T=C.K;G=g.m(Y.actionMetadata,Lu);if(f=(v=G)==null?void 0:v.playlistId)T.playlistId=f;T.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.Sn(z.s4)?g.c(C,BB(K,z.K,Y,z.L,T),2):g.Jf(z.s4)?g.c(C,V9(K,z.K,Y,z.L),2):C.H0(2)}return g.c(C,rJz(g.m(t.frameworkUpdates,wQ)),0)})},PB=function(z,t,Y,K,T,G){return new oK(t?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",im(z),Y,K,T,G)},E7Q=function(z,t,Y){t=GkV(z.s4,Y.cotn,t);
Y=g.G0(t);return g.d9F(t,Y,z.s4)},WaN=function(z,t){var Y,K,T,G,v,f,C,X,O,D,M;
return g.P(function(l){if(l.J==1)return Y=[],g.c(l,WY(z.K,{mode:"readonly",bW:!0},function(Z){var H=[],U=t.offlineVideoStreams;if(U){U=g.r(U);for(var w=U.next();!w.done;w=U.next())H.push(NW(Z,w.value,"offlineVideoStreams"))}return g.nb.all(H)}),2);
if(K=l.K)for(T=g.r(K),G=T.next();!G.done;G=T.next())if(v=G.value,f=void 0,(f=v)==null?0:f.streamsProgress)for(C=v.streamsProgress,X=0;X<C.length;X++)O=C[X],D=JSON.parse(O.formatStreamBytes),M={itag:D.itag,lmt:D.lastModified,xtags:D.xtags},Y.push(M);return l.return(Y)})},hYA=function(z,t){this.K=z;
this.s4=t},zPw=function(z,t){var Y,K,T,G,v,f,C,X,O,D,M,l;
return g.P(function(Z){switch(Z.J){case 1:return Y=im(t),g.c(Z,zF(z.K,"videoPlaybackPositionEntity"),2);case 2:K=Z.K;if(K.length===0)return Z.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));g.rk(Z,3);return g.c(Z,gv.getInstance(),5);case 5:T=Z.K;if(!T)throw Error("prefStorage is undefined");return g.c(Z,T.get("psi"),6);case 6:return G=Z.K,C=(f=(v=G)==null?void 0:v.rK)!=null?f:"0",g.c(Z,g7$(K,C),7);case 7:return X=Z.K,O={isPaused:X.watchHistoryPaused,rK:X.syncTimestampUsec},g.c(Z,T.set("psi",
O),8);case 8:if(O.isPaused){Z.H0(9);break}D=g.m(X.frameworkUpdates,wQ);if(!X.frameworkUpdates||!D){Z.H0(9);break}return g.c(Z,rJz(D),9);case 9:g.BI(Z,4);break;case 3:return M=g.VJ(Z),l="PPE handleRefresh error: "+(M instanceof Error?M.message:"unknown error"),GF(l),Z.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return Z.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},YVF=function(z,t){var Y,K,T,G,v,f,C,X;
return g.P(function(O){switch(O.J){case 1:return Y=im(t),K=g.hR(t.entityKey).entityId,g.rk(O,2),g.c(O,gv.getInstance(),4);case 4:T=O.K;if(!T)throw Error("prefStorage is undefined");return g.c(O,T.get("psi"),5);case 5:G=O.K;v=g.m(t.actionMetadata,td$);if(((f=G)==null?void 0:f.isPaused)!==!1||(C=v)==null||!C.lastPlaybackPositionSeconds){O.H0(6);break}X={key:g.zj(K,"videoPlaybackPositionEntity"),videoId:K,lastPlaybackPositionSeconds:v.lastPlaybackPositionSeconds};return g.c(O,Rz(z.K,X,"videoPlaybackPositionEntity"),
6);case 6:g.BI(O,3);break;case 2:return g.VJ(O),O.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return O.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y))}})},KdK=function(z,t){var Y,K,T;
return g.P(function(G){switch(G.J){case 1:Y=im(t);g.rk(G,2);K=g.hR(t.entityKey).entityId;if(K==="!*$_ALL_ENTITIES_!*$")return g.c(G,M$A(z.K),5);T=g.zj(K,"videoPlaybackPositionEntity");return g.c(G,DJN(z.K,T),5);case 5:g.BI(G,3);break;case 2:return g.VJ(G),G.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return G.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},Ts_=function(z,t){this.api=z;
this.K=t;this.logger=new g.Yv("woffle");this.J=!1;this.EG={W5:this.W5};this.logger.debug("Initialized OfflineMediaManager")},G8W=function(z){return g.P(function(t){return t.return(V$$(z))})},vi6=function(z){var t;
return g.P(function(Y){if(Y.J==1)return g.c(Y,g.MB0(z),2);t=Y.K;return Y.return(t.filter(function(K){return!!K.url}).map(function(K){return K.url}))})},IK=function(z,t){var Y=g.nm(t);
if(Y===1||Y===0)return Promise.resolve();(Y=A0$(z,t))&&Y.stopVideo();z.L=0;return G8W(t)},aK=function(z,t,Y,K){Y=Y===void 0?!1:Y;
K=K===void 0?!0:K;var T=typeof t==="string"?t:t.videoDetails.videoId;g.nm(T)===2&&((t=A0$(z,T))?t.stopVideo():z.logger.info(function(){return"Corresponding player for "+T+" not found. Pausing anyway"}),g.Ff(T,2),z.L=2,Y?fRK(z.K):K&&Cb_(z.K))},A0$=function(z,t){var Y;
return((Y=z.player)==null?void 0:Y.getVideoData().videoId)===t?z.player:null},XzW=function(z,t,Y){t.getPlayerResponse();
g.Ff(t.videoId,2);z.L=2;z.J=!1;var K;(K=z.player)==null||K.dispose();z.player=z.api.WB(t);t={};z.player.JH((t.localmediachange=z.Hq,t.signatureexpired=z.wO,t.statechange=z.lRt,t),z);var T=z.W5(Y);z.player.ya(g.fL(T,T,!0,"m"),!1);z.logger.debug(function(){return"Starting headless playback with quality: "+T});
z.player.d_(!1)},iT$=function(z,t){this.K=z;
this.s4=t},s06=function(z,t){var Y,K;
return g.P(function(T){switch(T.J){case 1:return Y=im(t),g.c(T,hP(z.K,t.entityKey,"transfer"),2);case 2:if(K=T.K)return T.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));g.rk(T,3);return g.c(T,OTz(z,t),5);case 5:g.BI(T,4);break;case 3:return g.VJ(T),T.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return T.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},DDA=function(z,t){var Y,K;
return g.P(function(T){switch(T.J){case 1:return Y=im(t),g.c(T,hP(z.K,t.entityKey,"transfer"),2);case 2:K=T.K;if(!K||K.transferState!=="TRANSFER_STATE_COMPLETE")return T.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));g.rk(T,3);return g.c(T,OTz(z,t,!0),5);case 5:g.BI(T,4);break;case 3:return g.VJ(T),T.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return T.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y))}})},Md$=function(z,t){var Y,K,T,G,v,f,C,X,O,D;
return g.P(function(M){switch(M.J){case 1:return Y=im(t),K=g.hR(t.entityKey).entityId,g.c(M,WY(z.K,{mode:"readonly",bW:!0},function(l){var Z=NW(l,t.entityKey,"transfer");l=NW(l,g.zj(K,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.nb.all([Z,l])}),2);
case 2:T=M.K;G=g.r(T);v=G.next().value;f=G.next().value;C=v;X=f;if(!C||C.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return M.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));g.rk(M,3);C.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.c(M,Rz(z.K,C,"transfer"),5);case 5:O=g.hR(C.key).entityId;hLA({videoId:O,Jn:C,offlineModeType:(D=X)==null?void 0:D.offlineModeType});g.BI(M,4);break;case 3:return g.VJ(M),M.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return M.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y))}})},OTz=function(z,t,Y){Y=Y===void 0?!1:Y;
var K,T,G,v,f,C,X,O,D,M,l,Z,H,U,w;return g.P(function(V){switch(V.J){case 1:return K=g.m(t.actionMetadata,lRQ),T=g.hR(t.entityKey).entityId,G=g.zj(T,"downloadStatusEntity"),g.c(V,WY(z.K,{mode:"readonly",bW:!0},function(u){var k=NW(u,G,"downloadStatusEntity");u=NW(u,g.zj(T,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.nb.all([k,u])}),2);
case 2:return v=V.K,f=g.r(v),C=f.next().value,X=f.next().value,O=C,D=X,M="TRANSFER_STATE_TRANSFER_IN_QUEUE",((l=O)==null?void 0:l.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(M="TRANSFER_STATE_PAUSED_BY_USER"),U={key:t.entityKey,transferState:M,cotn:g.Vr(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(Z=K)==null?void 0:Z.maximumDownloadQuality,preferredAudioTrack:(H=K)==null?void 0:H.preferredAudioTrack,transferRetryCount:0,isRefresh:Y,hasLoggedFirstStarted:!1},g.c(V,WY(z.K,
{mode:"readwrite",bW:!0},function(u){var k=[];Y&&k.push(xC(u,g.zj(T,"offlineVideoStreams")));k.push(dv(u,U,"transfer"));return g.nb.all(k)}),3);
case 3:if(!Y){V.H0(4);break}return g.c(V,G8W(T),4);case 4:WJF({videoId:T,Jn:U,offlineModeType:(w=D)==null?void 0:w.offlineModeType}),g.pF(V)}})},qVA=function(z,t,Y,K){if(!z.action.entityKey)throw Error("entityKey is missing.");
var T=g.hR(z.action.entityKey);T={entityType:T.Iq,entityId:T.entityId,offlineOrchestrationActionType:z.action.actionType,orchestrationAction:{orchestrationActionId:z.actionId}};t&&(T.offlineOrchestrationActionResult=t.status,T.isRetryable=Y?!1:t.K,t.L&&(T.offlineOrchestrationFailureReason=ZTw(t.L,T.isRetryable)));var G,v;if((G=z.action.actionMetadata)==null?0:(v=G.offlineLoggingData)==null?0:v.offlineModeType)T.offlineModeType=z.action.actionMetadata.offlineLoggingData.offlineModeType;K&&(T.additionalOrchestrationActions=
K.map(function(f){return{orchestrationActionId:f.actionId}}));
return T},ZTw=function(z,t){return z!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||t?z==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&t?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":z:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},pzW=function(z,t){var Y={offlineOrchestrationContext:qVA(z)};
t=$J2(t,Y);oA_(ku$(),t,z.rootActionId)},r0K=function(z,t,Y,K){K=K===void 0?[]:K;
t={offlineOrchestrationContext:qVA(z,t,Y,K)};t=$J2(3,t);oA_(ku$(),t,z.rootActionId)},HTA=function(){this.actions=[]},j0$=function(z,t){t=g.r(t);
for(var Y=t.next();!Y.done;Y=t.next())Y=Y.value,pzW(Y,1),z.actions.push(Y);z.actions.sort(z.K)},UDK=function(z,t){if(t)for(var Y=0;Y<z.actions.length;Y++)if(t==="!*$_ALL_ENTITIES_!*$"&&z.actions[Y].actionId!==t||t!=="!*$_ALL_ENTITIES_!*$"&&z.actions[Y].rootActionId===t&&z.actions[Y].actionId!==t)z.actions.splice(Y,1),Y--},Bs_=function(z,t){z=g.r(z.actions);
for(var Y=z.next();!Y.done;Y=z.next())if(Y.value.actionId===t)return!0;return!1},gQ=function(z,t,Y,K,T){g.I.call(this);
var G=this;this.J=z;this.eL=t;this.P0=Y;this.C=K;this.s4=T;this.K=new HTA;this.N=new g.RE;this.L=new g.R0(function(){G.retry()});
this.B=NaN;this.U=!1;this.EG={HrK:function(){return G.K},
oZ:function(){return G.N},
Zr6:function(){return G.L},
retry:function(){return G.retry()}};
g.a(this,this.L);this.V=this.J.observe(this.J3.bind(this))},Vd_=function(z,t,Y,K,T){var G;
return g.P(function(v){if(v.J==1)return G=new gQ(z,t,Y,K,T),g.c(v,wz6(G),2);bTN(G);return v.return(G)})},bTN=function(z){var t=z.K.actions[0];
return z.W?((t==null?void 0:t.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&z.W[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(z.U=!0),Promise.resolve()):ni_(z)},ni_=function(z){var t,Y,K,T,G,v,f,C,X,O,D,M,l,Z,H,U,w;
return g.P(function(V){switch(V.J){case 1:if(z.W)throw Error("Already processing an action");if(z.m6())return V.return();t=z.K.actions.shift();SvA(z.P0,!t);if(t===void 0)return V.return();t.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&t.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&UDK(z.K,t.actionId);Y="";t.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&t.rootActionId===t.actionId&&(Y=t.actionId);K=[t];z.W=K;if(T=z.eL[t.entityType]){V.H0(2);break}z.W=
void 0;return g.c(V,ni_(z),3);case 3:return V.return();case 2:G=g.r(K);for(v=G.next();!v.done;v=G.next())f=v.value,pzW(f,2);g.rk(V,4,5);return g.c(V,yNw(T,K.map(function(u){return u.action})),7);
case 7:C=V.K,X=g.r(K),O=X.next();case 8:if(O.done){V.H0(10);break}D=O.value;M=C.get(D.action);return g.c(V,FdA(z,D,M),9);case 9:O=X.next();V.H0(8);break;case 10:UDK(z.K,Y);case 5:g.Fu(V);z.W=void 0;g.cI(V,6);break;case 4:return l=g.VJ(V),GF("Orchestration error",l),g.rk(V,12),g.c(V,Q0F(z,K),14);case 14:g.BI(V,5);break;case 12:Z=g.VJ(V);GF("Orchestration retry error",Z);H=g.r(K);for(U=H.next();!U.done;U=H.next())w=U.value,w.retryScheduleIndex<3&&j0$(z.K,[w]);V.H0(5);break;case 6:return g.c(V,ni_(z),
0)}})},FdA=function(z,t,Y){var K,T,G,v,f,C,X,O,D,M,l,Z;
return g.P(function(H){switch(H.J){case 1:K=t.retryScheduleIndex+2===3;if(Y.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){H.H0(2);break}if(Y.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){H.H0(0);break}r0K(t,Y,K);if(Y.K&&t.retryScheduleIndex+1<3)return g.c(H,Q0F(z,[t]),0);G=((T=Y)==null?0:T.J)?Y.J:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";v={entityKey:t.action.entityKey,failureReason:G};f=void 0;g.Sn(z.s4)?f="mainVideoDownloadStateEntity":g.Jf(z.s4)&&(f="musicTrackDownloadMetadataEntity");
if(!f||!Y.downloadState){H.H0(7);break}C=g.hR(t.action.entityKey).entityId;return g.c(H,MC(C,f,z.J,Y.downloadState),7);case 7:AT(z.C,v);if(Y.downloadState==="DOWNLOAD_STATE_FAILED"&&z.s4.X("html5_auto_retry_failed_pde_actions")){H.H0(0);break}GF("Orchestration result is not retryable, deleting action");return g.c(H,DJN(z.J,HB(t).key),0);case 2:X=void 0;try{X=(O=Y.W)==null?void 0:O.map(function(U){return z.createAction(U,t)})}catch(U){return r0K(t,Y,K),D={entityKey:t.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},AT(z.C,D),GF("Orchestration subactions creation error",U),H.return()}r0K(t,Y,K,X);if(!X){H.H0(12);break}M=X.map(function(U){return HB(U)});
l=0;case 13:if(!(l<X.length)||z.U){H.H0(15);break}return g.c(H,WY(z.J,{mode:"readwrite",bW:!0},function(U){var w=[];w.push(Tuj(U,M.slice(l,l+10),"offlineOrchestrationActionWrapperEntity"));return g.nb.all(w)}),16);
case 16:l+=10;H.H0(13);break;case 15:if(z.U)return z.U=!1,H.return();case 12:return Z=HB(t),g.c(H,DJN(z.J,Z.key),17);case 17:pzW(t,4),g.pF(H)}})},$Dj=function(z,t){var Y,K,T,G,v,f,C,X,O,D,M,l;
return g.P(function(Z){Y=[];K=Infinity;T=4E3;G=g.r(t);for(v=G.next();!v.done;v=G.next())f=v.value,C=Number(f.enqueueTimeSec),X=c0z(C),O=f.retryScheduleIndex,D=O!=null&&O>0,X>0&&D?(K=Math.min(K,C),T=Math.min(X,T)):Y.push(f);isFinite(K)&&(!z.L.isActive()||K<z.B)&&(z.B=K,z.L.start(T));z.N.ke()||(M=Y.length,Y=Y.filter(function(H){var U;H=((U=H.actionProto)==null?void 0:U.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!uUV.includes(H)}),l=Y.length<M,!z.L.isActive()&&l&&z.L.start(1));
Y.length>0&&k8V(z,Y);return g.c(Z,bTN(z),0)})},Ld$=function(z){var t,Y,K,T,G,v,f;
return g.P(function(C){if(C.J==1)return g.c(C,oi$(z),2);t=C.K;Y=[];K=g.r(t);for(T=K.next();!T.done;T=K.next())G=T.value,v=g.hR(G.key),f=v.entityId,Bs_(z.K,f)||Y.push(G);return g.c(C,$Dj(z,Y),0)})},c0z=function(z){z=z*1E3-Date.now();
return z>4E3?4E3:z},Q0F=function(z,t){var Y,K,T;
return g.P(function(G){Y=g.r(t);for(K=Y.next();!K.done;K=Y.next()){T=K.value;var v=void 0,f=void 0,C=((f=T.action)==null?void 0:(v=f.actionMetadata)==null?void 0:v.retryScheduleIntervalsInSeconds)||[1,2,4];v=1;T.retryScheduleIndex<C.length&&(v=C[T.retryScheduleIndex]);T.K=v*1E3+Date.now();T.retryScheduleIndex++}return g.c(G,Pbw(z,t),0)})},wz6=function(z){var t;
return g.P(function(Y){if(Y.J==1)return g.c(Y,zF(z.J,"offlineOrchestrationActionWrapperEntity"),2);t=Y.K;return g.c(Y,$Dj(z,t),0)})},k8V=function(z,t){t.length!==0&&t.forEach(function(Y){Y=rQ(Y);
Y.retryScheduleIndex<3&&j0$(z.K,[Y])})},oi$=function(z,t){var Y;
return g.P(function(K){if(K.J==1)return g.c(K,zF(z.J,"offlineOrchestrationActionWrapperEntity",t),2);Y=K.K;return K.return(Y.filter(HO6))})},Pbw=function(z,t){if(t.length===0)return Promise.resolve([]);
t=t.map(function(Y){return HB(Y)});
return sa2(z.J,t)},IRj=function(z){this.yK=z;
this.K=void 0},aRF=function(z,t){var Y,K,T,G;
return g.P(function(v){Y=t.videoId;K=!0;if(t.captionTracks.length)T=zDA(t),z.K=new g.rn(z.yK,t,T);else if(t.g2)G=g.w5I(t),z.K=new g.jG(z.yK,t.g2,Y,G,t.ez,t.eventId),K=t.ez;else return v.return();return v.return(new Promise(function(f){var C;(C=z.K)==null||C.xC({tU:function(){return g.P(function(X){if(X.J==1)return g.c(X,z.tU(Y,K),2);f();g.pF(X)})},
o4:function(){}})}))})},gi_=function(z){var t;
return g.P(function(Y){if(Y.J==1)return g.c(Y,bOQ(z),2);t=Y.K;return Y.return(!!t&&t.length>0)})},JT=function(z){g.I.call(this);
this.K=z;this.J=this.K.observe(this.L.bind(this))},J0Q=function(z,t){var Y,K,T,G,v,f,C;
return g.P(function(X){switch(X.J){case 1:if(t.length===0)return X.return([]);Y=t.map(function(O){return g.zj(O,"transfer")});
return g.c(X,zF(z.K,"transfer",Y),2);case 2:K=X.K;T=K.filter(HO6).map(function(O){return g.hR(O.key).entityId});
G=t.filter(function(O){return T.indexOf(O)===-1});
if(G.length===0)return X.return([]);v=g.r(G);f=v.next();case 3:if(f.done){X.H0(5);break}C=f.value;return g.c(X,G8W(C),4);case 4:f=v.next();X.H0(3);break;case 5:return X.return(G)}})},y0W=function(z,t,Y,K,T,G){var v,f,C;
return g.P(function(X){v="STREAM_TYPE_UNKNOWN";Y.video&&Y.audio?(v="STREAM_TYPE_AUDIO_AND_VIDEO",GF("unexpected stream type")):Y.video&&!Y.audio?v="STREAM_TYPE_VIDEO":!Y.video&&Y.audio&&(v="STREAM_TYPE_AUDIO");f=g.zj(t,"offlineVideoStreams");C={numBytesDownloaded:T.toFixed(),numTotalBytes:G.toFixed(),streamType:v,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(K),itag:v==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(Y.itag):void 0};return g.c(X,WY(z,{mode:"readwrite",bW:!0},
function(O){var D=NW(O,f,"offlineVideoStreams"),M=NW(O,g.zj(t,"transfer"),"transfer");return g.nb.all([D,M]).then(function(l){l=g.r(l);var Z=l.next().value;l=l.next().value;if(!l)return xC(O,f).then(function(){});
var H=mDW(Z);Z=Nsz(Z,K,C,f);var U=dv(O,Z,"offlineVideoStreams");mDW(Z)>H&&(l.lastProgressTimeMs=Date.now().toString());H=[U];l.offlineVideoStreams||(l.offlineVideoStreams=[]);l.offlineVideoStreams.indexOf(f)===-1&&(l.offlineVideoStreams.push(f),H.push(dv(O,l,"transfer")));return g.nb.all(H)})}),0)})},ePV=function(z,t){var Y,K,T,G,v;
return g.P(function(f){if(f.J==1)return Y=g.zj(t,"offlineVideoStreams"),g.c(f,hP(z,Y,"offlineVideoStreams"),2);K=f.K;if(!K||!K.streamsProgress)return f.return();T=g.r(K.streamsProgress);for(G=T.next();!G.done;G=T.next())v=G.value,v.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",v.numTotalBytes!==v.numBytesDownloaded&&(v.numBytesDownloaded=v.numTotalBytes);return g.c(f,Rz(z,K,"offlineVideoStreams"),0)})},Nsz=function(z,t,Y,K){if(z&&z.streamsProgress){K=z;
a:{t=t.itag+";"+t.xtags;for(var T=z.streamsProgress,G=0;G<T.length;G++){var v=JSON.parse(T[G].formatStreamBytes);if(v.itag+";"+v.xtags===t){T[G]=Y;Y=T;break a}}T.push(Y);Y=T}K.streamsProgress=Y}else z={key:K,streamsProgress:[Y]};return z},mDW=function(z){if(z==null?0:z.streamsProgress){var t=0;
z=z.streamsProgress;for(var Y=0;Y<z.length;Y++){var K=z[Y];isNaN(Number(K.numBytesDownloaded))?GF("stream progress bytes number invalid"):t+=Number(K.numBytesDownloaded)}return t}return 0},dDz=function(z,t,Y,K){g.I.call(this);
var T=this;this.J=z;this.api=t;this.XC=Y;this.J3=K;this.N=new g.RE;this.W=new g.R0(function(){T.K&&T.K.transferState==="TRANSFER_STATE_TRANSFERRING"&&T.N.ke()&&((T.K.transferRetryCount||0)<3?aK(T.C,T.U,!1,!1):IK(T.C,T.U.videoDetails.videoId),T.WY("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.P0=this.qw=0;this.V=this.B=!1;this.B0=g.M2(this.api.G().experiments,"html5_transfer_processing_logs_interval");this.U4=new g.Lt(this);this.EG={br2:function(){return T.W},
irL:function(){return T.J3},
oZ:function(){return T.N}};
this.eL=this.J.observe(this.oa.bind(this));this.C=new Ts_(t,this);this.dW=new IRj(t);this.E4=new JT(this.J);this.SL=this.N.listen("publicytnetworkstatus-online",this.Z2.bind(this));this.Nw=this.N.listen("publicytnetworkstatus-offline",this.aN0.bind(this));this.V=this.api.G().X("html5_less_transfer_processing_logs");g.a(this,this.U4);this.U4.D(t,"offlinetransferpause",this.d54);g.Sn(this.api.G())?this.L="mainVideoDownloadStateEntity":g.Jf(this.api.G())&&(this.L="musicTrackDownloadMetadataEntity")},
xDA=function(z){return g.P(function(t){if(t.J==1)t=g.c(t,Bu$(),2);
else{var Y=z.E4;var K=g.VW();K=Object.keys(K);Y=J0Q(Y,K);t=g.c(t,Y,0)}return t})},NC=function(z,t){t=t===void 0?!1:t;
var Y;return g.P(function(K){if(K.J==1){if(z.K)throw Error("Already downloading a video");z.P0=0;z.B=!1;return g.c(K,SVj(z),2)}return K.J!=4?(Y=K.K,EAQ(z.XC,!Y),Y&&z.N.ke()?t?g.c(K,new Promise(function(T){g.q$(T,1E3)}),4):K.H0(4):(!Y&&z.K&&mA(z),K.H0(0))):g.c(K,EiA(z,Y),0)})},Wd2=function(z){return g.P(function(t){if(t.J==1)return z.U?g.c(t,IK(z.C,z.U.videoDetails.videoId),3):t.H0(0);
mA(z);g.pF(t)})},RP2=function(z,t){var Y,K,T;
return g.P(function(G){switch(G.J){case 1:return g.rk(G,2),(Y=!!t.captionTracks.length||!!t.g2)?g.c(G,gi_(t.videoId),4):G.return();case 4:return(K=G.K)?G.return():g.c(G,aRF(z.dW,t),5);case 5:g.BI(G,0);break;case 2:T=g.VJ(G),GF("Caption downloading error",T,t.cotn),g.pF(G)}})},EiA=function(z,t){var Y,K,T,G,v,f;
return g.P(function(C){switch(C.J){case 1:if(z.B)return C.return();z.B=!0;z.K=t;Y=g.hR(z.K.key);K=Y.entityId;T=void 0;if(z.K.transferState==="TRANSFER_STATE_TRANSFERRING")return g.c(C,y9(z,K),7);if(z.K.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||z.K.transferRetryCount||z.K.hasLoggedFirstStarted){C.H0(3);break}return g.c(C,y9(z,K),5);case 5:return T=C.K,z.K.hasLoggedFirstStarted=!0,g.c(C,hP$(z),6);case 6:RL_({videoId:K,Jn:z.K,offlineModeType:T},void 0,void 0,!0);C.H0(3);break;case 7:T=C.K,
Xd({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:K,Jn:z.K,offlineModeType:T});case 3:return g.c(C,zIV(z),8);case 8:return G=null,g.rk(C,9),g.c(C,tq_(z,t),11);case 11:G=C.K;z.U=G;g.BI(C,10);break;case 9:return v=g.VJ(C),GF("error getting player response",v,t.cotn),g.c(C,z.WY("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return C.return();case 10:return f=GkV(z.api.G(),t.cotn,G),g.c(C,RP2(z,f),13);case 13:return g.c(C,vi6(f.videoId),
14);case 14:f.sV=C.K,XzW(z.C,f,t.maximumDownloadQuality),z.W.start(108E5),g.pF(C)}})},SVj=function(z){var t,Y;
return g.P(function(K){if(K.J==1)return g.c(K,zF(z.J,"transfer"),2);t=K.K;Y=t.filter(YnN).sort(KwN);return Y.length===0?K.return():K.return(Y[0])})},zIV=function(z){var t,Y,K;
return g.P(function(T){if(T.J==1){if(!z.K)return eA(z,"onTransferStart"),T.return();z.W.start(108E5);return g.c(T,dQ(z,"TRANSFER_STATE_TRANSFERRING"),2)}t=z.K;return(K=((Y=t)==null?0:Y.key)?g.hR(t.key).entityId:"")&&z.L?g.c(T,MC(K,z.L,z.J,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):T.H0(0)})},fRK=function(z){var t,Y,K,T;
g.P(function(G){switch(G.J){case 1:if(!z.K){eA(z,"onTransferPausedByUser");G.H0(2);break}t=z.K;z.W.stop();return g.c(G,dQ(z,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:K=((Y=t)==null?0:Y.key)?g.hR(t.key).entityId:"";if(!K||!z.L){G.H0(4);break}return g.c(G,MC(K,z.L,z.J,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.c(G,y9(z,K),6);case 6:T=G.K,zY2({videoId:K,Jn:t,offlineModeType:T});case 2:mA(z),NC(z),g.pF(G)}})},Cb_=function(z){var t,Y,K;
g.P(function(T){if(T.J==1){if(!z.K)return eA(z,"onTransferPausedByNetwork"),T.return();z.W.stop();return g.c(T,dQ(z,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(T.J!=3)return t=z.K,(K=((Y=t)==null?0:Y.key)?g.hR(t.key).entityId:"")&&z.L?g.c(T,MC(K,z.L,z.J,"DOWNLOAD_STATE_PAUSED"),3):T.H0(3);mA(z);g.pF(T)})},TT6=function(z){var t,Y,K,T,G;
g.P(function(v){switch(v.J){case 1:if(!z.K)return eA(z,"onTransferComplete"),v.return();t=z.K;z.W.stop();if(!t||!z.U){v.H0(2);break}Y=GkV(z.api.G(),t.cotn,z.U);return g.c(v,RP2(z,Y),2);case 2:return g.c(v,dQ(z,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:T=((K=t)==null?0:K.key)?g.hR(t.key).entityId:"";if(!T||!z.L){v.H0(5);break}return g.c(v,MC(T,z.L,z.J,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.c(v,ePV(z.J,T),7);case 7:return g.c(v,y9(z,T),8);case 8:G=v.K,Xd({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:T,Jn:t,offlineModeType:G}),mA(z),NC(z),g.pF(v)}})},GRQ=function(z,t,Y){var K,T;
g.P(function(G){switch(G.J){case 1:if(!z.K)return eA(z,"onTransferProgress: "+t),G.return();if(z.K.transferState==="TRANSFER_STATE_TRANSFERRING"){G.H0(2);break}return g.c(G,zIV(z),2);case 2:K=Date.now();if(!(K-z.qw>1E3)){G.H0(4);break}z.qw=K;return g.c(G,y0W(z.J,Y.videoId,Y.J,Y.AJ,Y.bytesDownloaded,Y.K),5);case 5:if(z.V&&!(z.V&&K-z.P0>z.B0)){G.H0(4);break}z.P0=K;return g.c(G,y9(z,t),7);case 7:T=G.K,RL_({videoId:t,Jn:z.K,offlineModeType:T},Y.bytesDownloaded,Y.K);case 4:z.W.start(108E5),g.pF(G)}})},
vEW=function(z){var t=(z.K.transferRetryCount||0)<3;
t&&(z=z.K,z.transferRetryCount=(z.transferRetryCount||0)+1);return t},Av$=function(z,t){t=t===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":t;
var Y,K,T,G;return g.P(function(v){if(v.J==1)return z.K||eA(z,"setTransferToFailed: "+t),Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t==="TRANSFER_FAILURE_REASON_NETWORK"?Y="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":t==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.c(v,dQ(z,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",t),2);if(v.J!=3)return AT(z.J3,{entityKey:(K=z.K)==null?void 0:K.key,failureReason:Y}),
T=z.K?g.hR(z.K.key).entityId:"",g.c(v,y9(z,T),3);G=v.K;var f={videoId:T,Jn:z.K,offlineModeType:G},C=t,X={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};C&&(X.transferFailureReason=C,X.failureReason=tZN(C));Xd(X,f);g.pF(v)})},dQ=function(z,t,Y,K){var T;
return g.P(function(G){if(G.J==1){if(!z.K)return eA(z,"saveTransferState: "+t),G.return();z.K.transferState=t;z.K.failureReason=K;g.rk(G,2);return g.c(G,hP$(z,function(v){return Y?yM(v,"offlineVideoStreams",z.K.offlineVideoStreams).then(function(f){for(var C=g.r(f),X=C.next();!X.done;X=C.next())if((X=X.value)&&X.streamsProgress){X=g.r(X.streamsProgress);for(var O=X.next();!O.done;O=X.next())O.value.streamState=Y}return Tuj(v,f.filter(function(D){return!!D}),"offlineVideoStreams")}):g.nb.resolve(void 0)}),
4)}if(G.J!=2)return g.BI(G,0);
T=g.VJ(G);return T instanceof g.HE&&T.type==="QUOTA_EXCEEDED"?g.c(G,z.WY("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):G.H0(0)})},hP$=function(z,t){var Y;
return g.P(function(K){if(!z.K)return K.return();Y=z.K;return g.c(K,WY(z.J,{mode:"readwrite",bW:!0},function(T){var G=[dv(T,Y,"transfer")];t&&G.push(t(T));return g.nb.all(G)}),0)})},mA=function(z){z.K=void 0;
z.U=void 0;z.W.stop()},tq_=function(z,t){var Y,K,T,G,v;
return g.P(function(f){if(f.J==1)return Y=g.hR(t.key),K=Y.entityId,T=g.zj(K,"playbackData"),g.c(f,hP(z.J,T,"playbackData"),2);G=f.K;if((v=G)==null?0:v.playerResponseJson)return f.return(JSON.parse(G.playerResponseJson));throw Error("No PlayerResponse found");})},eA=function(z,t){z.api.Mw("woffle",{mcte:t});
GF("missing current transfer entity.")},y9=function(z,t){var Y,K,T;
return g.P(function(G){if(G.J==1)return g.c(G,hP(z.J,g.zj(t,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);Y=G.K;return G.return((T=(K=Y)==null?void 0:K.offlineModeType)!=null?T:void 0)})},YnN=function(z){return fDN[z.transferState]!==void 0},KwN=function(z,t){var Y=fDN[z.transferState],K=fDN[t.transferState];
return Y!==K?Y-K:Number(z.enqueuedTimestampMs)-Number(t.enqueuedTimestampMs)},xk=function(z,t){var Y=this;
this.s4=z;this.api=t;this.N=new g.RE;this.U=new g.DM;this.EG={yC:function(){return Y.L.EG.yC()},
oZ:function(){return Y.N},
MVC:function(){return Y.L},
Qd:function(){return Y.Qd()},
jr:function(){return Y.jr()},
rG:function(){return Y.rG()},
s5:function(){return Y.s5()},
T4:function(){return Y.T4()},
YJ:function(K){return Y.YJ(K)}};
this.L=new eLW(function(){return CzA(Y)},function(){Y.rG()},this.api.C9(),this.api.X.bind(this.api));
this.K=new vB(this.api);dJw(this.L)},CzA=function(z){return g.P(function(t){z.api.G5("onOrchestrationBecameLeader");
return g.c(t,z.jr(),0)})},i2W=function(z){var t,Y;
return g.P(function(K){if(K.J==1)return g.c(K,tT(),2);if(K.J!=3){t=K.K;if(!t)return GF("PES is undefined"),K.return();z.J=new dDz(t,z.api,z.L,z.K);Y=z.uh(t);return g.c(K,Vd_(t,Y,z.L,z.K,z.s4),3)}z.C=K.K;return g.c(K,X3F(z),0)})},X3F=function(z){var t;
return g.P(function(Y){switch(Y.J){case 1:if(!z.J)return GF("transferManager is undefined"),Y.return();if(z.J.K){Y.H0(2);break}return g.c(Y,NC(z.J),2);case 2:if(!z.s4.X("woffle_enable_main_downloads_library")){Y.H0(4);break}return g.c(Y,z.wR(),4);case 4:if(!z.s4.X("html5_offline_playback_position_sync")){Y.H0(6);break}return g.c(Y,z.Ju(),7);case 7:return g.c(Y,z.YJ(864E5),6);case 6:return g.c(Y,z.refreshAllStaleEntities(43200,!0),9);case 9:return g.c(Y,z.Yg(),10);case 10:if(!z.s4.X("html5_retry_downloads_for_expiration")){Y.H0(11);
break}return g.c(Y,z.T4(),11);case 11:return z.B=g.pr(function(){z.refreshAllStaleEntities(43200,!0);z.Yg()},9E5),g.tu(g.Kb(),function(){return z.s5()}),g.c(Y,tT(),13);
case 13:return t=Y.K,g.c(Y,yJF(t),14);case 14:xJz(z.L),g.pF(Y)}})},O2_=function(){var z,t,Y,K,T,G;
return g.P(function(v){switch(v.J){case 1:return g.c(v,tT(),2);case 2:z=v.K;if(!z)return v.return([]);t=Date.now()/1E3;return g.c(v,zF(z,"offlineVideoPolicy"),3);case 3:Y=v.K,K=g.r(Y),T=K.next();case 4:if(T.done){v.H0(6);break}G=T.value;if(!(G.expirationTimestamp&&Number(G.expirationTimestamp)<t)){v.H0(5);break}G.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";G.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.c(v,Rz(z,G,"offlineVideoPolicy"),5);
case 5:T=K.next();v.H0(4);break;case 6:return v.return(Y.map(function(f){return f.key}))}})},SA=function(z,t,Y,K,T){var G,v,f;
return g.P(function(C){if(C.J==1)return g.c(C,tT(),2);G=C.K;if(!G)return C.return([]);v=t.map(function(X){var O=g.zj(X,Y);O={actionType:K,entityKey:O,actionMetadata:Object.assign({},v7w(),T)};K!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(O.actionMetadata.priority=0);X=new pu(Y,X,O);return HB(X)});
f=sa2(G,v);dJw(z.L);return C.return(f)})},sIN=function(z,t,Y,K){var T,G,v,f,C,X,O,D;
return g.P(function(M){switch(M.J){case 1:T=[],G=g.r(t),v=G.next();case 2:if(v.done){M.H0(4);break}f=v.value;if(f.upToDate||Y&&!f.shouldAutoSyncMetadata||!f.playlistId){M.H0(3);break}C={};switch(K){case "mainPlaylistEntity":X={nextAutoRefreshIntervalSeconds:f.checkInSeconds,autoSync:Y};C={mainPlaylistEntityActionMetadata:X};break;case "musicPlaylist":O={autoSync:Y},C={musicPlaylistEntityActionMetadata:O}}return g.c(M,SA(z,[f.playlistId],K,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",C),6);case 6:(D=
M.K)&&T.push.apply(T,g.b(D));case 3:v=G.next();M.H0(2);break;case 4:return M.return(T)}})},DXK=function(z,t){var Y;
return g.P(function(K){return t.length?(Y=v7w(),g.yj(Y,Lu,{isEnqueuedForExpiredStreamUrlRefetch:!0}),z.api.Mw("qrd",{v:t.length}),K.return(SA(z,t,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Y))):K.return([])})},MqN=function(z,t,Y){this.K=z;
this.s4=t;this.L=Y},qn2=function(z,t){var Y,K,T,G,v,f,C,X,O,D,M,l,Z,H,U,w,V;
return g.P(function(u){switch(u.J){case 1:return Y=im(t),K=g.hR(t.entityKey),T=K.entityId,G=[],g.rk(u,2),g.c(u,lD$(z,T),4);case 4:G=u.K;if(!(z.s4.X("woffle_enable_main_downloads_library")&&((v=G)==null?0:v.length))){u.H0(5);break}return g.c(u,pOV(z.K,[t.entityKey]),5);case 5:g.BI(u,3);break;case 2:return f=g.VJ(u),C="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",f instanceof g.HE&&f.type==="QUOTA_EXCEEDED"?(C="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
X="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):GF("Playlist add error"),u.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,C,X));case 3:O=[];if(!z.s4.X("html5_offline_prevent_redownload_downloaded_video")){u.H0(7);break}return g.c(u,TGW(z.K,"mainVideoEntity",G),8);case 8:G=u.K;case 7:if((D=G)==null?0:D.length)for(M=g.r(G),l=M.next();!l.done;l=M.next())if(Z=l.value,H=Z.offlineVideoData,U=void 0,(U=H)==null?0:U.videoId)w=void 0,V=Number(((w=t.actionMetadata)==null?void 0:w.priority)||
0)+1,O.push($k("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",H.videoId,"mainVideoEntity",V,Ec,Z2N(t,H,T)));return u.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,O))}})},rvW=function(z,t){var Y,K,T,G,v,f,C,X,O,D,M,l,Z,H,U,w,V,u,k,J,E,d,Yw,TE,h,fF,W,HI,bt,mI,BA,f_,nF,wk,Tz,B,Ah,ew,jx,n_,MV,PI,$K,FW,n,F,Q,L,N,U0,th,qq,KF,QJ,E0,jw,U5,ke,yI,xe,ep,rY,i_,Fi,Zp,QT,dg,x1,BT,Gb,dY,GX,FU,xY;
return g.P(function(lf){switch(lf.J){case 1:return Y=im(t),K=t.entityKey,T=g.hR(K).entityId,G=[],v=!1,T==="!*$_ALL_ENTITIES_!*$"?(v=!0,g.c(lf,zF(z.K,"mainPlaylistEntity"),5)):g.c(lf,hP(z.K,K,"mainPlaylistEntity"),4);case 4:(f=lf.K)&&G.push(f);lf.H0(3);break;case 5:G=lf.K;case 3:if((C=G)==null||!C.length)return lf.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));X=g.m(t.actionMetadata,p3N);D=(O=X)==null?void 0:O.nextAutoRefreshIntervalSeconds;l=(M=X)==null?void 0:M.autoSync;Z=[];U=H=
!0;w=!1;if(!v&&l===!1){lf.H0(6);break}g.rk(lf,7);return g.c(lf,kkN(0,!!l,!0,G),9);case 9:Z=lf.K;g.BI(lf,8);break;case 7:V=g.VJ(lf);if(!(V instanceof Error&&V.message==="No data")){V instanceof Error&&V.message==="Empty response body"&&GF(V.message);lf.H0(8);break}return T==="!*$_ALL_ENTITIES_!*$"?g.c(lf,sVA(z.K,t,z.L,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.c(lf,iI_(T,z.K,t,z.L),8);case 8:if(!Z.length||!v&&Z[0].playlistId!==T)return lf.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y));case 6:if(v){u=[];k=g.r(Z);for(J=k.next();!J.done;J=k.next())E=J.value,E.upToDate||l&&!E.shouldAutoSyncMetadata||!E.playlistId||(d={nextAutoRefreshIntervalSeconds:E.checkInSeconds,autoSync:l},u.push($k("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",E.playlistId,"mainPlaylistEntity",0,Ec,{mainPlaylistEntityActionMetadata:d})));return lf.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,u))}Z.length&&(Yw=Z[0],w=!!Yw.upToDate,l&&(H=(TE=Yw.shouldAutoSyncMetadata)!=null?TE:!0,U=(h=Yw.shouldAutoSyncVideos)!=
null?h:!0,Yw.checkInSeconds&&(D=Yw.checkInSeconds)));if(w||!H)return lf.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));fF=[];W=G[0];if(!W.downloadState){HI=void 0;lf.H0(15);break}return g.c(lf,hP(z.K,W.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:HI=lf.K;case 15:return bt=HI,BA=((mI=bt)==null?0:mI.addedTimestampMillis)?String(bt.addedTimestampMillis):void 0,g.rk(lf,17),g.c(lf,lD$(z,T,BA,D),19);case 19:fF=lf.K;g.BI(lf,18);break;case 17:f_=g.VJ(lf);if(!(f_ instanceof
Error&&f_.message==="No data for playlist")){if(f_ instanceof Error&&f_.message==="Empty response body for playlist")GF(f_.message);else return nF="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",wk="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",f_ instanceof g.HE&&f_.type==="QUOTA_EXCEEDED"&&(nF="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",wk="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),lf.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,nF,wk));
lf.H0(18);break}return g.c(lf,iI_(T,z.K,t,z.L),18);case 18:if(!U)return lf.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));Tz=[];B=new Map;if((Ah=fF)==null?0:Ah.length)for(ew=g.r(fF),jx=ew.next();!jx.done;jx=ew.next())n_=jx.value,MV=n_.offlineVideoData,PI=void 0,((PI=MV)==null?0:PI.videoId)&&B.set(MV.videoId,MV);$K=new Map;FW=[];if((n=W)==null?0:(F=n.videos)==null?0:F.length)for(Q=g.r(W.videos),L=Q.next();!L.done;L=Q.next())if(N=L.value,U0=JSON.parse(g.hR(N).entityId),th=U0.videoId)B.has(th)?
($K.set(th,B.get(th)),B.delete(th)):FW.push(th);KF=Number(((qq=t.actionMetadata)==null?void 0:qq.priority)||0)+1;QJ=g.r(B.entries());for(E0=QJ.next();!E0.done;E0=QJ.next())jw=E0.value,U5=g.r(jw),ke=U5.next().value,yI=U5.next().value,xe=ke,ep=yI,Tz.push($k("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",xe,"mainVideoEntity",KF,Ec,Z2N(t,ep,T)));rY=g.r($K.entries());for(i_=rY.next();!i_.done;i_=rY.next())Fi=i_.value,Zp=g.r(Fi),QT=Zp.next().value,dg=Zp.next().value,x1=QT,BT=dg,Tz.push($k("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
x1,"mainVideoEntity",KF,Ec,Z2N(t,BT,T)));Gb=g.r(FW);for(dY=Gb.next();!dY.done;dY=Gb.next())GX=dY.value,FU={playlistId:T},xY={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:FU},Tz.push($k("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",GX,"mainVideoEntity",0,Ec,xY));return lf.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,Tz))}})},H26=function(z,t){var Y,K,T,G;
return g.P(function(v){switch(v.J){case 1:return Y=im(t),g.rk(v,2),K=g.hR(t.entityKey).entityId,K==="!*$_ALL_ENTITIES_!*$"?g.c(v,sVA(z.K,t,z.L,(T=t.actionMetadata)==null?void 0:(G=T.offlineLoggingData)==null?void 0:G.offlineDeleteReason),5):g.c(v,iI_(K,z.K,t,z.L),6);case 6:if(!z.s4.X("woffle_enable_main_downloads_library")){v.H0(5);break}return g.c(v,rN$(z.K,t.entityKey),5);case 5:g.BI(v,3);break;case 2:return g.VJ(v),v.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return v.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y))}})},lD$=function(z,t,Y,K){var T,G,v,f,C,X,O;
return g.P(function(D){switch(D.J){case 1:return g.c(D,cNz([t]),2);case 2:return T=D.K,g.c(D,jI$(z,T[0],Y,K),3);case 3:return G=D.K,v=G.mainPlaylistEntity,f=G.sU6,X=Cg_(v,(C=f)==null?void 0:C.avatar),g.rk(D,4),g.c(D,Uc(X),6);case 6:g.BI(D,5);break;case 4:O=g.VJ(D),O instanceof Error&&O.message==="Failed to fetch"&&GF(O.message);case 5:return D.return(T[0].videos)}})},jI$=function(z,t,Y,K){var T,G,v,f,C,X,O,D,M,l,Z,H,U,w,V,u,k;
return g.P(function(J){switch(J.J){case 1:T=Date.now().toString();Y||(Y=T);G=t.videos;v=t.playlistId;f=[];C=[];if(G)for(X=g.r(G),O=X.next();!O.done;O=X.next()){D=O.value;M=D.offlineVideoData;if(!M||!M.videoId)throw GF("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");l=M.videoId;Z={videoId:l,playlistId:v};H={id:g.zj(JSON.stringify(Z),"mainPlaylistVideoEntity"),video:g.zj(l,"mainVideoEntity")};f.push(H);C.push(H.id)}w={key:g.zj(v,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:Y,lastSyncedTimestampMillis:T};V={key:g.zj(v,"mainPlaylistEntity"),playlistId:v,videos:C,title:t.title,thumbnailStyleData:UXA(t),visibility:BT_(t),downloadState:w.key};t.channel&&(u=t.channel.offlineChannelData,U=w3V(g.zj(v,"ytMainChannelEntity"),u),V.channelOwner=U.id);((k=V)==null?0:k.entityMetadata)?(V.entityMetadata.offlineLastModifiedTimestampSeconds=t.lastModifiedTimestamp,K&&(V.entityMetadata.nextAutoRefreshIntervalSeconds=String(K))):V&&(V.entityMetadata={nextAutoRefreshIntervalSeconds:K?
String(K):void 0,offlineLastModifiedTimestampSeconds:t.lastModifiedTimestamp});g.rk(J,2);return g.c(J,WY(z.K,{mode:"readwrite",bW:!0},function(E){var d=dv(E,V,"mainPlaylistEntity"),Yw=dv(E,w,"mainPlaylistDownloadStateEntity");d=[d,Yw];Yw=g.r(f);for(var TE=Yw.next();!TE.done;TE=Yw.next())d.push(dv(E,TE.value,"mainPlaylistVideoEntity"));U&&d.push(dv(E,U,"ytMainChannelEntity"));return g.nb.all(d)}),4);
case 4:g.BI(J,3);break;case 2:throw g.VJ(J),GF("PES failure for playlist"),Error("PES failure for playlist");case 3:return J.return({mainPlaylistEntity:V,sU6:U,xKC:f})}})},w3V=function(z,t){return{id:z,
channelId:t.channelId,title:t.title,avatar:t.thumbnail}},UXA=function(z){var t=[],Y=z.videos;
Y&&Y.length>0&&t.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:Y[0].offlineVideoData.thumbnail}}});if((z=z.additionalMetadadatas)&&z.length>0)for(z=g.r(z),Y=z.next();!Y.done;Y=z.next()){var K=Y.value.offlineBundleItemPlaylistData,T=void 0;Y=(T=K)==null?void 0:T.style;T=void 0;K={collageThumbnail:{coverThumbnail:(T=K)==null?void 0:T.coverThumbnail}};switch(Y){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":t.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:K});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":t.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:K});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":t.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:K});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":t.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:K})}}return t},BT_=function(z){switch(z.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},Z2N=function(z,t,Y){t={offlineVideoData:t,
playlistId:Y};if(z=g.m(z.actionMetadata,p3N))t.maximumDownloadQuality=z.maximumDownloadQuality;return{mainVideoEntityActionMetadata:t}},b22=function(z,t,Y){this.K=z;
this.s4=t;this.L=Y},Fww=function(z,t){var Y,K,T,G,v,f,C,X,O,D,M,l,Z;
return g.P(function(H){switch(H.J){case 1:return Y=im(t),K=g.hR(t.entityKey),T=K.entityId,G=g.m(t.actionMetadata,WB),f=!((v=G)==null?0:v.playlistId),g.rk(H,2),g.c(H,VqN(z,T,void 0,(C=G)==null?void 0:C.offlineVideoData,f),4);case 4:g.BI(H,3);break;case 2:return X=g.VJ(H),O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.HE&&X.type==="QUOTA_EXCEEDED"&&(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
H.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,O,D));case 3:M=1;M=Number(((l=t.actionMetadata)==null?void 0:l.priority)||0)+1;var U=(U=g.m(t.actionMetadata,WB))?{playbackDataActionMetadata:{maximumDownloadQuality:U.maximumDownloadQuality}}:void 0;Z=$k("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",T,"playbackData",M,nEN,U);return H.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,[Z]))}})},QIF=function(z,t){var Y,K,T,G,v,f,C,X,O,D,M,l,Z,H,U,w,V;
return g.P(function(u){switch(u.J){case 1:return Y=im(t),K=g.hR(t.entityKey),T=K.entityId,g.c(u,hP(z.K,t.entityKey,"mainVideoEntity"),2);case 2:G=u.K;if(!G){v=void 0;u.H0(3);break}return g.c(u,hP(z.K,G.downloadState,"mainVideoDownloadStateEntity"),4);case 4:v=u.K;case 3:f=v;if(!G||!f)return u.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));g.rk(u,5);return g.c(u,VqN(z,T,f.addedTimestampMillis,(X=g.m(t.actionMetadata,WB))==null?void 0:X.offlineVideoData),7);case 7:O=1;O=Number(((D=
t.actionMetadata)==null?void 0:D.priority)||0)+1;C=$k("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",T,"playbackData",O,nEN);g.BI(u,6);break;case 5:M=g.VJ(u);if(!(M instanceof Error&&M.message==="No data")){if(M instanceof Error&&M.message==="Empty response body")GF(M.message);else return l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",M instanceof g.HE&&M.type==="QUOTA_EXCEEDED"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),u.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,l,Z));u.H0(6);break}return g.c(u,bm(z.K,T),9);case 9:H=u.K;U=g.m(t.actionMetadata,WB);if(V=(w=U)==null?void 0:w.playlistId)H.playlistId=V;H.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.c(u,BB(T,z.K,t,z.L,H),6);case 6:return u.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,C?[C]:void 0))}})},cvW=function(z,t){var Y,K,T,G,v,f,C,X,O,D;
return g.P(function(M){switch(M.J){case 1:return Y=im(t),g.rk(M,2),K=g.hR(t.entityKey).entityId,K==="!*$_ALL_ENTITIES_!*$"?g.c(M,sVA(z.K,t,z.L,(O=t.actionMetadata)==null?void 0:(D=O.offlineLoggingData)==null?void 0:D.offlineDeleteReason),5):g.c(M,bm(z.K,K),6);case 6:T=M.K;G=g.m(t.actionMetadata,WB);if(f=(v=G)==null?void 0:v.playlistId)T.playlistId=f;T.offlineDeleteReason=(C=t.actionMetadata)==null?void 0:(X=C.offlineLoggingData)==null?void 0:X.offlineDeleteReason;return g.c(M,BB(K,z.K,t,z.L,T),7);
case 7:if(!z.s4.X("woffle_enable_main_downloads_library")){M.H0(5);break}return g.c(M,rN$(z.K,t.entityKey),5);case 5:g.BI(M,3);break;case 2:return g.VJ(M),M.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return M.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y))}})},VqN=function(z,t,Y,K,T){var G,v,f,C,X,O;
return g.P(function(D){switch(D.J){case 1:if(G=K){D.H0(2);break}return g.c(D,QVW([t]),3);case 3:v=D.K,G=v[0];case 2:return g.c(D,u0_(z,G,Y,T),4);case 4:f=D.K;C=f.mainVideoEntity;X=f.channelEntity;g.rk(D,5);var M=qC(C.thumbnail),l=qC(X.avatar);return g.c(D,Uc(M.concat(l)),7);case 7:g.BI(D,0);break;case 5:O=g.VJ(D),O instanceof Error&&O.message==="Failed to fetch"&&GF(O.message),g.pF(D)}})},u0_=function(z,t,Y,K){var T,G,v,f,C,X,O,D,M,l,Z,H,U;
return g.P(function(w){switch(w.J){case 1:Y||(Y=Date.now().toString());G=(T=t.channel)==null?void 0:T.offlineChannelData;v={id:g.zj(t.videoId,"ytMainChannelEntity"),channelId:G.channelId,title:G.title,avatar:G.thumbnail};f={key:g.zj(t.videoId,"mainVideoDownloadStateEntity"),playbackData:g.zj(t.videoId,"playbackData"),addedTimestampMillis:Y,videoDownloadContextEntity:g.zj(t.videoId,"videoDownloadContextEntity")};C={key:g.zj(t.videoId,"videoPlaybackPositionEntity"),videoId:t.videoId,lastPlaybackPositionSeconds:"0"};
z.s4.X("html5_offline_playback_position_sync")&&(X={playbackPosition:C.key});O=g.zj(t.videoId,"mainVideoEntity");D={key:O,videoId:t.videoId,title:t.title,thumbnail:t.thumbnail,localizedStrings:{viewCount:t.shortViewCountText},userState:X,lengthSeconds:t.lengthSeconds?Number(t.lengthSeconds):void 0,publishedTimestampMillis:t.publishedTimestamp?(Number(t.publishedTimestamp)*1E3).toString():void 0,formattedDescription:t.description,owner:v.id,downloadState:f.key};if(!z.s4.X("woffle_enable_main_downloads_library")||
!K){w.H0(2);break}return g.c(w,qDF(z.K,[O]),3);case 3:if(Z=w.K)M=Z.mainDownloadsLibraryEntity,l=Z.mainDownloadsListEntity;case 2:return U=KaK,H={key:g.zj(t.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.yj(f,U,H),g.c(w,WY(z.K,{mode:"readwrite",bW:!0},function(V){var u=dv(V,v,"ytMainChannelEntity"),k=dv(V,f,"mainVideoDownloadStateEntity"),J=dv(V,D,"mainVideoEntity");u=[u,k,J];z.s4.X("html5_offline_playback_position_sync")&&(k=dv(V,C,"videoPlaybackPositionEntity"),
u.push(k));M&&(k=dv(V,M,"mainDownloadsLibraryEntity"),u.push(k));l&&(k=dv(V,l,"mainDownloadsListEntity"),u.push(k));H&&(V=dv(V,H,"downloadStatusEntity"),u.push(V));return g.nb.all(u)}),4);
case 4:return w.return({mainVideoEntity:D,channelEntity:v})}})},kRF=function(z,t,Y){this.K=z;
this.s4=t;this.L=Y},oE2=function(z,t){var Y,K,T,G,v,f,C,X,O,D,M,l,Z,H,U,w,V,u,k,J,E,d,Yw,TE,h,fF,W;
return g.P(function(HI){switch(HI.J){case 1:return Y=im(t),K=[],g.c(HI,gv.getInstance(),2);case 2:T=HI.K;if(!T){HI.H0(3);break}return g.c(HI,T.get("sdois"),4);case 4:return G=HI.K,g.c(HI,(f=T)==null?void 0:f.get("lmqf"),5);case 5:v=HI.K;case 3:g.rk(HI,6);if(G===void 0)throw Error("prefStorage or opt-in state is undefined");C=[];if(G){HI.H0(8);break}return g.c(HI,ZIA(z.K),9);case 9:C=HI.K,C.reverse();case 8:if(!C.length){HI.H0(10);break}X=g.r(C);O=X.next();case 11:if(O.done){HI.H0(10);break}D=O.value;
if(!D){HI.H0(12);break}M=g.hR(D).entityId;return g.c(HI,bm(z.K,M),14);case 14:return l=HI.K,l.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.c(HI,BB(M,z.K,{entityKey:D,actionType:t.actionType},z.L,l),12);case 12:O=X.next();HI.H0(11);break;case 10:return g.c(HI,o7W(G,(Z=v)!=null?Z:"SD"),16);case 16:return H=HI.K,g.c(HI,DZQ(H),17);case 17:U=lMw(H);if(!z.s4.X("woffle_enable_main_downloads_library")){HI.H0(18);break}if(G){HI.H0(19);break}return g.c(HI,rN$(z.K,g.op),19);case 19:return g.c(HI,
pOV(z.K,[g.op]),18);case 18:if((w=U)==null?0:w.length)for(V=g.r(U),u=V.next();!u.done;u=V.next())if(J=k=u.value,E=J.actionType,d=J.entityKey,Yw=J.actionMetadata,E&&d&&Yw&&!g.m(Yw,$Xj)){E==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Yw.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(TE=g.m(k.actionMetadata,WB))TE.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",k.actionMetadata=Object.assign({},k.actionMetadata,{mainVideoEntityActionMetadata:TE});K.push(k)}g.BI(HI,
7);break;case 6:return h=g.VJ(HI),fF="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.HE&&h.type==="QUOTA_EXCEEDED"&&(fF="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),HI.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,fF,W));case 7:return HI.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,K))}})},LwA=function(){xk.apply(this,
arguments);
this.V="mainVideoEntity"},PzF=function(z,t,Y){t=t===void 0?43200:t;
Y=Y===void 0?!0:Y;var K=K===void 0?!1:K;var T,G,v;return g.P(function(f){switch(f.J){case 1:if(!z.N.ke())return f.return([]);T=[];g.rk(f,2);return g.c(f,kkN(t,Y,K),4);case 4:T=f.K;g.BI(f,3);break;case 2:G=g.VJ(f),G instanceof Error&&G.message==="No data"||G instanceof Error&&G.message==="Empty response body"&&GF(G.message);case 3:return v=sIN(z,T,Y,"mainPlaylistEntity"),f.return(v)}})},IDW=function(z,t,Y,K){K=K===void 0?!1:K;
var T,G,v,f,C,X,O,D,M,l,Z,H,U,w,V;return g.P(function(u){switch(u.J){case 1:return T=[],g.c(u,$ZN(),2);case 2:return(G=u.K)||K?g.c(u,La$(t,Y),3):u.return([]);case 3:v=u.K;if((f=v)==null||!f.length)return u.return([]);C={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};X=g.r(v);O=X.next();case 4:if(O.done){u.H0(6);break}M=D=O.value;l=M.actionType;Z=M.entityKey;H=M.actionMetadata;if(!(l&&Z&&H)||g.m(H,$Xj)){u.H0(5);break}l==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(H.offlineLoggingData=
C);U=g.hR(Z);w=U.entityId;return g.c(u,SA(z,[w],"mainVideoEntity",l,H),8);case 8:V=u.K,T=T.concat(V);case 5:O=X.next();u.H0(4);break;case 6:return u.return(T)}})},aDw=function(z,t){this.K=z;
this.L=t},JvA=function(z,t){var Y,K,T,G,v,f,C,X,O,D,M,l,Z,H,U,w;
return g.P(function(V){switch(V.J){case 1:return Y=im(t),K=g.hR(t.entityKey),T=K.entityId,G=[],g.rk(V,2),g.c(V,gEN(z,T),4);case 4:G=V.K;if((v=G)==null||!v.length){V.H0(5);break}return g.c(V,wOA(z.K,t.entityKey),5);case 5:g.BI(V,3);break;case 2:return f=g.VJ(V),C="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",f instanceof g.HE&&f.type==="QUOTA_EXCEEDED"&&(C="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
V.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,C,X));case 3:return O=[],g.c(V,TGW(z.K,"musicTrack",G),7);case 7:G=V.K;if(G.length)for(D=g.r(G),M=D.next();!M.done;M=D.next())if(l=M.value,Z=l.offlineVideoData,H=void 0,(H=Z)==null?0:H.videoId)U=void 0,w=Number(((U=t.actionMetadata)==null?void 0:U.priority)||0)+1,O.push($k("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Z.videoId,"musicTrack",w,RK,Q9(t,Z,T)));return V.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,O))}})},
mXz=function(z,t){var Y,K,T,G,v,f,C,X,O,D,M,l,Z,H,U,w,V,u,k,J,E,d,Yw,TE,h,fF,W,HI,bt,mI,BA,f_,nF,wk,Tz,B,Ah,ew,jx,n_,MV,PI,$K,FW,n,F,Q,L,N,U0,th,qq,KF,QJ,E0,jw,U5,ke,yI;
return g.P(function(xe){switch(xe.J){case 1:return Y=im(t),K=t.entityKey,T=g.hR(K).entityId,G=[],v=!1,T==="!*$_ALL_ENTITIES_!*$"?(v=!0,g.c(xe,zF(z.K,"musicAlbumRelease"),5)):g.c(xe,hP(z.K,K,"musicAlbumRelease"),4);case 4:(f=xe.K)&&G.push(f);xe.H0(3);break;case 5:G=xe.K;case 3:if((C=G)==null||!C.length)return xe.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));if(v){X=[];O=g.r(G);for(D=O.next();!D.done;D=O.next())M=D.value,l=g.hR(M.id).entityId,X.push($k("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
l,"musicAlbumRelease",0,RK));return xe.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,X))}Z=[];H=G[0];U=void 0;if(!H.downloadMetadata){xe.H0(6);break}return g.c(xe,hP(z.K,H.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:w=xe.K,U=Number((u=(V=w)==null?void 0:V.addedTimestampMillis)!=null?u:"0")/1E3;case 6:return g.rk(xe,8),g.c(xe,gEN(z,T,(k=U)==null?void 0:k.toString()),10);case 10:Z=xe.K;g.BI(xe,9);break;case 8:J=g.VJ(xe);if(!(J instanceof Error&&J.message===
"No data")){if(J instanceof Error&&J.message==="Empty response body")GF(J.message);else return E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",J instanceof g.HE&&J.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),xe.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,E,d));xe.H0(9);break}return g.c(xe,nu(T,"musicAlbumRelease",z.K,
t,z.L),9);case 9:Yw=[];TE=new Map;if((h=Z)==null?0:h.length)for(fF=g.r(Z),W=fF.next();!W.done;W=fF.next())HI=W.value,bt=HI.offlineVideoData,mI=void 0,((mI=bt)==null?0:mI.videoId)&&TE.set(bt.videoId,bt);BA=new Map;f_=[];if((nF=H)==null?0:(wk=nF.tracks)==null?0:wk.length)for(Tz=g.r(H.tracks),B=Tz.next();!B.done;B=Tz.next())if(Ah=B.value,ew=g.hR(Ah).entityId)TE.has(ew)?(BA.set(ew,TE.get(ew)),TE.delete(ew)):f_.push(ew);n_=Number(((jx=t.actionMetadata)==null?void 0:jx.priority)||0)+1;MV=g.r(TE.entries());
for(PI=MV.next();!PI.done;PI=MV.next())$K=PI.value,FW=g.r($K),n=FW.next().value,F=FW.next().value,Q=n,L=F,Yw.push($k("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Q,"musicTrack",n_,RK,Q9(t,L)));N=g.r(BA.entries());for(U0=N.next();!U0.done;U0=N.next())th=U0.value,qq=g.r(th),KF=qq.next().value,QJ=qq.next().value,E0=KF,jw=QJ,Yw.push($k("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",E0,"musicTrack",n_,RK,Q9(t,jw)));U5=g.r(f_);for(ke=U5.next();!ke.done;ke=U5.next())yI=ke.value,Yw.push($k("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
yI,"musicTrack",0,RK));return xe.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,Yw))}})},NT_=function(z,t){var Y,K;
return g.P(function(T){switch(T.J){case 1:return Y=im(t),g.rk(T,2),K=g.hR(t.entityKey).entityId,K==="!*$_ALL_ENTITIES_!*$"?g.c(T,Fd(z.K,t,z.L),5):g.c(T,nu(K,"musicAlbumRelease",z.K,t,z.L),6);case 6:return g.c(T,bIw(z.K,t.entityKey),5);case 5:g.BI(T,3);break;case 2:return g.VJ(T),T.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return T.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},gEN=function(z,t,Y){var K,T,G;
return g.P(function(v){switch(v.J){case 1:return g.c(v,cNz([t]),2);case 2:return K=v.K,g.c(v,yvF(z,K[0],Y),3);case 3:return T=v.K,G=qC(T.thumbnailDetails),g.c(v,Uc(G),4);case 4:return v.return(K[0].videos)}})},yvF=function(z,t,Y){var K,T,G,v,f,C,X,O,D,M,l,Z,H,U;
return g.P(function(w){if(w.J==1){K=t.additionalMetadadatas;T=void 0;if(K&&K.length>0)for(G=g.r(K),v=G.next();!v.done;v=G.next())if(f=v.value,f.offlineMusicPlaylistData){T=f.offlineMusicPlaylistData;break}C=t.playlistId;X=VZ2(t);O=X.pw;D=X.oB;M=Y?(Number(Y)*1E3).toString():Date.now().toString();l=t.lastModifiedTimestamp?(Number(t.lastModifiedTimestamp)*1E3).toString():"0";Z={id:g.zj(C,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:D,lastModifiedTimestampMillis:l,addedTimestampMillis:M,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};H={id:g.zj(C,"musicAlbumRelease"),title:t.title,audioPlaylistId:C,trackCount:t.totalVideoCount,tracks:O,downloadMetadata:Z.id};T&&(H.thumbnailDetails=(U=T.albumHqThumbnail)!=null?U:T.albumArtistThumbnail,H.artistDisplayName=T.albumArtistDisplayName,H.releaseDate=T.albumReleaseDate,H.contentRating={explicitType:T.albumReleaseExplicitType},H.releaseType=T.albumReleaseType);return g.c(w,WY(z.K,{mode:"readwrite",bW:!0},function(V){var u=dv(V,H,"musicAlbumRelease");
V=dv(V,Z,"musicAlbumReleaseDownloadMetadataEntity");return g.nb.all([u,V])}),2)}return w.return(H)})},eI_=function(z,t){this.K=z;
this.L=t},xXQ=function(z,t){var Y,K,T,G,v,f,C,X,O,D,M,l,Z,H,U,w;
return g.P(function(V){switch(V.J){case 1:return Y=im(t),K=g.hR(t.entityKey),T=K.entityId,G=[],g.rk(V,2),g.c(V,dXN(z,T),4);case 4:G=V.K;if((v=G)==null||!v.length){V.H0(5);break}return g.c(V,wOA(z.K,t.entityKey),5);case 5:g.BI(V,3);break;case 2:return f=g.VJ(V),C="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",f instanceof g.HE&&f.type==="QUOTA_EXCEEDED"&&(C="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
V.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,C,X));case 3:return O=[],g.c(V,TGW(z.K,"musicTrack",G),7);case 7:G=V.K;if(G.length)for(D=g.r(G),M=D.next();!M.done;M=D.next())if(l=M.value,Z=l.offlineVideoData,H=void 0,(H=Z)==null?0:H.videoId)U=void 0,w=Number(((U=t.actionMetadata)==null?void 0:U.priority)||0)+1,O.push($k("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Z.videoId,"musicTrack",w,hT,Q9(t,Z,T)));return V.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,O))}})},
Sn$=function(z,t){var Y,K,T,G,v,f,C,X,O,D,M,l,Z,H,U,w,V,u,k,J,E,d,Yw,TE,h,fF,W,HI,bt,mI,BA,f_,nF,wk,Tz,B,Ah,ew,jx,n_,MV,PI,$K,FW,n,F,Q,L,N,U0,th,qq,KF,QJ,E0,jw,U5,ke,yI,xe,ep,rY,i_,Fi,Zp,QT,dg,x1,BT,Gb,dY;
return g.P(function(GX){switch(GX.J){case 1:return Y=im(t),K=t.entityKey,T=g.hR(K).entityId,G=[],v=!1,T==="!*$_ALL_ENTITIES_!*$"?(v=!0,g.c(GX,zF(z.K,"musicPlaylist"),5)):g.c(GX,hP(z.K,K,"musicPlaylist"),4);case 4:(f=GX.K)&&G.push(f);GX.H0(3);break;case 5:G=GX.K;case 3:if((C=G)==null||!C.length)return GX.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));X=g.m(t.actionMetadata,n7F);D=(O=X)==null?void 0:O.autoSync;M=[];Z=l=!0;H=!1;U=void 0;if(!v&&D===!1){GX.H0(6);break}g.rk(GX,7);return g.c(GX,
Pg$(0,!!D,!0,G),9);case 9:M=GX.K;g.BI(GX,8);break;case 7:w=g.VJ(GX);if(!(w instanceof Error&&w.message==="No data")){w instanceof Error&&w.message==="Empty response body"&&GF(w.message);GX.H0(8);break}return T==="!*$_ALL_ENTITIES_!*$"?g.c(GX,Fd(z.K,t,z.L),8):g.c(GX,nu(T,"musicPlaylist",z.K,t,z.L),8);case 8:if(!M.length||!v&&M[0].playlistId!==T)return GX.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));case 6:if(v){V=[];u=g.r(M);for(k=u.next();!k.done;k=u.next())J=k.value,J.upToDate||
D&&!J.shouldAutoSyncMetadata||!J.playlistId||(E={autoSync:D},V.push($k("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",J.playlistId,"musicPlaylist",0,hT,{musicPlaylistEntityActionMetadata:E})));return GX.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,V))}M.length&&(d=M[0],H=!!d.upToDate,D&&(l=(Yw=d.shouldAutoSyncMetadata)!=null?Yw:!0,Z=(TE=d.shouldAutoSyncVideos)!=null?TE:!0,d.checkInSeconds&&(U=d.checkInSeconds)));if(H||!l)return GX.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y));h=[];fF=G[0];W=void 0;if(!fF.downloadMetadata){GX.H0(15);break}return g.c(GX,hP(z.K,fF.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:HI=GX.K,W=Number((mI=(bt=HI)==null?void 0:bt.addedTimestampMillis)!=null?mI:"0")/1E3;case 15:return g.rk(GX,17),g.c(GX,dXN(z,T,(BA=W)==null?void 0:BA.toString(),U),19);case 19:h=GX.K;g.BI(GX,18);break;case 17:f_=g.VJ(GX);if(!(f_ instanceof Error&&f_.message==="No data")){if(f_ instanceof Error&&f_.message==="Empty response body")GF(f_.message);
else return nF="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",wk="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",f_ instanceof g.HE&&f_.type==="QUOTA_EXCEEDED"&&(nF="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",wk="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),GX.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,nF,wk));GX.H0(18);break}return g.c(GX,nu(T,"musicPlaylist",z.K,t,z.L),18);case 18:if(!Z)return GX.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y));Tz=[];B=new Map;if((Ah=h)==null?0:Ah.length)for(ew=g.r(h),jx=ew.next();!jx.done;jx=ew.next())n_=jx.value,MV=n_.offlineVideoData,PI=void 0,((PI=MV)==null?0:PI.videoId)&&B.set(MV.videoId,MV);$K=new Map;FW=[];if((n=fF)==null?0:(F=n.tracks)==null?0:F.length)for(Q=g.r(fF.tracks),L=Q.next();!L.done;L=Q.next())if(N=L.value,U0=g.hR(N).entityId)B.has(U0)?($K.set(U0,B.get(U0)),B.delete(U0)):FW.push(U0);qq=Number(((th=t.actionMetadata)==null?void 0:th.priority)||0)+1;KF=g.r(B.entries());for(QJ=KF.next();!QJ.done;QJ=
KF.next())E0=QJ.value,jw=g.r(E0),U5=jw.next().value,ke=jw.next().value,yI=U5,xe=ke,Tz.push($k("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",yI,"musicTrack",qq,hT,Q9(t,xe)));ep=g.r($K.entries());for(rY=ep.next();!rY.done;rY=ep.next())i_=rY.value,Fi=g.r(i_),Zp=Fi.next().value,QT=Fi.next().value,dg=Zp,x1=QT,Tz.push($k("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",dg,"musicTrack",qq,hT,Q9(t,x1)));BT=g.r(FW);for(Gb=BT.next();!Gb.done;Gb=BT.next())dY=Gb.value,Tz.push($k("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
dY,"musicTrack",0,hT));return GX.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,Tz))}})},EEA=function(z,t){var Y,K;
return g.P(function(T){switch(T.J){case 1:return Y=im(t),g.rk(T,2),K=g.hR(t.entityKey).entityId,K==="!*$_ALL_ENTITIES_!*$"?g.c(T,Fd(z.K,t,z.L),5):g.c(T,nu(K,"musicPlaylist",z.K,t,z.L),6);case 6:return g.c(T,bIw(z.K,t.entityKey),5);case 5:g.BI(T,3);break;case 2:return g.VJ(T),T.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return T.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},dXN=function(z,t,Y,K){var T,G,v;
return g.P(function(f){switch(f.J){case 1:return g.c(f,cNz([t]),2);case 2:return T=f.K,g.c(f,Wwj(z,T[0],Y,K),3);case 3:return G=f.K,v=qC(G.thumbnailDetails),g.c(f,Uc(v),4);case 4:return f.return(T[0].videos)}})},Wwj=function(z,t,Y,K){var T,G,v,f,C,X,O,D,M;
return g.P(function(l){return l.J==1?(T=t.playlistId,G=VZ2(t),v=G.pw,f=G.oB,C=Y?(Number(Y)*1E3).toString():Date.now().toString(),X=t.lastModifiedTimestamp?(Number(t.lastModifiedTimestamp)*1E3).toString():"0",O={id:g.zj(T,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:f,lastModifiedTimestampMillis:X,addedTimestampMillis:C,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},D={id:g.zj(T,"musicPlaylist"),title:t.title,playlistId:T,thumbnailDetails:t.thumbnail,visibility:RIN(t),trackCount:t.totalVideoCount,
tracks:v,downloadMetadata:O.id},K&&(((M=D)==null?0:M.entityMetadata)?D.entityMetadata.nextAutoRefreshIntervalSeconds=String(K):D&&(D.entityMetadata={nextAutoRefreshIntervalSeconds:String(K)})),g.c(l,WY(z.K,{mode:"readwrite",bW:!0},function(Z){var H=dv(Z,D,"musicPlaylist");Z=dv(Z,O,"musicPlaylistDownloadMetadataEntity");return g.nb.all([H,Z])}),2)):l.return(D)})},RIN=function(z){switch(z.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},hI$=function(z,t){this.K=z;
this.L=t},Kk2=function(z,t){var Y,K,T,G,v,f,C,X,O,D,M,l,Z;
return g.P(function(H){switch(H.J){case 1:return Y=im(t),K=g.hR(t.entityKey),T=K.entityId,G=g.m(t.actionMetadata,zz2),g.rk(H,2),g.c(H,tQ2(z,T,void 0,(v=G)==null?void 0:v.track,(f=G)==null?void 0:f.albumRelease),4);case 4:if((C=G)==null?0:C.playlistId){H.H0(5);break}return g.c(H,wOA(z.K,t.entityKey),5);case 5:g.BI(H,3);break;case 2:return X=g.VJ(H),O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.HE&&X.type==="QUOTA_EXCEEDED"&&
(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),H.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,O,D));case 3:l=Number(((M=t.actionMetadata)==null?void 0:M.priority)||0)+1;var U=(U=g.m(t.actionMetadata,zz2))?{playbackDataActionMetadata:{maximumDownloadQuality:U.maximumDownloadQuality}}:void 0;Z=$k("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",T,"playbackData",l,YuW,U);return H.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y,[Z]))}})},To2=function(z,t){var Y,K,T,G,v,f,C,X,O,D,M,l,Z,H,U;
return g.P(function(w){switch(w.J){case 1:return Y=im(t),K=g.hR(t.entityKey),T=K.entityId,g.c(w,hP(z.K,t.entityKey,"musicTrack"),2);case 2:G=w.K;if(!G){v=void 0;w.H0(3);break}return g.c(w,hP(z.K,G.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:v=w.K;case 3:f=v;if(!G||!f)return w.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));X=g.m(t.actionMetadata,zz2);g.rk(w,5);return g.c(w,tQ2(z,T,f.addedTimestampMillis,(O=X)==null?void 0:O.track,(D=X)==null?void 0:D.albumRelease),
7);case 7:l=Number(((M=t.actionMetadata)==null?void 0:M.priority)||0)+1;C=$k("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",T,"playbackData",l,YuW);g.BI(w,6);break;case 5:Z=g.VJ(w);if(!(Z instanceof Error&&Z.message==="No data")){if(Z instanceof Error&&Z.message==="Empty response body")GF(Z.message);else return H="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",U="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Z instanceof g.HE&&Z.type==="QUOTA_EXCEEDED"&&(H="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
U="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),w.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,H,U));w.H0(6);break}return g.c(w,V9(T,z.K,t,z.L),6);case 6:return w.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,C?[C]:void 0))}})},GhV=function(z,t){var Y,K;
return g.P(function(T){switch(T.J){case 1:return Y=im(t),g.rk(T,2),K=g.hR(t.entityKey).entityId,K==="!*$_ALL_ENTITIES_!*$"?g.c(T,Fd(z.K,t,z.L),5):g.c(T,V9(K,z.K,t,z.L),6);case 6:return g.c(T,bIw(z.K,t.entityKey),5);case 5:g.BI(T,3);break;case 2:return g.VJ(T),T.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return T.return(new oK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},tQ2=function(z,t,Y,K,T){var G,v,f,C,X,O;
return g.P(function(D){switch(D.J){case 1:if(G=K){D.H0(2);break}return g.c(D,QVW([t]),3);case 3:v=D.K,f=v[0],G=BGN(f);case 2:return g.c(D,vY$(z,G,t,T,Y),4);case 4:C=D.K;X=C.musicTrackEntity;O=C.eJ;var M=qC(X.thumbnailDetails),l=[];O&&(l=qC(O.thumbnailDetails));return g.c(D,Uc(M.concat(l)),0)}})},vY$=function(z,t,Y,K,T){var G;
return g.P(function(v){return v.J==1?(T||(T=Date.now().toString()),G={id:g.zj(Y,"musicTrackDownloadMetadataEntity"),playbackData:g.zj(Y,"playbackData"),addedTimestampMillis:T,videoDownloadContextEntity:g.zj(Y,"videoDownloadContextEntity")},K&&(t.albumRelease=K.id),g.c(v,WY(z.K,{mode:"readwrite",bW:!0},function(f){var C=[],X=dv(f,G,"musicTrackDownloadMetadataEntity");C.push(X);X=dv(f,t,"musicTrack");C.push(X);K&&(f=dv(f,K,"musicAlbumRelease"),C.push(f));return g.nb.all(C)}),2)):v.J!=3?g.c(v,MC(Y,"musicTrackDownloadMetadataEntity",
z.K,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):v.return({musicTrackEntity:t,
eJ:K})})},zl=function(){xk.apply(this,arguments);
this.V="musicTrack"},AON=function(z,t,Y){t=t===void 0?43200:t;
Y=Y===void 0?!0:Y;var K=K===void 0?!1:K;var T,G;return g.P(function(v){switch(v.J){case 1:if(!z.N.ke())return v.return([]);T=[];g.rk(v,2);return g.c(v,Pg$(t,Y,K),4);case 4:T=v.K;g.BI(v,3);break;case 2:g.VJ(v);case 3:return G=sIN(z,T,Y,"musicPlaylist"),v.return(G)}})},f_$=function(){g.Zc.apply(this,arguments);
var z=this;this.events=new g.Lt(this);this.s4=this.player.G();this.EG={L15:function(){return z.K},
fN:function(){return z.fN()},
Fm:function(t){return z.Fm(t)}}},CPN=function(z){var t;
z=g.m((t=z.getWatchNextResponse())==null?void 0:t.currentVideoEndpoint,g.ES);if(z==null?0:z.playlistId)var Y=z.playlistId;return Y},XVj=function(z,t){var Y,K,T,G;
return g.P(function(v){if(v.J==1){Y=t.clientPlaybackNonce;K={cpn:Y,offlineSourceVisualElement:g.Vj(t.SL||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};t.J&&(K.videoFmt=Number(t.J.itag));t.W&&(K.audioFmt=Number(t.W.itag));if((T=CPN(t))&&t.videoId){var f=t.videoId;f=T!=="PPSV"?Promise.resolve(!1):z.K.Ac(f);v=g.c(v,f,3)}else v=v.H0(2);return v}v.J!=2&&(G=v.K)&&(K.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");z.J=Y;g.Dw("offlinePlaybackStarted",K);g.pF(v)})};
g.UQ.prototype.WB=g.GE(51,function(z){return this.app.WB(z)});
g.lG.prototype.WB=g.GE(50,function(z){return g.cTw(this,9,z)});
g.p(Iz,PY);g.vI.Object.defineProperties(Iz.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.K.entityMetadata},
set:function(z){this.K.entityMetadata=z}}});
g.p(Y9F,Iz);Y9F.prototype.J=function(){return[]};
g.p(KbN,Iz);KbN.prototype.J=function(){return[]};
g.p(Tg2,Iz);Tg2.prototype.J=function(){return[]};
g.p(Gaw,Iz);Gaw.prototype.J=function(){return[]};
g.p(v1F,Iz);v1F.prototype.J=function(){var z=[];this.K.alternateChannel&&z.push(this.K.alternateChannel);this.K.alternateChannelList&&z.push.apply(z,g.b(this.K.alternateChannelList));this.K.oneofChannelEntity&&z.push(this.K.oneofChannelEntity);return[].concat(g.b(new Set(z)))};
g.p(AGW,Iz);AGW.prototype.J=function(){var z=[];this.K.entryCollection&&z.push(this.K.entryCollection);return[].concat(g.b(new Set(z)))};
g.p(fBw,PY);fBw.prototype.J=function(){var z=[];this.K.video&&z.push(this.K.video);return[].concat(g.b(new Set(z)))};
g.p(CTN,Iz);CTN.prototype.J=function(){var z=[];this.K.parentPlaylist&&z.push(this.K.parentPlaylist);if(this.K.entries)for(var t=g.r(this.K.entries),Y=t.next();!Y.done;Y=t.next())z.push.apply(z,g.b((new fBw(Y.value)).J()));return[].concat(g.b(new Set(z)))};
g.p(XN2,Iz);XN2.prototype.J=function(){var z=[];this.K.descriptionEntity&&z.push(this.K.descriptionEntity);this.K.creators&&z.push.apply(z,g.b(this.K.creators));this.K.theBiggestFan&&z.push(this.K.theBiggestFan);return[].concat(g.b(new Set(z)))};
g.p(iU_,Iz);iU_.prototype.J=function(){return[]};
g.p(OUW,Iz);OUW.prototype.J=function(){return[]};
g.p(s9Q,Iz);s9Q.prototype.J=function(){return[]};
g.p(DmQ,Iz);DmQ.prototype.J=function(){return[]};
g.p(M5V,Iz);M5V.prototype.J=function(){return[]};
g.p(lB6,Iz);lB6.prototype.J=function(){return[]};
g.p(ZU6,Iz);ZU6.prototype.J=function(){return[]};
g.p(q9j,Iz);q9j.prototype.J=function(){return[]};
g.p(pN_,Iz);pN_.prototype.J=function(){return[]};
g.p(rGK,Iz);rGK.prototype.J=function(){var z=[];this.K.downloadsList&&z.push(this.K.downloadsList);this.K.smartDownloadsList&&z.push(this.K.smartDownloadsList);this.K.recommendedDownloadsList&&z.push(this.K.recommendedDownloadsList);this.K.refresh&&z.push(this.K.refresh);return[].concat(g.b(new Set(z)))};
g.p(HU2,PY);HU2.prototype.J=function(){var z=[];this.K.video&&z.push(this.K.video);this.K.playlist&&z.push(this.K.playlist);this.K.videoItem&&z.push(this.K.videoItem);this.K.playlistItem&&z.push(this.K.playlistItem);return[].concat(g.b(new Set(z)))};
g.p(j9Q,Iz);j9Q.prototype.J=function(){var z=[];this.K.refresh&&z.push(this.K.refresh);if(this.K.downloads)for(var t=g.r(this.K.downloads),Y=t.next();!Y.done;Y=t.next())z.push.apply(z,g.b((new HU2(Y.value)).J()));return[].concat(g.b(new Set(z)))};
g.p(Um$,Iz);Um$.prototype.J=function(){var z=[];this.K.localImageEntities&&z.push.apply(z,g.b(this.K.localImageEntities));return[].concat(g.b(new Set(z)))};
g.p(Bg6,Iz);Bg6.prototype.J=function(){var z=[];this.K.playbackData&&z.push(this.K.playbackData);this.K.localImageEntities&&z.push.apply(z,g.b(this.K.localImageEntities));this.K.videoDownloadContextEntity&&z.push(this.K.videoDownloadContextEntity);return[].concat(g.b(new Set(z)))};
g.p(wNK,Iz);wNK.prototype.J=function(){return[]};
g.p(bUw,Iz);bUw.prototype.J=function(){var z=[];this.K.fakeChildren&&z.push.apply(z,g.b(this.K.fakeChildren));return[].concat(g.b(new Set(z)))};
g.p(V5W,Iz);V5W.prototype.J=function(){var z=[];this.K.video&&z.push(this.K.video);this.K.playbackData&&z.push(this.K.playbackData);this.K.offlineVideoPolicy&&z.push(this.K.offlineVideoPolicy);return[].concat(g.b(new Set(z)))};
g.p(n1A,Iz);n1A.prototype.J=function(){return[]};
g.p(Fbz,Iz);Fbz.prototype.J=function(){var z=[];this.K.channelOwner&&z.push(this.K.channelOwner);this.K.videos&&z.push.apply(z,g.b(this.K.videos));this.K.collaboratorChannels&&z.push.apply(z,g.b(this.K.collaboratorChannels));this.K.downloadState&&z.push(this.K.downloadState);this.K.refresh&&z.push(this.K.refresh);return[].concat(g.b(new Set(z)))};
g.p(Q9z,Iz);Q9z.prototype.J=function(){var z=[];this.K.video&&z.push(this.K.video);this.K.channelContributor&&z.push(this.K.channelContributor);return[].concat(g.b(new Set(z)))};
g.p(cGN,PY);cGN.prototype.J=function(){var z=[];this.K.localImageEntities&&z.push.apply(z,g.b(this.K.localImageEntities));this.K.videoDownloadContextEntity&&z.push(this.K.videoDownloadContextEntity);return[].concat(g.b(new Set(z)))};
g.p(uR6,PY);uR6.prototype.J=function(){var z=[];this.K.recommendedVideoMetadata&&z.push.apply(z,g.b((new cGN(this.K.recommendedVideoMetadata)).J()));return[].concat(g.b(new Set(z)))};
g.p(ka2,PY);ka2.prototype.J=function(){var z=[];this.K.playbackPosition&&z.push(this.K.playbackPosition);return[].concat(g.b(new Set(z)))};
g.p($mj,Iz);$mj.prototype.J=function(){var z=[];this.K.owner&&z.push(this.K.owner);this.K.downloadState&&z.push(this.K.downloadState);this.K.userState&&z.push.apply(z,g.b((new ka2(this.K.userState)).J()));this.K.additionalMetadata&&z.push.apply(z,g.b((new uR6(this.K.additionalMetadata)).J()));return[].concat(g.b(new Set(z)))};
g.p(o1$,Iz);o1$.prototype.J=function(){var z=[];this.K.userChannelDetails&&z.push(this.K.userChannelDetails);return[].concat(g.b(new Set(z)))};
g.p(LbN,Iz);LbN.prototype.J=function(){var z=[];this.K.channelOwner&&z.push(this.K.channelOwner);this.K.playbackPosition&&z.push(this.K.playbackPosition);this.K.localImageEntities&&z.push.apply(z,g.b(this.K.localImageEntities));this.K.downloadStatus&&z.push(this.K.downloadStatus);return[].concat(g.b(new Set(z)))};
g.p(PT$,Iz);PT$.prototype.J=function(){return[]};
g.p(IBV,Iz);IBV.prototype.J=function(){return[]};
g.p(aBF,Iz);aBF.prototype.J=function(){return[]};
g.p(g1j,Iz);g1j.prototype.J=function(){return[]};
g.p(JG$,Iz);JG$.prototype.J=function(){return[]};
g.p(mmw,Iz);mmw.prototype.J=function(){return[]};
g.p(NgN,Iz);NgN.prototype.J=function(){return[]};
g.p(yGQ,Iz);yGQ.prototype.J=function(){return[]};
g.p(eDz,Iz);eDz.prototype.J=function(){return[]};
g.p(dmW,Iz);dmW.prototype.J=function(){return[]};
g.p(xmK,Iz);xmK.prototype.J=function(){return[]};
g.p(S9z,Iz);S9z.prototype.J=function(){var z=[];this.K.trackDownloadMetadatas&&z.push.apply(z,g.b(this.K.trackDownloadMetadatas));return[].concat(g.b(new Set(z)))};
g.p(E1$,Iz);
E1$.prototype.J=function(){var z=[];this.K.downloadedTracks&&z.push.apply(z,g.b(this.K.downloadedTracks));this.K.smartDownloadedTracks&&z.push.apply(z,g.b(this.K.smartDownloadedTracks));this.K.downloadedEpisodes&&z.push.apply(z,g.b(this.K.downloadedEpisodes));this.K.downloadedAlbumReleases&&z.push.apply(z,g.b(this.K.downloadedAlbumReleases));this.K.smartDownloadedAlbumReleases&&z.push.apply(z,g.b(this.K.smartDownloadedAlbumReleases));this.K.downloadedPlaylists&&z.push.apply(z,g.b(this.K.downloadedPlaylists));this.K.smartDownloadedPlaylists&&
z.push.apply(z,g.b(this.K.smartDownloadedPlaylists));this.K.metadataOnlyTracks&&z.push.apply(z,g.b(this.K.metadataOnlyTracks));return[].concat(g.b(new Set(z)))};
g.p(WbN,Iz);WbN.prototype.J=function(){var z=[];this.K.trackDownloadMetadatas&&z.push.apply(z,g.b(this.K.trackDownloadMetadatas));return[].concat(g.b(new Set(z)))};
g.p(RD$,Iz);RD$.prototype.J=function(){var z=[];this.K.playbackData&&z.push(this.K.playbackData);this.K.localImageEntities&&z.push.apply(z,g.b(this.K.localImageEntities));this.K.videoDownloadContextEntity&&z.push(this.K.videoDownloadContextEntity);return[].concat(g.b(new Set(z)))};
g.p(hDj,Iz);hDj.prototype.J=function(){var z=[];this.K.musicLibraryStatusEntity&&z.push(this.K.musicLibraryStatusEntity);this.K.primaryArtists&&z.push.apply(z,g.b(this.K.primaryArtists));this.K.details&&z.push(this.K.details);this.K.userDetails&&z.push(this.K.userDetails);this.K.tracks&&z.push.apply(z,g.b(this.K.tracks));this.K.share&&z.push(this.K.share);this.K.downloadMetadata&&z.push(this.K.downloadMetadata);this.K.refresh&&z.push(this.K.refresh);return[].concat(g.b(new Set(z)))};
g.p(zyj,Iz);zyj.prototype.J=function(){var z=[];this.K.albumRelease&&z.push(this.K.albumRelease);this.K.tracks&&z.push.apply(z,g.b(this.K.tracks));return[].concat(g.b(new Set(z)))};
g.p(tbA,Iz);tbA.prototype.J=function(){var z=[];this.K.albumRelease&&z.push(this.K.albumRelease);return[].concat(g.b(new Set(z)))};
g.p(Y6K,Iz);Y6K.prototype.J=function(){var z=[];this.K.details&&z.push(this.K.details);this.K.userDetails&&z.push(this.K.userDetails);return[].concat(g.b(new Set(z)))};
g.p(KDj,Iz);KDj.prototype.J=function(){var z=[];this.K.parentArtist&&z.push(this.K.parentArtist);return[].concat(g.b(new Set(z)))};
g.p(TfQ,Iz);TfQ.prototype.J=function(){var z=[];this.K.parentArtist&&z.push(this.K.parentArtist);return[].concat(g.b(new Set(z)))};
g.p(GYj,Iz);GYj.prototype.J=function(){return[]};
g.p(v0j,Iz);v0j.prototype.J=function(){return[]};
g.p(A6$,PY);A6$.prototype.J=function(){var z=[];this.K.creatorEntity&&z.push(this.K.creatorEntity);return[].concat(g.b(new Set(z)))};
g.p(fl$,Iz);
fl$.prototype.J=function(){var z=[];this.K.tracks&&z.push.apply(z,g.b(this.K.tracks));this.K.refresh&&z.push(this.K.refresh);this.K.musicLibraryStatusEntity&&z.push(this.K.musicLibraryStatusEntity);this.K.details&&z.push(this.K.details);this.K.downloadMetadata&&z.push(this.K.downloadMetadata);this.K.sideloadMetadata&&z.push(this.K.sideloadMetadata);this.K.userDetails&&z.push(this.K.userDetails);this.K.entryCollection&&z.push(this.K.entryCollection);this.K.share&&z.push(this.K.share);this.K.podcastShowAdditionalMetadata&&z.push.apply(z,
g.b((new A6$(this.K.podcastShowAdditionalMetadata)).J()));return[].concat(g.b(new Set(z)))};
g.p(CBF,Iz);CBF.prototype.J=function(){return[]};
g.p(XvN,Iz);
XvN.prototype.J=function(){var z=[];this.K.musicLibraryStatusEntity&&z.push(this.K.musicLibraryStatusEntity);this.K.artists&&z.push.apply(z,g.b(this.K.artists));this.K.audioModeVersion&&z.push(this.K.audioModeVersion);this.K.videoModeVersion&&z.push(this.K.videoModeVersion);this.K.userDetails&&z.push(this.K.userDetails);this.K.details&&z.push(this.K.details);this.K.albumRelease&&z.push(this.K.albumRelease);this.K.share&&z.push(this.K.share);this.K.libraryEdit&&z.push(this.K.libraryEdit);this.K.downloadMetadata&&
z.push(this.K.downloadMetadata);this.K.playbackPosition&&z.push(this.K.playbackPosition);this.K.lyrics&&z.push(this.K.lyrics);return[].concat(g.b(new Set(z)))};
g.p(ic6,Iz);ic6.prototype.J=function(){var z=[];this.K.parentTrack&&z.push(this.K.parentTrack);return[].concat(g.b(new Set(z)))};
g.p(Ocz,Iz);Ocz.prototype.J=function(){var z=[];this.K.parentTrack&&z.push(this.K.parentTrack);return[].concat(g.b(new Set(z)))};
g.p(sSN,Iz);sSN.prototype.J=function(){return[]};
g.p(Db$,Iz);Db$.prototype.J=function(){return[]};
g.p(Mbw,Iz);Mbw.prototype.J=function(){return[]};
g.p(ll6,Iz);ll6.prototype.J=function(){return[]};
g.p(Zc6,Iz);Zc6.prototype.J=function(){var z=[];this.K.transfer&&z.push(this.K.transfer);this.K.adsPlaybackData&&z.push.apply(z,g.b(this.K.adsPlaybackData));this.K.drmLicense&&z.push(this.K.drmLicense);this.K.offlineVideoPolicy&&z.push(this.K.offlineVideoPolicy);this.K.videoDownloadContextEntity&&z.push(this.K.videoDownloadContextEntity);return[].concat(g.b(new Set(z)))};
g.p(q6$,Iz);q6$.prototype.J=function(){return[]};
g.p(pvV,Iz);pvV.prototype.J=function(){var z=[];this.K.offlineVideoStreams&&z.push.apply(z,g.b(this.K.offlineVideoStreams));this.K.captionTrack&&z.push.apply(z,g.b(this.K.captionTrack));return[].concat(g.b(new Set(z)))};
g.p(r6N,Iz);r6N.prototype.J=function(){return[]};
g.p(Hc_,Iz);Hc_.prototype.J=function(){return[]};
g.p(jSA,Iz);jSA.prototype.J=function(){return[]};
g.p(UbF,Iz);UbF.prototype.J=function(){return[]};
g.p(BfK,Iz);BfK.prototype.J=function(){return[]};
g.p(wvW,Iz);wvW.prototype.J=function(){return[]};
g.p(bcF,Iz);bcF.prototype.J=function(){return[]};
g.p(VbW,Iz);VbW.prototype.J=function(){return[]};
g.p(n0$,Iz);n0$.prototype.J=function(){return[]};
g.p(FDz,Iz);FDz.prototype.J=function(){return[]};
g.p(QS$,Iz);QS$.prototype.J=function(){return[]};
g.p(c6A,Iz);c6A.prototype.J=function(){return[]};
g.p(u4z,Iz);u4z.prototype.J=function(){return[]};
g.p(kY$,Iz);kY$.prototype.J=function(){return[]};
g.p($bA,Iz);$bA.prototype.J=function(){return[]};
g.p(o02,Iz);o02.prototype.J=function(){return[]};
g.p(LDA,Iz);LDA.prototype.J=function(){return[]};
g.p(PBF,Iz);PBF.prototype.J=function(){return[]};
g.p(Il$,Iz);Il$.prototype.J=function(){return[]};
g.p(al$,Iz);al$.prototype.J=function(){return[]};
var IMK=["browse","music/browse","unplugged/browse"],NGN=["offline/playlist_sync_check"],FaN=["offline"],aMw=["offline/offline_video_playback_position_sync"],JN$=["offline/get_playback_data_entity"],az;gv.getInstance=function(){return g.P(function(z){return z.return(new Promise(function(t){g.YO().then(function(Y){Y?(gv.instance||(gv.instance=new gv(Y)),t(gv.instance)):t(void 0)})}))})};
gv.prototype.get=function(z){var t=this,Y,K,T;return g.P(function(G){if(G.J==1)return g.c(G,Nf2(t.token),2);if(G.J!=3)return Y=G.K,g.c(G,Y.get("prefs",z),3);K=G.K;if(!K)return G.return();T=(0,g.y)();return K.expirationTimestampMs<=T?G.return():G.return(K.value)})};
gv.prototype.set=function(z,t,Y){Y=Y===void 0?31536E3:Y;var K=this,T,G,v;return g.P(function(f){if(f.J==1)return T=(0,g.y)(),G={key:z,value:t,expirationTimestampMs:T+Y*1E3},g.c(f,Nf2(K.token),2);v=f.K;return g.c(f,g.PE(v,"prefs",G),0)})};
gv.prototype.remove=function(z){var t=this,Y;return g.P(function(K){if(K.J==1)return g.c(K,Nf2(t.token),2);Y=K.K;return g.c(K,Y.delete("prefs",z),0)})};
g.p(JP,g.E$);g.p(mH,S6w);mH.prototype.L=function(z,t){t=WDQ(t);z=(new TextEncoder).encode(JSON.stringify(z));return this.K.encrypt(z,t)};
mH.prototype.J=function(z,t){if(!(z instanceof Uint8Array))throw y6A(1);var Y=new TextDecoder;t=WDQ(t);z=this.K.decrypt(z,t);return JSON.parse(Y.decode(z))};
var Ry2={accountLinkStatusEntity:s9Q,booleanEntity:Tg2,buttonEntity:u4z,captionTrack:sSN,channelHandle:Y9F,commerceAcquisitionClientPayloadEntity:$bA,commerceCartListEntity:o02,contextNoteFeedEntityPayload:KbN,continuationTokenEntity:n1A,downloadQualityPickerEntity:ZU6,downloadsPageRefreshTokenEntity:pN_,downloadsPageViewConfigurationEntity:PT$,downloadStatusEntity:q9j,dismissState:bcF,sfvAudioItemCurrentlyPlayingEntity:UbF,emojiFountainDataEntity:QS$,emojiCustomizationSetEntity:FDz,fakeChannel:v1F,
fakePlaylist:AGW,fakePlaylistEntryCollection:CTN,fakeVideo:XN2,fakeVideoDescription:iU_,featuredProductsEntity:eDz,flowStateEntity:OUW,iconBadgeEntity:LDA,interstitialInteractionStateEntity:M5V,likeButtonAnimationEntity:IBV,liveChatPollStateEntity:lB6,liveViewerLeaderboardChatEntryPointStateEntity:Hc_,liveViewerLeaderboardPointsEntity:jSA,liveReactionsDataEntity:c6A,logoEntity:DmQ,macroMarkerEntity:aBF,mainDownloadsLibraryEntity:rGK,mainDownloadsListEntity:j9Q,mainPlaylistDownloadStateEntity:Um$,
mainPlaylistEntity:Fbz,mainPlaylistVideoEntity:Q9z,mainVideoDownloadStateEntity:Bg6,mainVideoEntity:$mj,markersEngagementPanelSyncEntity:g1j,markersVisibilityOverrideEntity:JG$,musicAlbumReleaseDetail:zyj,musicAlbumReleaseDownloadMetadataEntity:S9z,musicAlbumRelease:hDj,musicAlbumReleaseUserDetail:tbA,musicArtistDetail:KDj,musicArtist:Y6K,musicArtistUserDetail:TfQ,musicDownloadsLibraryEntity:E1$,musicLibraryEdit:GYj,musicLibraryStatusEntity:v0j,musicPlaylist:fl$,musicPlaylistDownloadMetadataEntity:WbN,
musicShare:CBF,musicTrackDetail:ic6,musicTrackDownloadMetadataEntity:RD$,musicTrack:XvN,musicTrackUserDetail:Ocz,offlineOrchestrationActionWrapperEntity:Db$,offlineVideoPolicy:Mbw,offlineVideoStreams:ll6,offlineabilityEntity:wNK,orchestrationWebSamplingEntity:bUw,pageHeaderEntity:VbW,pdpStateEntity:PBF,pinnedProductEntity:dmW,playbackData:Zc6,playerStateEntity:mmw,quantityIncrementerEntity:Il$,refresh:q6$,saveToPlaylistListEntity:BfK,settingEntity:wvW,stringEntity:Gaw,suggestedFeedbackChipStateEntity:NgN,
transfer:pvV,trendingOfferEntity:xmK,videoDownloadContextEntity:r6N,videoOverviewAsyncDataEntity:al$,videoPlaybackPositionEntity:kY$,votingEntity:n0$,ytMainChannelEntity:o1$,youchatPendingResponseEntity:yGQ,ytMainDownloadedVideoEntity:V5W,ytMainVideoEntity:LbN};g.p(Su,S6w);Su.prototype.L=function(z){return z};
Su.prototype.J=function(z){if(z instanceof Uint8Array)throw y6A(0);return z};
g.p(Et,g.I);Et.prototype.observe=function(z){var t=this;this.observers.push(z);return function(){var Y=t.observers.indexOf(z);Y>=0&&t.observers.splice(Y,1)}};
Et.prototype.J=function(z){OO_(this,z.data)};
Et.prototype.W0=function(){this.channel.close()};
var ZOj,MZj=new g.ng("elementsCommand");var wQ=new g.ng("entityBatchUpdate");var KaK=new g.ng("downloadStatusEntity");var p3N=new g.ng("mainPlaylistEntityActionMetadata");var WB=new g.ng("mainVideoEntityActionMetadata");var n7F=new g.ng("musicPlaylistEntityActionMetadata");var zz2=new g.ng("musicTrackEntityActionMetadata");var $Xj=new g.ng("localImageEntityActionMetadata");var Lu=new g.ng("playbackDataActionMetadata");var lRQ=new g.ng("transferEntityActionMetadata");var td$=new g.ng("videoPlaybackPositionEntityActionMetadata");var uB2;new g.DM;new g.DM;PNw.prototype.request=function(z,t,Y){t=t===void 0?{}:t;return this.locks.request(z,t,function(K){return Y(K)})};var TF=g.eP.caches,Ku,mJz;Yk.prototype.open=function(z){return TF.open(gAV(z))};
Yk.prototype.has=function(z){return TF.has(gAV(z))};
Yk.prototype.delete=function(z){return TF.delete(gAV(z))};
Yk.prototype.match=function(z,t){var Y=this,K,T,G,v,f,C;return g.P(function(X){switch(X.J){case 1:return g.c(X,Y.keys(),2);case 2:K=X.K,T=g.r(K),G=T.next();case 3:if(G.done){X.H0(5);break}v=G.value;return g.c(X,Y.open(v),6);case 6:return f=X.K,g.c(X,f.match(z,t),7);case 7:if(C=X.K)return X.return(C);G=T.next();X.H0(3);break;case 5:return X.return()}})};
g.p(aFz,Yk);aFz.prototype.keys=function(){var z,t,Y,K,T,G,v,f,C;return g.P(function(X){if(X.J==1)return z=[],t=g.WL("CacheStorage keys"),g.c(X,TF.keys(),2);Y=X.K;K=g.r(Y);for(T=K.next();!T.done;T=K.next()){G=T.value;var O=G.indexOf(":");v=O===-1?{U$:G}:{U$:G.substring(0,O),datasyncId:G.substring(O+1)};f=v.U$;C=v.datasyncId;C===t&&z.push(f)}return X.return(z)})};g.p(vB,g.I);vB.prototype.L=function(z){this.api.G5("onOfflineOperationFailure",z.data)};
vB.prototype.W=function(z){this.api.publish("offlinetransferpause",z.data)};
vB.prototype.W0=function(){var z;(z=this.K)==null||z.close();var t;(t=this.J)==null||t.close()};eLW.prototype.JW=function(){this.K&&fu(this)};
eLW.prototype.RL=function(){this.J&&this.J.resolve();this.L=this.K=!1;this.V()};var uUV=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var OI$="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var UZQ="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.p(eYV,kk);eYV.prototype.J=function(z){return Oc(z)?SDF(this,z):sc(z)?RYN(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};g.p(hYA,kk);hYA.prototype.J=function(z){return sc(z)?zPw(this,z):YDA(z)?YVF(this,z):D4(z)?KdK(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};g.q=Ts_.prototype;g.q.lRt=function(z){var t=this,Y,K,T,G;return g.P(function(v){if(!g.x(z.state,128))return v.H0(0);Y=z.state.r0;var f=(K=Y)==null?void 0:K.errorCode,C=(T=Y)==null?void 0:T.fB;G=f==="net.connect"&&C===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(f==null?0:f.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.c(v,t.WY(t.player.getVideoData().videoId,G),0)})};
g.q.WY=function(z,t){var Y=this;return g.P(function(K){if(K.J==1){if(Y.J)return K.return();Y.J=!0;return t==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(aK(Y,z,!1,!0),K.H0(0)):g.c(K,IK(Y,z),3)}g.Ff(z,4);return g.c(K,Y.K.WY(t),0)})};
g.q.Hq=function(z){z.status===2?(z.status!==this.L&&(zIV(this.K),g.Ff(z.videoId,2)),z.Yx&&GRQ(this.K,z.videoId,z.Yx)):z.status===4?(IK(this,z.videoId),this.WY(z.videoId,z.Vw?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):z.status===1&&TT6(this.K);this.L=z.status;this.api.G5("localmediachange",{videoId:z.videoId,status:z.status})};
g.q.wO=function(){var z=this,t;return g.P(function(Y){if(Y.J==1){if(z.J)return Y.return();z.J=!0;t=z.player.getVideoData().videoId;return g.c(Y,IK(z,t),2)}return g.c(Y,z.K.wO(),0)})};
g.q.W5=function(z){switch(z){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.q.X=function(z){return this.api.G().X(z)};g.p(iT$,kk);iT$.prototype.J=function(z){return Oc(z)?s06(this,z):sc(z)?DDA(this,z):YDA(z)?Md$(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};HTA.prototype.K=function(z,t){var Y=z.action.actionMetadata.priority-t.action.actionMetadata.priority;Y===0&&(z.K<t.K?Y=-1:z.K>t.K&&(Y=1));return Y};g.p(gQ,g.I);gQ.prototype.W0=function(){this.V&&this.V();g.I.prototype.W0.call(this)};
gQ.prototype.createAction=function(z,t){var Y=g.hR(z.entityKey).entityType,K=g.Vr(16);return new pu(Y,K,z,t.actionId,t.rootActionId)};
gQ.prototype.J3=function(z){var t=this,Y,K,T,G,v,f,C,X,O;return g.P(function(D){if(D.J==1){if(t.m6())return D.return();K=(Y=z.offlineOrchestrationActionWrapperEntity)!=null?Y:new Set;T=[];G=g.r(K);for(v=G.next();!v.done;v=G.next())f=v.value,C=g.hR(f),X=C.entityId,Bs_(t.K,X)||T.push(f);return g.c(D,oi$(t,T),2)}O=D.K;return g.c(D,$Dj(t,O),0)})};
gQ.prototype.retry=function(){var z=this;return g.P(function(t){return g.c(t,Ld$(z),0)})};IRj.prototype.tU=function(z,t){t=t===void 0?!0:t;var Y=this,K,T,G,v,f,C,X,O;return g.P(function(D){switch(D.J){case 1:if(!Y.K)return D.return();K=[];T=g.K5(Y.K.J,t);G=[];for(v={SI:0};v.SI<T.length;v={SI:v.SI},v.SI++)f=T[v.SI],C=Y.K.uP(f,"json3"),X=g.uj(C,{withCredentials:!0,format:"RAW"},3,500).then(function(M){return function(l){l={metadata:g.Dx(T[M.SI]),trackData:l.xhr.responseText};G.push(l)}}(v)).PW(function(M){GF("Caption fetch error",M)}),K.push(X);
return g.c(D,t5V(K),2);case 2:return g.rk(D,3),g.c(D,wwF(z,G),5);case 5:g.BI(D,0);break;case 3:O=g.VJ(D),GF("Caption DB transaction error",O),g.pF(D)}})};g.p(JT,g.I);JT.prototype.W0=function(){this.J&&this.J();g.I.prototype.W0.call(this)};
JT.prototype.L=function(z){var t=this,Y,K,T,G,v,f,C,X;return g.P(function(O){K=(Y=z.transfer)!=null?Y:new Set;T=[];G=g.r(K);for(v=G.next();!v.done;v=G.next())f=v.value,C=g.hR(f),X=C.entityId,T.push(X);return T.length===0?O.return():g.c(O,J0Q(t,T),0)})};g.p(dDz,g.I);g.q=dDz.prototype;g.q.W0=function(){this.eL&&this.eL();this.E4.dispose();this.W.dispose();this.SL&&g.tJ(this.N.Ot,this.SL);this.Nw&&g.tJ(this.N.Ot,this.Nw);g.I.prototype.W0.call(this)};
g.q.d54=function(z){var t=this,Y,K,T;return g.P(function(G){switch(G.J){case 1:Y=g.zj(z,"transfer");if(t.K&&Y===t.K.key){aK(t.C,t.U,!0);t.W.stop();G.H0(0);break}return g.c(G,WY(t.J,{mode:"readwrite",bW:!0},function(v){return NW(v,Y,"transfer").then(function(f){if(f&&f.transferState!=="TRANSFER_STATE_COMPLETE"&&f.transferState!=="TRANSFER_STATE_FAILED")return f.transferState="TRANSFER_STATE_PAUSED_BY_USER",dv(v,f,"transfer").then(function(){return f})})}),3);
case 3:K=G.K;if(!K){G.H0(0);break}if(!z||!t.L){G.H0(5);break}return g.c(G,MC(z,t.L,t.J,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.c(G,y9(t,z),7);case 7:T=G.K,zY2({videoId:z,Jn:K,offlineModeType:T}),g.pF(G)}})};
g.q.aN0=function(){var z=this;if(this.K&&this.U){aK(this.C,this.U,!1);var t=this.K,Y=(t==null?0:t.key)?g.hR(t.key).entityId:"";Y&&this.L&&(new Promise(function(K,T){MC(Y,z.L,z.J,"DOWNLOAD_STATE_PAUSED").catch(function(G){T(G)})})).catch(function(K){GF("Download state setting error",K)})}this.W.stop()};
g.q.Z2=function(){this.K?EiA(this,this.K):NC(this)};
g.q.oa=function(z){var t=this;return g.P(function(Y){switch(Y.J){case 1:if(!t.K){Y.H0(2);break}if(t.K.transferState==="TRANSFER_STATE_COMPLETE"||t.K.transferState==="TRANSFER_STATE_FAILED"||!z.transfer||!z.transfer.has(t.K.key)){Y.H0(3);break}return g.c(Y,hP(t.J,t.K.key,"transfer"),4);case 4:t.K=Y.K;if(t.K){Y.H0(3);break}return g.c(Y,Wd2(t),3);case 3:if(t.K)return Y.return();case 2:return g.c(Y,NC(t),0)}})};
g.q.WY=function(z,t){var Y=this,K,T,G,v,f;return g.P(function(C){switch(C.J){case 1:if(!Y.K){eA(Y,"onTransferFailure: "+z);C.H0(2);break}K=Y.K;G=((T=K)==null?0:T.key)?g.hR(K.key).entityId:"";a:switch(z){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var X=!1;break a;default:X=!0}return X&&vEW(Y)?g.c(C,dQ(Y,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.c(C,
Av$(Y,z),5);case 5:if(!G||!Y.L){C.H0(2);break}return g.c(C,MC(G,Y.L,Y.J,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.c(C,y9(Y,G),9);case 9:v=C.K;Xd({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:G,Jn:K,offlineModeType:v});if(!G||!Y.L){C.H0(2);break}return g.c(C,MC(G,Y.L,Y.J,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:mA(Y),f=NC(Y,!0),t&&t(f),g.pF(C)}})};
g.q.wO=function(z){var t=this,Y,K,T,G,v,f,C,X,O,D,M,l;return g.P(function(Z){switch(Z.J){case 1:if(!t.K){eA(t,"onMaybeTransferStreamsExpired");Z.H0(2);break}return vEW(t)?g.c(Z,dQ(t,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.c(Z,Av$(t,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!t.L){Z.H0(2);break}Y=t.K;T=((K=Y)==null?0:K.key)?g.hR(Y.key).entityId:"";if(!T){Z.H0(2);break}return g.c(Z,MC(T,t.L,t.J,"DOWNLOAD_STATE_FAILED"),2);case 9:return t.K||eA(t,"onMaybeTransferStreamsExpiredRetryAttempting"),
G=t.K,f=((v=G)==null?0:v.key)?g.hR(G.key).entityId:"",g.c(Z,y9(t,f),10);case 10:return C=Z.K,Xd({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:f,Jn:G,offlineModeType:C}),X=v7w(),g.yj(X,Lu,{isEnqueuedForExpiredStreamUrlRefetch:!0}),O=g.zj(f,"playbackData"),D={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:O,actionMetadata:X},M=HB(new pu("playbackData",f,D)),g.c(Z,Rz(t.J,M,"offlineOrchestrationActionWrapperEntity"),2);case 2:mA(t),l=NC(t,!0),
z&&z(l),g.pF(Z)}})};
var ig_={},fDN=(ig_.TRANSFER_STATE_TRANSFERRING=1,ig_.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,ig_);g.q=xk.prototype;g.q.Qd=function(){return this.U.promise};
g.q.jr=function(){if(this.J&&this.C)return this.U.promise;i2W(this).then(this.U.resolve).catch(this.U.reject);return this.U.promise};
g.q.uh=function(z){var t={};return t.playbackData=new eYV(z,this.s4,this.K),t.transfer=new iT$(z,this.s4),t.videoPlaybackPositionEntity=new hYA(z,this.s4),t};
g.q.s5=function(){var z=this;return g.P(function(t){return z.J?g.c(t,xDA(z.J),0):t.H0(0)})};
g.q.rG=function(){var z=this,t,Y;return g.P(function(K){if(K.J==1)return z.J||z.C?g.c(K,z.Qd(),2):K.return();z.B!==void 0&&(g.Hp(z.B),z.B=void 0);z.W!==void 0&&(g.Hp(z.W),z.W=void 0);(t=z.J)==null||t.dispose();z.J=void 0;(Y=z.C)==null||Y.dispose();z.C=void 0;z.api.G5("onOrchestrationLostLeader");z.U=new g.DM;g.pF(K)})};
g.q.isOrchestrationLeader=function(){return this.L.K};
g.q.Ac=function(){return g.P(function(z){return z.return(!1)})};
g.q.WX=function(z){var t=this.K;t.api.publish("offlinetransferpause",z);var Y;(Y=t.J)==null||Y.postMessage(z)};
g.q.Z2=function(z){var t,Y;return g.P(function(K){if(K.J==1)return g.c(K,tT(),2);t=K.K;if(!t)return K.return();Y=g.zj(z,"transfer");return g.c(K,WY(t,{mode:"readwrite",bW:!0},function(T){var G=NW(T,Y,"transfer"),v=NW(T,g.zj(z,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.nb.all([G,v]).then(function(f){f=g.r(f);var C=f.next().value;var X=f.next().value;return C&&C.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(C.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",dv(T,C,"transfer").then(function(){Xd({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:z,Jn:C,offlineModeType:X==null?void 0:X.offlineModeType});return g.nb.resolve(null)})):g.nb.resolve(null)})}),0)})};
g.q.U6=function(z){z=z===void 0?43200:z;var t=this,Y,K,T,G,v,f,C,X;return g.P(function(O){if(O.J==1)return t.N.ke()?g.c(O,tT(),2):O.return(O2_());if(O.J!=3){Y=O.K;if(!Y)return O.return([]);K=Date.now()/1E3;return g.c(O,zF(Y,"offlineVideoPolicy"),3)}T=O.K;G=[];v=g.r(T);for(f=v.next();!f.done;f=v.next())C=f.value,Number(C.lastUpdatedTimestampSeconds)+z<=K&&(X=g.hR(C.key).entityId,G.push(X));return G.length?O.return(SA(t,G,t.V,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):O.return([])})};
g.q.deleteAll=function(){return SA(this,["!*$_ALL_ENTITIES_!*$"],this.V,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.q.refreshAllStaleEntities=function(z){var t=this;return g.P(function(Y){return Y.J==1?g.c(Y,t.U6(z),2):Y.return(Y.K)})};
g.q.setUpPositionSyncInterval=function(z){var t=this;this.W!==void 0&&(g.Hp(this.W),this.W=void 0);var Y=z!=null?z:864E5;this.W=g.pr(function(){t.YJ(Y)},Y)};
g.q.YJ=function(z){var t=this,Y,K,T,G,v,f;return g.P(function(C){switch(C.J){case 1:return g.rk(C,2),g.c(C,gv.getInstance(),4);case 4:Y=C.K;if(!Y)throw Error("prefStorage is undefined");return g.c(C,Y.get("psi"),5);case 5:K=C.K;G=((T=K)==null?0:T.rK)?Number(K.rK)/1E3:0;v=Date.now();if(!(G+z<=v)){C.H0(6);break}return g.c(C,SA(t,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.BI(C,0);break;case 2:f=g.VJ(C),GF("Offline manager error",f),
g.pF(C)}})};
g.q.T4=function(){var z=this,t,Y,K,T,G,v,f;return g.P(function(C){if(C.J==1)return g.c(C,tT(),2);if(C.J!=3)return(t=C.K)?g.c(C,zF(t,"transfer"),3):C.return([]);Y=C.K;K=[];T=g.r(Y);for(G=T.next();!G.done;G=T.next())v=G.value,v.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&v.key&&(f=g.hR(v.key).entityId,K.push(f));return C.return(DXK(z,K))})};
g.q.Yg=function(){return g.P(function(z){return z.return([])})};
g.q.wR=function(){return g.P(function(z){g.pF(z)})};
g.q.Ju=function(){return g.P(function(z){g.pF(z)})};g.p(MqN,kk);MqN.prototype.J=function(z){return Oc(z)?qn2(this,z):sc(z)?rvW(this,z):D4(z)?H26(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};
var Ec=[10];g.p(b22,kk);b22.prototype.J=function(z){return Oc(z)?Fww(this,z):sc(z)?QIF(this,z):D4(z)?cvW(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};
var nEN=[10];g.p(kRF,kk);kRF.prototype.J=function(z){return sc(z)?oE2(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};g.p(LwA,xk);g.q=LwA.prototype;g.q.uh=function(z){var t=xk.prototype.uh.call(this,z);t.mainVideoEntity=new b22(z,this.s4,this.K);t.mainPlaylistEntity=new MqN(z,this.s4,this.K);t.mainDownloadsListEntity=new kRF(z,this.s4,this.K);return t};
g.q.refreshAllStaleEntities=function(z,t){var Y=this,K,T,G,v,f,C,X,O,D,M,l;return g.P(function(Z){switch(Z.J){case 1:K=[];if(!Y.s4.X("web_player_offline_playlist_auto_refresh")){Z.H0(2);break}return g.c(Z,PzF(Y,z,t),3);case 3:K=Z.K;case 2:return g.c(Z,gv.getInstance(),4);case 4:return T=Z.K,g.c(Z,(G=T)==null?void 0:G.get("sdois"),5);case 5:return v=Z.K,g.c(Z,(f=T)==null?void 0:f.get("lmqf"),6);case 6:C=Z.K;if(!v){Z.H0(7);break}O=K;D=O.concat;return g.c(Z,IDW(Y,v,(X=C)!=null?X:"SD",z===0),8);case 8:K=
D.call(O,Z.K);case 7:return M=K,l=M.concat,g.c(Z,xk.prototype.refreshAllStaleEntities.call(Y,z,t),9);case 9:return K=l.call(M,Z.K),Z.return(K)}})};
g.q.Ac=function(z){var t,Y,K,T,G,v,f,C;return g.P(function(X){if(X.J==1)return g.c(X,tT(),2);if(X.J!=3)return(t=X.K)?g.c(X,hP(t,g.op,"mainDownloadsListEntity"),3):X.return(!1);Y=X.K;if((K=Y)==null?0:(T=K.downloads)==null?0:T.length)for(G=g.zj(z,"mainVideoEntity"),v=g.r(Y.downloads),f=v.next();!f.done;f=v.next())if(C=f.value,C.videoItem===G)return X.return(!0);return X.return(!1)})};
g.q.Yg=function(){var z=this,t,Y,K,T,G,v,f,C;return g.P(function(X){if(X.J==1)return g.c(X,tT(),2);if(X.J!=3)return(t=X.K)?g.c(X,zF(t,"downloadStatusEntity"),3):X.return([]);Y=X.K;K=[];T=g.r(Y);for(G=T.next();!G.done;G=T.next())v=G.value,v.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&v.key&&(f=g.hR(v.key).entityId,K.push(f));return K.length?(C={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},X.return(SA(z,K,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
C))):X.return([])})};
g.q.Ju=function(){var z;return g.P(function(t){return t.J==1?g.c(t,tT(),2):(z=t.K)?g.c(t,WY(z,{mode:"readwrite",bW:!0},function(Y){return yM(Y,"mainVideoEntity").then(function(K){var T=[];K=g.r(K);for(var G=K.next();!G.done;G=K.next()){G=G.value;var v=void 0;(v=G.userState)!=null&&v.playbackPosition||(v=g.hR(G.key).entityId,v={key:g.zj(v,"videoPlaybackPositionEntity"),videoId:v,lastPlaybackPositionSeconds:"0"},T.push(dv(Y,v,"videoPlaybackPositionEntity")),G.userState={playbackPosition:v.key},T.push(dv(Y,
G,"mainVideoEntity")))}return g.nb.all(T)})}),0):t.return()})};
g.q.wR=function(){var z,t,Y,K,T,G,v,f,C,X,O,D,M,l,Z,H,U,w,V,u,k,J,E,d,Yw,TE,h,fF,W,HI,bt,mI,BA,f_,nF,wk,Tz,B;return g.P(function(Ah){if(Ah.J==1)return g.c(Ah,tT(),2);if(Ah.J!=3){z=Ah.K;if(!z)return Ah.return();t=g.zj("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.c(Ah,WY(z,{mode:"readonly",bW:!0},function(ew){return g.nb.all([NW(ew,t,"mainDownloadsListEntity"),NW(ew,g.op,"mainDownloadsListEntity"),yM(ew,"mainVideoEntity"),yM(ew,"mainPlaylistEntity")])}),3)}Y=Ah.K;
K=g.r(Y);T=K.next().value;G=K.next().value;v=K.next().value;f=K.next().value;C=T;X=G;O=v;D=f;M=new Set;if((l=C)==null?0:(Z=l.downloads)==null?0:Z.length)for(H=g.r(C.downloads),U=H.next();!U.done;U=H.next())w=U.value,V=void 0,(u=(V=w.videoItem)!=null?V:w.playlistItem)&&M.add(u);if((k=X)==null?0:(J=k.downloads)==null?0:J.length)for(E=g.r(X.downloads),d=E.next();!d.done;d=E.next())Yw=d.value,Yw.videoItem&&M.add(Yw.videoItem);TE=new Set;h=[];fF=g.r(D);for(W=fF.next();!W.done;W=fF.next()){HI=W.value;if(HI.videos)for(bt=
g.r(HI.videos),mI=bt.next();!mI.done;mI=bt.next())BA=mI.value,(f_=JSON.parse(g.hR(BA).entityId).videoId)&&TE.add(f_);HI.key&&!M.has(HI.key)&&h.push(HI.key)}nF=g.r(O);for(wk=nF.next();!wk.done;wk=nF.next())Tz=wk.value,Tz.key&&!M.has(Tz.key)&&(B=g.hR(Tz.key).entityId,TE.has(B)||h.push(Tz.key));return h.length?g.c(Ah,pOV(z,h),0):Ah.H0(0)})};g.p(aDw,kk);aDw.prototype.J=function(z){return Oc(z)?JvA(this,z):sc(z)?mXz(this,z):D4(z)?NT_(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};
var RK=[10];g.p(eI_,kk);eI_.prototype.J=function(z){return Oc(z)?xXQ(this,z):sc(z)?Sn$(this,z):D4(z)?EEA(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};
var hT=[10];g.p(hI$,kk);hI$.prototype.J=function(z){return Oc(z)?Kk2(this,z):sc(z)?To2(this,z):D4(z)?GhV(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};
var YuW=[10];g.p(zl,xk);zl.prototype.uh=function(z){var t=xk.prototype.uh.call(this,z);t.musicTrack=new hI$(z,this.K);t.musicPlaylist=new eI_(z,this.K);t.musicAlbumRelease=new aDw(z,this.K);return t};
zl.prototype.refreshAllStaleEntities=function(z,t){var Y=this,K,T,G;return g.P(function(v){if(v.J==1)return g.c(v,AON(Y,z,t),2);if(v.J!=3)return T=K=v.K,G=T.concat,g.c(v,xk.prototype.refreshAllStaleEntities.call(Y,z,t),3);K=G.call(T,v.K);return v.return(K)})};g.p(f_$,g.Zc);g.q=f_$.prototype;g.q.create=function(){var z=this;g.a(this,this.events);if(g.Sn(this.s4))this.K=new LwA(this.s4,this.player);else if(g.Jf(this.s4)||g.Rh(this.s4)==="WEB_MUSIC_INTEGRATIONS")this.K=new zl(this.s4,this.player);this.events.D(this.player,"onPlaybackStartExternal",function(){z.fN()});
this.events.D(this.player,"videodatachange",function(){z.fN()});
this.s4.X("html5_offline_playback_position_sync")&&this.events.D(this.player,"presentingplayerstatechange",this.Fm)};
g.q.VL=function(){return!1};
g.q.MF=function(z,t,Y,K){var T=this;return g.P(function(G){return T.K?G.return(SA(T.K,z,t,Y,K)):G.return(Promise.reject())})};
g.q.deleteAll=function(){return this.K.deleteAll()};
g.q.U6=function(z){return this.K.U6(z)};
g.q.refreshAllStaleEntities=function(z){return this.K.refreshAllStaleEntities(z)};
g.q.setUpPositionSyncInterval=function(z){this.K.setUpPositionSyncInterval(z)};
g.q.WX=function(z){this.K.WX(z)};
g.q.Z2=function(z){return this.K.Z2(z)};
g.q.fN=function(){var z=this,t;return g.P(function(Y){t=z.player.getVideoData();return g.Ng(t)?CPN(t)&&z.J!==t.clientPlaybackNonce?g.c(Y,XVj(z,t),0):Y.H0(0):Y.return()})};
g.q.Fm=function(z){var t=this,Y,K,T,G,v,f,C;return g.P(function(X){if(X.J==1)return Y=t.player.getVideoData(),K=Y.aQ,g.pz(z,2)||g.pz(z,512)?g.c(X,tT(),2):X.return();if(X.J!=3){T=X.K;if(!T)return GF("PES is undefined"),X.return();G=Y.videoId;return g.c(X,hP(T,g.zj(G,"mainVideoEntity"),"mainVideoEntity"),3)}v=X.K;if(!v)return X.return();f=Math.floor(K).toString();C={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:f}};return g.c(X,t.MF([G],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
C),0)})};
g.q.isOrchestrationLeader=function(){return this.K.isOrchestrationLeader()};
g.q.updateDownloadState=function(z,t){var Y,K,T,G;return g.P(function(v){if(v.J==1)return g.c(v,tT(),2);Y=v.K;if(!Y)return GF("PES is undefined"),v.return();K=g.hR(z);T=K.entityType;G=K.entityId;return g.c(v,MC(G,T,Y,t,!0),0)})};g.lD("offline",f_$);})(_yt_player);
